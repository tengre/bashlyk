<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="./bashlyk.css" type="text/css" />
<title>./doc/bashlyk</title>
<!-- Source: ./src/ -->
<!-- Generated with ROBODoc Version 4.99.43 (May  3 2019) -->
</head>
<body>
<div id="logo">
<span style="float:left;">Library for BASH command language interpreter</span>
<a name="robo_top_of_doc"></a>
<span style="float:right;">bashlyk</span>
</div> <!-- logo -->
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo71">BASHLYK/bashlyk</a></li>
<ul>
<li>1.1. <a href="#robo7">bashlyk/Global variables</a></li>
<li>1.2. <a href="#robo80">bashlyk/bashlyk::init</a></li>
<li>1.3. <a href="#robo81">bashlyk/bashlyk::main</a></li>
<li>1.4. <a href="#robo82">bashlyk/Entry Point</a></li>
</ul>
<li>2. <a href="#robo72">BASHLYK/libcfg</a></li>
<ul>
<li>2.1. <a href="#robo0">libcfg/Used libraries</a></li>
<li>2.2. <a href="#robo8">libcfg/Global Variables</a></li>
<li>2.3. <a href="#robo16">libcfg/CFG</a></li>
<li>2.4. <a href="#robo17">libcfg/CFG::bind.cli</a></li>
<li>2.5. <a href="#robo18">libcfg/CFG::free</a></li>
<li>2.6. <a href="#robo19">libcfg/CFG::get</a></li>
<li>2.7. <a href="#robo20">libcfg/CFG::getopt</a></li>
<li>2.8. <a href="#robo21">libcfg/CFG::keys</a></li>
<li>2.9. <a href="#robo22">libcfg/CFG::keys.each</a></li>
<li>2.10. <a href="#robo23">libcfg/CFG::load</a></li>
<li>2.11. <a href="#robo24">libcfg/CFG::read</a></li>
<li>2.12. <a href="#robo25">libcfg/CFG::save</a></li>
<li>2.13. <a href="#robo26">libcfg/CFG::set</a></li>
<li>2.14. <a href="#robo27">libcfg/CFG::show</a></li>
<li>2.15. <a href="#robo28">libcfg/CFG::storage.show</a></li>
<li>2.16. <a href="#robo29">libcfg/CFG::storage.use</a></li>
<li>2.17. <a href="#robo30">libcfg/CFG::storage.use.default</a></li>
<li>2.18. <a href="#robo45">libcfg/CFG::__section.byindex</a></li>
<li>2.19. <a href="#robo46">libcfg/CFG::__section.getArray</a></li>
<li>2.20. <a href="#robo47">libcfg/CFG::__section.id</a></li>
<li>2.21. <a href="#robo48">libcfg/CFG::__section.select</a></li>
<li>2.22. <a href="#robo49">libcfg/CFG::__section.setRawData</a></li>
<li>2.23. <a href="#robo50">libcfg/CFG::__section.show</a></li>
<li>2.24. <a href="#robo51">libcfg/CFG::settings</a></li>
<li>2.25. <a href="#robo52">libcfg/CFG::settings.section.padding</a></li>
<li>2.26. <a href="#robo53">libcfg/CFG::settings.shellmode</a></li>
</ul>
<li>3. <a href="#robo73">BASHLYK/liberr</a></li>
<ul>
<li>3.1. <a href="#robo1">liberr/Used libraries</a></li>
<li>3.2. <a href="#robo9">liberr/Global Variables</a></li>
<li>3.3. <a href="#robo14">liberr/Aliases</a></li>
<li>3.4. <a href="#robo31">liberr/err::exception.message</a></li>
<li>3.5. <a href="#robo32">liberr/err::generate</a></li>
<li>3.6. <a href="#robo33">liberr/err::sourcecode</a></li>
<li>3.7. <a href="#robo34">liberr/err::stacktrace</a></li>
<li>3.8. <a href="#robo35">liberr/err::status</a></li>
<li>3.9. <a href="#robo54">liberr/err::__add_throw_to_command</a></li>
<li>3.10. <a href="#robo55">liberr/err::__convert_try_to_func</a></li>
<li>3.11. <a href="#robo56">liberr/err::__generate</a></li>
<li>3.12. <a href="#robo57">liberr/err::AlreadyExist</a></li>
<li>3.13. <a href="#robo58">liberr/err::CommandNotFound</a></li>
<li>3.14. <a href="#robo59">liberr/err::EmptyResult</a></li>
<li>3.15. <a href="#robo60">liberr/err::EmptyVariable</a></li>
<li>3.16. <a href="#robo61">liberr/err::InvalidVariable</a></li>
<li>3.17. <a href="#robo62">liberr/err::MissingArgument</a></li>
<li>3.18. <a href="#robo63">liberr/err::NoSuchDir</a></li>
<li>3.19. <a href="#robo64">liberr/err::NoSuchFile</a></li>
<li>3.20. <a href="#robo65">liberr/err::NoSuchFileOrDir</a></li>
<li>3.21. <a href="#robo66">liberr/err::NotExistNotCreated</a></li>
<li>3.22. <a href="#robo67">liberr/err::NotNumber</a></li>
<li>3.23. <a href="#robo68">liberr/err::orr</a></li>
<li>3.24. <a href="#robo69">liberr/err::postfix</a></li>
<li>3.25. <a href="#robo70">liberr/err::status.show</a></li>
<li>3.26. <a href="#robo83">liberr/err::debug</a></li>
<li>3.27. <a href="#robo84">liberr/err::debugf</a></li>
</ul>
<li>4. <a href="#robo74">BASHLYK/liblog</a></li>
<ul>
<li>4.1. <a href="#robo2">liblog/Used libraries</a></li>
<li>4.2. <a href="#robo10">liblog/Global variables</a></li>
<li>4.3. <a href="#robo85">liblog/log::add</a></li>
<li>4.4. <a href="#robo86">liblog/log::file</a></li>
<li>4.5. <a href="#robo87">liblog/log::ger</a></li>
<li>4.6. <a href="#robo88">liblog/log::init</a></li>
<li>4.7. <a href="#robo89">liblog/log::interactivity</a></li>
<li>4.8. <a href="#robo90">liblog/log::necessity</a></li>
<li>4.9. <a href="#robo91">liblog/log::stamp</a></li>
<li>4.10. <a href="#robo92">liblog/log::terminality</a></li>
</ul>
<li>5. <a href="#robo75">BASHLYK/libmsg</a></li>
<ul>
<li>5.1. <a href="#robo3">libmsg/Used libraries</a></li>
<li>5.2. <a href="#robo11">libmsg/Global variables</a></li>
<li>5.3. <a href="#robo93">libmsg/msg::echo</a></li>
<li>5.4. <a href="#robo94">libmsg/msg::getXsessionProperties</a></li>
<li>5.5. <a href="#robo95">libmsg/msg::mail</a></li>
<li>5.6. <a href="#robo96">libmsg/msg::notify</a></li>
<li>5.7. <a href="#robo97">libmsg/msg::notify2x</a></li>
<li>5.8. <a href="#robo98">libmsg/msg::notifyTool</a></li>
<li>5.9. <a href="#robo99">libmsg/msg::warn</a></li>
</ul>
<li>6. <a href="#robo76">BASHLYK/libnet</a></li>
<ul>
<li>6.1. <a href="#robo4">libnet/Used libraries</a></li>
<li>6.2. <a href="#robo12">libnet/Global variables</a></li>
<li>6.3. <a href="#robo15">libnet/Aliases</a></li>
<li>6.4. <a href="#robo100">libnet/net::ipv4.broadcast</a></li>
<li>6.5. <a href="#robo101">libnet/net::ipv4.cidr</a></li>
<li>6.6. <a href="#robo102">libnet/net::ipv4.host</a></li>
<li>6.7. <a href="#robo103">libnet/net::ipv4.mask</a></li>
<li>6.8. <a href="#robo104">libnet/net::ipv4.network</a></li>
<li>6.9. <a href="#robo105">libnet/net::ipv4.range</a></li>
<li>6.10. <a href="#robo106">libnet/net::ipv4.wildcard</a></li>
</ul>
<li>7. <a href="#robo77">BASHLYK/libpid</a></li>
<ul>
<li>7.1. <a href="#robo5">libpid/Used libraries</a></li>
<li>7.2. <a href="#robo13">libpid/Global Variables</a></li>
<li>7.3. <a href="#robo36">libpid/pid::file</a></li>
<li>7.4. <a href="#robo37">libpid/pid::onExit.close</a></li>
<li>7.5. <a href="#robo38">libpid/pid::onExit.stop</a></li>
<li>7.6. <a href="#robo39">libpid/pid::onExit.unlink</a></li>
<li>7.7. <a href="#robo40">libpid/pid::onExit.unlink.empty</a></li>
<li>7.8. <a href="#robo41">libpid/pid::onStarted.exit</a></li>
<li>7.9. <a href="#robo42">libpid/pid::status</a></li>
<li>7.10. <a href="#robo43">libpid/pid::stop</a></li>
<li>7.11. <a href="#robo44">libpid/pid::trap</a></li>
</ul>
<li>8. <a href="#robo78">BASHLYK/libstd</a></li>
<ul>
<li>8.1. <a href="#robo6">libstd/Used libraries</a></li>
<li>8.2. <a href="#robo107">libstd/_</a></li>
<li>8.3. <a href="#robo108">libstd/Global Variables</a></li>
<li>8.4. <a href="#robo109">libstd/std::acceptArrayItem</a></li>
<li>8.5. <a href="#robo110">libstd/std::cat</a></li>
<li>8.6. <a href="#robo111">libstd/std::date</a></li>
<li>8.7. <a href="#robo112">libstd/std::dateR</a></li>
<li>8.8. <a href="#robo113">libstd/std::finally</a></li>
<li>8.9. <a href="#robo114">libstd/std::getFreeFD</a></li>
<li>8.10. <a href="#robo115">libstd/std::getMD5</a></li>
<li>8.11. <a href="#robo116">libstd/std::getMD5.list</a></li>
<li>8.12. <a href="#robo117">libstd/std::getTimeInSec</a></li>
<li>8.13. <a href="#robo118">libstd/std::inline</a></li>
<li>8.14. <a href="#robo119">libstd/std::isDecimal</a></li>
<li>8.15. <a href="#robo120">libstd/std::isHash</a></li>
<li>8.16. <a href="#robo121">libstd/std::isNumber</a></li>
<li>8.17. <a href="#robo122">libstd/std::isVariable</a></li>
<li>8.18. <a href="#robo123">libstd/std::lazyquote</a></li>
<li>8.19. <a href="#robo124">libstd/std::showVariable</a></li>
<li>8.20. <a href="#robo125">libstd/std::temp</a></li>
<li>8.21. <a href="#robo126">libstd/std::trim</a></li>
<li>8.22. <a href="#robo127">libstd/std::uptime</a></li>
<li>8.23. <a href="#robo128">libstd/std::whitespace.decode</a></li>
<li>8.24. <a href="#robo129">libstd/std::whitespace.encode</a></li>
<li>8.25. <a href="#robo130">libstd/std::xml</a></li>
</ul>
<li>9. <a href="#robo79">BASHLYK/testunit</a></li>
<ul>
<li>9.1. <a href="#robo131">testunit/Global Variables</a></li>
<li>9.2. <a href="#robo132">testunit/testunit::error</a></li>
<li>9.3. <a href="#robo133">testunit/testunit::main</a></li>
<li>9.4. <a href="#robo134">testunit/testunit::msg</a></li>
</ul>
</ul>
<a name="robo71"></a>
<a name="BASHLYK2fbashlyk"></a>
<h1>1.  BASHLYK/bashlyk [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Loader for BASHLYK-libraries. Prepares the structure of the necessary
    directories and files, determines the interactivity of the running script,
    allows you to run the library test module
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo7"></a>
<a name="bashlyk2fGlobal20variables"></a>
<h2>1.1.  bashlyk/Global variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo71">bashlyk</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"/etc/<a href="#robo71">bashlyk</a>/<a href="#robo71">bashlyk</a>.conf"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="sign">/</span>etc<span class="sign">/</span><a href="#robo71">bashlyk</a><span class="sign">/</span><a href="#robo71">bashlyk</a><span class="sign">.</span>conf
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_aLib<span class="sign">:</span><span class="sign">=</span><span class="quote">"err,std,cfg,pid,net,log,msg"</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">:</span><span class="sign">=</span><span class="quote">"/usr/share/<a href="#robo71">bashlyk</a>"</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_s0<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>0<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sArg<span class="sign">:</span><span class="sign">=</span><span class="quote">"$@"</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_bInteract<span class="sign">:</span><span class="sign">=</span>1<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_bTerminal<span class="sign">:</span><span class="sign">=</span>1<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sCond4Log<span class="sign">:</span><span class="sign">=</span>noterm<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_bNotUseLog<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>USER<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c id <span class="sign">-</span>nu <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sUser<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span>USER<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sGroup<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c id <span class="sign">-</span>ng <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>HOSTNAME<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c hostname 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>DEBUGLEVEL<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_ShellVersion<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span>
    printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%d%03d%03d\n'</span> <span class="sign">$</span><span class="sign">{</span>BASH_VERSINFO<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">:</span>0<span class="sign">:</span>3<span class="sign">}</span>
  <span class="sign">)</span>
<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iPidMax<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span>
    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="sign">/</span>proc<span class="sign">/</span>sys<span class="sign">/</span>kernel<span class="sign">/</span>pid_max <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then
      echo <span class="sign">$</span><span class="sign">(</span><span class="sign">&lt;</span> <span class="sign">/</span>proc<span class="sign">/</span>sys<span class="sign">/</span>kernel<span class="sign">/</span>pid_max<span class="sign">)</span>
    else
      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span> uname <span class="sign">-</span>m <span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> <span class="squote">'x86_64'</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then
        echo <span class="squote">'4194304'</span>
      else
        echo <span class="squote">'32678'</span>
      fi
    fi
  <span class="sign">)</span>
<span class="sign">}</span>

declare <span class="sign">-</span>rg _bashlyk_PWD<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>PWD<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span>pwd<span class="sign">)</span><span class="sign">}</span>
declare <span class="sign">-</span>ag _bashlyk_aArg<span class="sign">=</span><span class="sign">(</span> <span class="quote">"$@"</span> <span class="sign">)</span>
declare <span class="sign">-</span>rg _bashlyk_externals_bashlyk<span class="sign">=</span><span class="quote">"

    cut findmnt getent grep hostname id printf tr tty uname xargs

"</span>
</pre>
<a name="robo80"></a>
<a name="bashlyk2fbashlyk3a3ainit"></a>
<h2>1.2.  bashlyk/bashlyk::init [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo71">bashlyk</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>bashlyk::init</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Preparing to run the script, determine the conditions of its operation
    (directories of the location of the created files, the presence of a
    terminal, redirection, etc.)
    If the startup is performed from "root", then the directories are located
    globally, according to the FHS standard, otherwise - in the directories
    according to the XDG Base Directory Specification.
    In the event that it was not possible to determine the owner of the process
    or if there is no home directory, the hierarchy of script objects is
    created in the global temporary directory $TMPDIR
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>bashlyk::init</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    _bashlyk_sId<span class="sign">=</span><span class="quote">"$_bashlyk"</span>
    _bashlyk_pathPrefix<span class="sign">=</span><span class="quote">"$_bashlyk"</span>

  else

    _bashlyk_sId<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_s0<span class="sign">%</span><span class="sign">.</span>sh<span class="sign">}</span>
    _bashlyk_pathPrefix<span class="sign">=</span><span class="squote">'<a href="#robo71">bashlyk</a>'</span>

  fi

  case <span class="sign">$</span>_bashlyk_sUser in

    <span class="squote">'root'</span><span class="sign">)</span>

            _bashlyk_pathCfg<span class="sign">=</span><span class="quote">"/etc/${_bashlyk_pathPrefix}"</span>
            _bashlyk_pathRun<span class="sign">=</span><span class="quote">"/var/run/${_bashlyk_pathPrefix}"</span>
            _bashlyk_pathLog<span class="sign">=</span><span class="quote">"/var/log/${_bashlyk_pathPrefix}"</span>
            _bashlyk_pathDat<span class="sign">=</span><span class="quote">"/var/lib/${_bashlyk_pathPrefix}"</span>

            <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"/etc/${_bashlyk_pathPrefix}/<a href="#robo71">bashlyk</a>.conf"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span>
              <span class="sign">.</span> <span class="quote">"/etc/${_bashlyk_pathPrefix}/<a href="#robo71">bashlyk</a>.conf"</span>
    <span class="sign">;</span><span class="sign">;</span>

         <span class="sign">*</span><span class="sign">)</span>
            if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>z <span class="quote">"$HOME"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">!</span> <span class="sign">-</span>O <span class="quote">"$HOME"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

              s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span>getent passwd <span class="sign">$</span>_bashlyk_sUser <span class="sign">|</span> cut <span class="sign">-</span>d <span class="quote">":"</span> <span class="sign">-</span>f 6<span class="sign">)</span>
              <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>d <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>O <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span>
                s<span class="sign">=</span><span class="quote">"/${TMPDIR}/${$}<a href="#robo107">_</a>${_bashlyk_sUser}"</span>

            else

              s<span class="sign">=</span><span class="sign">$</span>HOME

            fi

            _bashlyk_pathCfg<span class="sign">=</span><span class="quote">"${s}/.config/${_bashlyk_pathPrefix}"</span>
            _bashlyk_pathRun<span class="sign">=</span><span class="quote">"${s}/.cache/${_bashlyk_pathPrefix}/run"</span>
            _bashlyk_pathLog<span class="sign">=</span><span class="quote">"${s}/.local/share/${_bashlyk_pathPrefix}/log"</span>
            _bashlyk_pathDat<span class="sign">=</span><span class="quote">"${s}/.local/share/${_bashlyk_pathPrefix}/lib"</span>

            <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"${s}/.config/<a href="#robo71">bashlyk</a>/<a href="#robo71">bashlyk</a>.conf"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span>
              <span class="sign">.</span> <span class="quote">"${s}/.config/<a href="#robo71">bashlyk</a>/<a href="#robo71">bashlyk</a>.conf"</span>

            <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"${s}/.config/${_bashlyk_pathPrefix}/<a href="#robo71">bashlyk</a>.conf"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span>
              <span class="sign">.</span> <span class="quote">"${s}/.config/${_bashlyk_pathPrefix}/<a href="#robo71">bashlyk</a>.conf"</span>

         <span class="sign">;</span><span class="sign">;</span>
  esac

  _bashlyk_pathCnf<span class="sign">=</span><span class="quote">"$_bashlyk_pathCfg"</span>
  _bashlyk_pathIni<span class="sign">=</span><span class="quote">"$_bashlyk_pathCfg"</span>

  for TMPDIR in <span class="sign">/</span>dev<span class="sign">/</span>shm <span class="sign">/</span>run<span class="sign">/</span>shm <span class="sign">/</span>tmp <span class="sign">$</span>_bashlyk_pathDat<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>w <span class="sign">$</span>TMPDIR <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
    s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> findmnt <span class="sign">-</span>n <span class="sign">-</span>o SOURCE<span class="sign">,</span>TARGET <span class="sign">-</span><span class="sign">-</span>target <span class="sign">$</span>TMPDIR <span class="sign">|</span> xargs <span class="sign">)</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="sign">/</span>proc<span class="sign">/</span>mounts <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> break
    if <span class="sign">!</span> grep <span class="quote">"${s}.*noexec"</span> <span class="sign">/</span>proc<span class="sign">/</span>mounts <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

      declare <span class="sign">-</span>rg TMPEXEC<span class="sign">=</span><span class="sign">$</span>TMPDIR
      break

    fi

  done
  unset s

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>TMPEXEC <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    echo <span class="quote">"warn: not found filesystem for exec temporary files"</span>
    TMPEXEC<span class="sign">=</span><span class="sign">$</span>TMPDIR

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>t 1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> _bashlyk_bInteract<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> _bashlyk_bInteract<span class="sign">=</span>0
  tty <span class="sign">&gt;</span> <span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> _bashlyk_bTerminal<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> _bashlyk_bTerminal<span class="sign">=</span>0

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$_bashlyk_sArg"</span> <span class="sign">=</span><span class="sign">~</span> <a href="#robo71">bashlyk</a><span class="sign">-</span>test <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    _bashlyk_aUnit<span class="sign">=</span><span class="quote">"$(echo "</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_sArg<span class="sign">#</span><span class="sign">*</span><span class="sign">-</span><span class="sign">-</span><a href="#robo71">bashlyk</a><span class="sign">-</span>test<span class="sign">=</span><span class="sign">}</span><span class="quote">" | cut -f1 -d' ' |
      tr ',' ' ' | grep -v '\-\-<a href="#robo71">bashlyk</a>-test')"</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_aUnit <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> _bashlyk_aUnit<span class="sign">=</span><span class="quote">"$(echo $_bashlyk_aLib|tr ',' ' ')"</span>

    _bashlyk_sMode<span class="sign">=</span><span class="squote">'test'</span>

    export _bashlyk_pathIni _bashlyk_pathRun _bashlyk_pathDat _bashlyk_pathLog <span class="sign">\</span>
           _bashlyk_sLogin _bashlyk_bUseMail _bashlyk_sUser _bashlyk_sGroup    <span class="sign">\</span>
           _bashlyk_ShellVersion

  else

    _bashlyk_sMode<span class="sign">=</span><span class="squote">'lib'</span>

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_aUnit <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> _bashlyk_aUnit<span class="sign">=</span><span class="quote">"${_bashlyk_aLib//,/ }"</span>

<span class="sign">}</span>
</pre>
<a name="robo81"></a>
<a name="bashlyk2fbashlyk3a3amain"></a>
<h2>1.3.  bashlyk/bashlyk::main [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo71">bashlyk</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>bashlyk::main</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Initialization, loading libraries, starting the logging process if there is
    a redirection of standard devices or loss of the terminal depending on the
    value of $_bashlyk_sCond4Log ("noterm" by default).
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>bashlyk::main</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local cmd fn s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  <a href="#robo80">bashlyk::init</a>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$_bashlyk_sMode"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"test"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    cmd<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo79">testunit</a><span class="sign">.</span>sh

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="quote">"$cmd"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> eval <span class="squote">'echo "Error: $cmd not found..."; exit 255'</span>

    for s in <span class="sign">$</span>_bashlyk_aUnit<span class="sign">;</span> do bash <span class="sign">$</span>cmd <span class="sign">$</span>s<span class="sign">;</span> done

    exit <span class="sign">$</span><span class="sign">?</span>

  else

    for s in <span class="sign">$</span>_bashlyk_aUnit<span class="sign">;</span> do

      fn<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span>lib<span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">.</span>sh
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$fn"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="sign">$</span>fn <span class="sign">|</span><span class="sign">|</span> eval <span class="squote">'echo "Error: $fn not found..."; exit 255'</span>

    done

  fi

  unset _bashlyk_aUnit _bashlyk_sMode

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_log <span class="sign">=</span><span class="sign">=</span> <span class="quote">"nouse"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return 0

  case <span class="sign">$</span><span class="sign">{</span>_bashlyk_sCond4Log<span class="sign">}</span> in

    redirect<span class="sign">)</span> _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bInteract <span class="sign">;</span><span class="sign">;</span>
      noterm<span class="sign">)</span> _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bTerminal <span class="sign">;</span><span class="sign">;</span>
           <span class="sign">*</span><span class="sign">)</span> _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bInteract <span class="sign">;</span><span class="sign">;</span>

  esac

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$_bashlyk_bNotUseLog"</span> <span class="sign">!</span><span class="sign">=</span> <span class="quote">"0"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> <a href="#robo86">log::file</a>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo82"></a>
<a name="bashlyk2fEntry20Point"></a>
<h2>1.4.  bashlyk/Entry Point [ Generics ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo71">bashlyk</a> ] [ Generics ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    loader entry point
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><a href="#robo81">bashlyk::main</a>
</pre>
<a name="robo72"></a>
<a name="BASHLYK2flibcfg"></a>
<h1>2.  BASHLYK/libcfg [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Management of configuration data of various sources - files (including INI
    style) and command line options. Implemented capabilities and features:
     - associative arrays are used to store the configuration data
     - OOP style used for a treatment of the configuration data:
       * functions (eg, get/set) bind with the configuration data, as "methods"
         of the corresponding instance of the base class "<a href="#robo16">CFG</a>"
       * used the constructor and destructor to manage the life cycle of the
         resources allocated for processing configuration data
     - configuration source may be not only single file but also a group of
       related files
     - supported the filtration ability  - retrieving only the specified
       sections and parameters
     - The possibility of simultaneous and independent work with different
       sources of the configuration data
     - Get/Set certain configuration data by using parameter as key
     - Record the configuration data to a file or output to the standard device
       in the INI format or "active configuration".
     - Support for Command Line Interface (CLI) - simultaneous determination of
       long and short options of configuration parameters.
     - parsing the command line arguments and their binding to configuration
       data that allows you to override selected parameters of the
       configuration file.
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a> <a href="#robo73">liberr</a>
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    # create instance from <a href="#robo16">CFG</a> class
    <a href="#robo16">CFG</a> cfg

    # define CLI options and bind to the 'cfg' instance
    cfg.bind.cli auth{a}: config{c}: source{s}:-- help{h} mode{m}: show-conf{C} show-data{d}

    # if set --help (-h) option then show usage only
    [[ $( cfg.getopt help ) ]] &amp;&amp; usage() # and exit

    # get value of the --config (-c) option to the variable $config
    config=$( cfg.getopt config )

    # set this value as source of the configuration data
    cfg.storage.use $config

    # load selected options from INI-style configuration file and combine with
    # relevant CLI options.
    # [!] CLI options with the same name have higher priority
    cfg.load                                                                  \
                  []auth,mode                                                 \
              [show]conf,data                                                 \
            [source]=

    # check value of the option 'conf' from section 'show'
    if [[ $( cfg.get [show]conf ) ]]; then
      echo "view current config:"
      # show configuration in the INI-style
      cfg.show
      exit 0
    fi

    # set new value for 'mode' options from global section
    cfg.set []mode = demo # or cfg.set mode = demo

    # set new option 'date' to the global section
    cfg.set date = $( date -R )

    # add new items to list of unique values
    cfg.set [source] = $HOME
    cfg.set [source] = /var/mail/$USER

    # save updated configuration to the file $config
    cfg.save

    # or "other file.ini"
    cfg.save other file.ini

    # destroy ini object, free resources
    cfg.free
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo0"></a>
<a name="libcfg2fUsed20libraries"></a>
<h2>2.1.  libcfg/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
</pre>
<a name="robo8"></a>
<a name="libcfg2fGlobal20Variables"></a>
<h2>2.2.  libcfg/Global Variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">declare <span class="sign">-</span>rg _bashlyk_CNF_reKey<span class="sign">=</span><span class="squote">'^\b([_a-zA-Z][_a-zA-Z0-9]*)\b$'</span>
declare <span class="sign">-</span>rg _bashlyk_INI_reKey<span class="sign">=</span><span class="squote">'^\b([^=]+)\b$'</span>
declare <span class="sign">-</span>rg _bashlyk_CNF_reKeyVal<span class="sign">=</span><span class="squote">'^[[:space:]]*\b([_a-zA-Z][_a-zA-Z0-9]*)\b=(.*)[[:space:]]*$'</span>
declare <span class="sign">-</span>rg _bashlyk_INI_reKeyVal<span class="sign">=</span><span class="squote">'^[[:space:]]*\b([^=]+)\b[[:space:]]*=[[:space:]]*(.*)[[:space:]]*$'</span>
declare <span class="sign">-</span>rg _bashlyk_CNF_fmtPairs<span class="sign">=</span><span class="squote">'^[[:space:]]*\b(%KEY%)\b=(.*)[[:space:]]*$'</span>
declare <span class="sign">-</span>rg _bashlyk_INI_fmtPairs<span class="sign">=</span><span class="squote">'^[[:space:]]*\b(%KEY%)\b[[:space:]]*=[[:space:]]*(.*)[[:space:]]*$'</span>

declare <span class="sign">-</span>rg _bashlyk_methods_cfg<span class="sign">=</span><span class="quote">"

    bind.cli get getopt keys keys.each load read save __section.byindex
    __section.getArray __section.id __section.select __section.setRawData
    __section.show set settings settings.section.padding settings.shellmode
    show storage.show storage.use.default storage.use free
"</span>

declare <span class="sign">-</span>rg _bashlyk_externals_cfg<span class="sign">=</span><span class="quote">"

    [ getopt mkdir mv pwd readlink rm sha1sum sort stat touch

"</span>

declare <span class="sign">-</span>rg _bashlyk_exports_cfg<span class="sign">=</span><span class="quote">"

    <a href="#robo16">CFG</a> <a href="#robo16">CFG</a>::{bind.cli,free,get,getopt,keys,keys.eachload,read,save,set,settings,
    settings.section.padding,settings.shellmode,show,storage.show storage.use}
"</span>

_bashlyk_iErrorIniMissingMethod<span class="sign">=</span>111
_bashlyk_iErrorIniBadMethod<span class="sign">=</span>110
_bashlyk_iErrorIniExtraCharInKey<span class="sign">=</span>109
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorIniMissingMethod<span class="sign">]</span><span class="sign">=</span><span class="quote">"instance failed - missing method"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorIniBadMethod<span class="sign">]</span><span class="sign">=</span><span class="quote">"instance failed - bad method"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorIniExtraCharInKey<span class="sign">]</span><span class="sign">=</span><span class="quote">"extra character(s) in the key"</span>
</pre>
<a name="robo16"></a>
<a name="libcfg2fCFG"></a>
<h2>2.3.  libcfg/CFG [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG</strong> [&lt;id&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    constructor for new instance &lt;id&gt; of the <strong>CFG</strong> "class" (object)
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    valid variable name for created instance, default - used class name <strong>CFG</strong> as
    instance
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidVariable  - invalid variable name for instance
    IniMissingMethod - method not found
    IniBadMethod     - bad method
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>CFG</strong> tnew                                                                   #? true
    declare -f tnew.show &gt;/dev/null 2&gt;&amp;1                                      #= true
    declare -f tnew.save &gt;/dev/null 2&gt;&amp;1                                      #= true
    declare -f tnew.load &gt;/dev/null 2&gt;&amp;1                                      #= true
    tnew.__section.id @                                                        | {{ _hTNEW_settings }}
    tnew.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local f fn s o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>1<span class="sign">:</span><span class="sign">-</span><strong>CFG</strong><span class="sign">}</span>

  throw on InvalidVariable <span class="sign">$</span>o

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>o <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span>c<span class="sign">(</span>o<span class="sign">)</span><span class="sign">?</span>nf <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">!</span> <span class="sign">$</span>o <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span>config <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    declare <span class="sign">-</span>Ag <span class="sign">-</span><span class="sign">-</span> _h<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span>_settings<span class="sign">=</span><span class="squote">'(

      [chComment]="#"
      [bShellMode]="true"
      [bSaveConfig]="true"
      [bSectionPadding]="true"
      [reKey]="$_bashlyk_CNF_reKey"
      [reKeyVal]="$_bashlyk_CNF_reKeyVal"
      [fmtPairs]="$_bashlyk_CNF_fmtPairs"
      [fmtSection0]="\n\n# [ %s ]%s\n\n"
      [fmtSection1]="\n# %s[ %s ]\n"

    )'</span>

  else

    declare <span class="sign">-</span>Ag <span class="sign">-</span><span class="sign">-</span> _h<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span>_settings<span class="sign">=</span><span class="squote">'(

      [chComment]="#"
      [bShellMode]="false"
      [bSaveConfig]="true"
      [bSectionPadding]="true"
      [reKey]="$_bashlyk_INI_reKey"
      [reKeyVal]="$_bashlyk_INI_reKeyVal"
      [fmtPairs]="$_bashlyk_INI_fmtPairs"
      [fmtSection0]="\n\n[ %s ]%s\n\n"
      [fmtSection1]="\n%s[ %s ]\n"

    )'</span>

  fi

  declare <span class="sign">-</span>Ag <span class="sign">-</span><span class="sign">-</span> _h<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span><span class="sign">=</span><span class="quote">"([__settings__]=_h${o^^}_settings)"</span>
  declare <span class="sign">-</span>ag <span class="sign">-</span><span class="sign">-</span> _a<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span><span class="sign">=</span><span class="quote">"()"</span>

  <a href="#robo125">std::temp</a> fn path<span class="sign">=</span><span class="quote">"${TMPDIR}/${USER}/<a href="#robo71">bashlyk</a>"</span> prefix<span class="sign">=</span><span class="squote">'cfg.'</span> suffix<span class="sign">=</span><span class="quote">".${o}"</span>

  for s in <span class="sign">$</span>_bashlyk_methods_cfg<span class="sign">;</span> do

    f<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> declare <span class="sign">-</span>f <strong>CFG</strong><span class="sign">:</span><span class="sign">:</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span> 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> error IniMissingMethod throw <span class="sign">-</span><span class="sign">-</span> <strong>CFG</strong><span class="sign">:</span><span class="sign">:</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span> for <span class="sign">$</span>o

    echo <span class="quote">"${f/<strong>CFG</strong>::$s/${o}.$s}"</span> <span class="sign">&gt;</span><span class="sign">&gt;</span> <span class="sign">$</span>fn <span class="sign">|</span><span class="sign">|</span> error IniBadMethod throw <span class="sign">-</span><span class="sign">-</span> <strong>CFG</strong><span class="sign">:</span><span class="sign">:</span><span class="sign">$</span>s for <span class="sign">$</span>o

  done

  source <span class="sign">$</span>fn <span class="sign">|</span><span class="sign">|</span> error InvalidArgument throw <span class="sign">$</span>fn
  return 0

<span class="sign">}</span>
</pre>
<a name="robo17"></a>
<a name="libcfg2fCFG3a3abind2ecli"></a>
<h2>2.4.  libcfg/CFG::bind.cli [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::bind.cli</strong> [&lt;section&gt;[-]][&lt;option name&gt;{&lt;short name&gt;}[:[:]]]|[-=+] ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Parse command line options and bind to the <a href="#robo16">CFG</a> instance
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;option name&gt; - option name that used as long option of the CLI and key for
                    array of the <a href="#robo16">CFG</a> data
    &lt;section&gt;     - part of the option name for binding it to a certain section
                    of the <a href="#robo16">CFG</a> data. By default, it is assumed that option is
                    included to the global section. The presence of a hyphen in
                    the name of the section creates a hierarchy "section"-"key"
                    for the easy mapping the command line options to the
                    configuration file keys
    &lt;short name&gt;  - short alias as single letter for option name
    first  :      - option is expected to have a required argument
    second :      - argument is a optional
           -      - replace content of the raw section
           =      - option is expected to have list of unique arguments
           +      - option is expected to have list of accumulated arguments
                    by default, option is included in the global section of the
                    <a href="#robo16">CFG</a> instance data
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments is not specified
    InvalidArgument - invalid format of the arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cfg
    _bashlyk_aArg=( --file CLI -E clear -H 'Hi!' --main-msg test -U a.2 -U a.2 --acc "with white spaces" --acc b )
    <a href="#robo125">std::temp</a> cfg
    tLoad.save $cfg                                                                 #? true
    tLoad.free
    <a href="#robo107">_</a> onError warn+return
    <a href="#robo16">CFG</a> tCLI
    tCLI.bind.cli                                                                   #? $_bashlyk_iErrorMissingArgument
    tCLI.bind.cli file{F}: exec{E}:- main-hint{H}: main-msg{M}: unify{U}:=          #? $_bashlyk_iErrorInvalidOption
    tCLI.bind.cli file{F}: exec{E}:- main-hint{H}: main-msg{M}: unify{U}:= acc:+    #? true
    tCLI.storage.use $cfg
    tCLI.load file,main,child [exec]- [main]hint,msg,cnt [replace]- [unify]= [acc]+ #? true
    tCLI.show                                                                       | {{{

    child    =    true
     file    =    CLI
     main    =    false


    [ exec ]:

    clear

    :[ exec ]


    [ main ]

       cnt    =    80
      hint    =    Hi!
    iXo Xo    =    19
       msg    =    test


    [ replace ]

    after replacing


    [ unify ]

    a.2
    *.bak
    *.lit
    *.tmp
    *.xxx


    [ acc ]

    *.bak
    *.tmp
    *.bak
    *.tmp
    *.com
    *.exe
    *.jpg
    *.png
    *.mp3
    *.dll
    *.asp
    with white spaces
    b

 }}}
    tCLI.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::bind.cli</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a a
  local c fnErr fmtCase fmtHandler k o rc sSection sShort sLong s S evalGetopts sCases v

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>
  c<span class="sign">=</span>cli<span class="sign">$</span><span class="sign">{</span>RANDOM<span class="sign">}</span>

  <a href="#robo16">CFG</a> <span class="sign">$</span>c
  eval <span class="quote">"_h${o^^}[__cli__]=$c"</span>

  fmtHandler<span class="sign">=</span><span class="squote">'
    while true; do
      case "$1" in
        %s --) shift; break;;
            *) <a href="#robo83">err::debug</a> 0 "$0: invalid option -- '</span><span class="sign">$</span>1<span class="squote">'"; break;;
      esac;
    done\n
  '</span>

  fmtCase<span class="sign">=</span><span class="quote">"--%s%s) ${c}.set [%s]%s = %s; shift %s;;"</span>

  for s in <span class="sign">$</span><span class="sign">@</span><span class="sign">;</span> do

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">(</span><span class="sign">(</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alnum<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">+</span><span class="sign">)</span><span class="sign">(</span><span class="sign">-</span><span class="sign">)</span><span class="sign">)</span><span class="sign">?</span><span class="sign">(</span><span class="sign">@</span><span class="sign">|</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alnum<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">+</span><span class="sign">)</span><span class="sign">(</span><span class="sign">\</span><span class="sign">{</span><span class="sign">(</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alnum<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">)</span><span class="sign">\</span><span class="sign">}</span><span class="sign">)</span><span class="sign">?</span><span class="sign">(</span><span class="sign">[</span><span class="sign">:</span><span class="sign">]</span><span class="sign">)</span><span class="sign">?</span><span class="sign">(</span><span class="sign">[</span><span class="sign">:</span><span class="sign">=</span><span class="sign">\</span><span class="sign">+</span><span class="sign">\</span><span class="sign">-</span><span class="sign">]</span><span class="sign">)</span><span class="sign">?</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> declare <span class="sign">-</span>p BASH_REMATCH <span class="sign">)</span>
      <span class="sign">#</span><span class="sign">#</span> p<span class="sign">.</span> BASH_REMATCH is no longer readonly<span class="sign">.</span> <span class="sign">-</span> from bash<span class="sign">-</span>5<span class="sign">.</span>1<span class="sign">-</span>alpha to bash<span class="sign">-</span>5<span class="sign">.</span>1<span class="sign">-</span>beta <span class="sign">-</span> fix for <span class="sign">#</span>eval <span class="quote">"${s/-ar BASH_REMATCH/-a a}"</span>
      eval <span class="quote">"declare -a a=${s#*=}"</span>

    else

      error InvalidArgument <span class="sign">$</span>s <span class="sign">-</span> format error

    fi

    s<span class="sign">=</span><span class="sign">;</span>S<span class="sign">=</span><span class="sign">;</span>v<span class="sign">=</span>1<span class="sign">;</span>sSection<span class="sign">=</span><span class="quote">"${a[2]}"</span><span class="sign">;</span>k<span class="sign">=</span><span class="quote">"${a[4]}"</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>4<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sLong<span class="sign">+</span><span class="sign">=</span><span class="quote">"${a[1]}${a[4]}${a[7]},"</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>6<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sShort<span class="sign">+</span><span class="sign">=</span><span class="quote">"${a[6]}${a[7]}"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"|-${a[6]}"</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>7<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> S<span class="sign">=</span><span class="quote">"2"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> v<span class="sign">=</span><span class="squote">'$( <a href="#robo128">std::whitespace.decode</a> - &lt;&lt;&lt; $2 )'</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>8<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">=</span><span class="sign">|</span><span class="sign">\</span><span class="sign">-</span><span class="sign">|</span><span class="sign">\</span><span class="sign">+</span><span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> k<span class="sign">=</span><span class="quote">"${a[8]}"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sSection<span class="sign">=</span><span class="quote">"${a[4]}"</span>

    sCases<span class="sign">+</span><span class="sign">=</span><span class="quote">"$(                                                                  \
                                                                                 \
      printf -- "</span><span class="sign">$</span>fmtCase<span class="quote">" "</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>4<span class="sign">]</span><span class="sign">}</span><span class="quote">" "</span><span class="sign">$</span>s<span class="quote">" "</span><span class="sign">$</span>sSection<span class="quote">" "</span><span class="sign">$</span><span class="sign">{</span>k<span class="sign">/</span><span class="sign">=</span><span class="sign">/</span><span class="sign">}</span><span class="quote">" "</span><span class="sign">$</span>v<span class="quote">" "</span><span class="sign">$</span>S<span class="quote">" \
                                                                                 \
    ) "</span>

  done

  <a href="#robo125">std::temp</a> fnErr

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sShort <span class="sign">|</span><span class="sign">|</span> <span class="sign">$</span>sLong <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sShort <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sShort<span class="sign">=</span><span class="quote">"-o ${sShort}"</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sLong  <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span>  sLong<span class="sign">=</span><span class="quote">"-l ${sLong%*,}"</span>

    S<span class="sign">=</span><span class="quote">""</span>
    for s in <span class="quote">"${_bashlyk_aArg[@]}"</span><span class="sign">;</span>do S<span class="sign">+</span><span class="sign">=</span><span class="quote">"$( <a href="#robo129">std::whitespace.encode</a> $s ) "</span><span class="sign">;</span> done

    s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> LC_ALL<span class="sign">=</span>C getopt <span class="sign">-</span>u <span class="sign">$</span>sShort <span class="sign">$</span>sLong <span class="sign">-</span>n <span class="sign">$</span>0 <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span><span class="sign">{</span>S<span class="sign">%</span><span class="sign">*</span> <span class="sign">}</span> 2<span class="sign">&gt;</span><span class="sign">$</span>fnErr <span class="sign">)</span>
    rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  else

    error MissingArgument warn<span class="sign">+</span>return <span class="sign">-</span><span class="sign">-</span> cli options not found<span class="sign">.</span><span class="sign">.</span>
    rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  fi

  if <span class="sign">(</span><span class="sign">(</span> rc <span class="sign">=</span><span class="sign">=</span> 0 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    evalGetopts<span class="sign">=</span><span class="quote">"$( printf -- "</span><span class="sign">$</span>fmtHandler<span class="quote">" "</span><span class="sign">$</span>sCases<span class="quote">" )"</span>
    eval set <span class="sign">-</span><span class="sign">-</span> <span class="quote">"$s"</span>
    eval <span class="quote">"$evalGetopts"</span> 2<span class="sign">&gt;</span><span class="sign">$</span>fnErr
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span>fnErr <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rc<span class="sign">=</span>1

  fi

  case <span class="sign">$</span>rc in

    0<span class="sign">)</span> <span class="sign">:</span>
    <span class="sign">;</span><span class="sign">;</span>

    1<span class="sign">)</span>

      local <span class="sign">-</span>A h
      while read <span class="sign">-</span>t 4 s<span class="sign">;</span> do

        s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">/</span><span class="sign">/</span><span class="sign">$</span>0<span class="sign">:</span> <span class="sign">/</span><span class="sign">}</span>
        s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">/</span><span class="sign">/</span> option<span class="sign">/</span><span class="sign">}</span>
        s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">/</span><span class="sign">/</span> <span class="sign">-</span><span class="sign">-</span><span class="sign">/</span><span class="sign">}</span>
        h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">%</span> <span class="sign">*</span><span class="sign">}</span><span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">"${s##* },"</span>

      done <span class="sign">&lt;</span> <span class="sign">$</span>fnErr

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>h<span class="sign">[</span>invalid<span class="sign">]</span><span class="sign">}</span>      <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">+</span><span class="sign">=</span><span class="quote">"${h[invalid]%*,},"</span>
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>h<span class="sign">[</span>unrecognized<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">+</span><span class="sign">=</span><span class="quote">"${h[unrecognized]%*,}"</span>

      unset h
      error InvalidOption warn<span class="sign">+</span>return <span class="sign">$</span><span class="sign">{</span>s<span class="sign">%</span><span class="sign">*</span><span class="sign">,</span><span class="sign">}</span> <span class="quote">"( command line: "</span><span class="sign">$</span>S<span class="quote">" )"</span>
    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
      error <span class="sign">$</span>rc <span class="sign">-</span><span class="sign">-</span> internal fail <span class="sign">-</span> <span class="sign">$</span><span class="sign">(</span> <span class="sign">&lt;</span> <span class="sign">$</span>fnErr <span class="sign">)</span>
    <span class="sign">;</span><span class="sign">;</span>

  esac

<span class="sign">}</span>
</pre>
<a name="robo18"></a>
<a name="libcfg2fCFG3a3afree"></a>
<h2>2.5.  libcfg/CFG::free [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::free</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    destructor of the instance
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local i o s
    <a href="#robo16">CFG</a> tFree
    tFree.__section.select
    tFree.__section.select sFree
    o=$( tFree.__section.id @ )
    tFree.free                                                                 #? true
    i=0                                                                        #-
    for s in $o; do                                                            #-
      declare -pA $s &gt;/dev/null 2&gt;&amp;1; i=$(( i + $? ))                          #-
    done                                                                       #-
    (( i == 3 ))                                                               #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::free</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local o s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  for s in <span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>id <span class="sign">@</span> <span class="sign">)</span><span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>blank<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue <span class="sign">|</span><span class="sign">|</span> unset <span class="sign">-</span>v <span class="sign">$</span>s

  done

  unset <span class="sign">-</span>v _a<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span>
  unset <span class="sign">-</span>v _h<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span>
  unset <span class="sign">-</span>v _h<span class="sign">$</span><span class="sign">{</span>o<span class="sign">^</span><span class="sign">^</span><span class="sign">}</span>_settings

  for s in __section<span class="sign">.</span>get __section<span class="sign">.</span>set <span class="sign">$</span>_bashlyk_methods_cfg<span class="sign">;</span> do

    unset <span class="sign">-</span>f <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span><span class="sign">$</span>s

  done

<span class="sign">}</span>
</pre>
<a name="robo19"></a>
<a name="libcfg2fCFG3a3aget"></a>
<h2>2.6.  libcfg/CFG::get [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::get</strong> [\[&lt;section&gt;\]]&lt;key&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get single value for a key or serialized array of the "raw" records for
    specified section
</pre>
<p class="item_name">SEE ALSO</p>
<pre>    <a href="#robo46">CFG::__section.getArray</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - specified section, default - unnamed global
    &lt;key&gt;     - named key for "key=value" pair of the input data. For unnamed
                records this argument must be supressed, this cases return
                serialized array of the records (see <a href="#robo46">CFG::__section.getArray</a>)
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments not found
    InvalidArgument - expected like a '[section]key', '[]key' or 'key'
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local -a a
    <a href="#robo16">CFG</a> tGet
    tGet.__section.select
    tGet.__section.set key "is unnamed section"
    tGet.__section.select section
    tGet.__section.set "key with spaces" "is value"
    tGet.get [section] key with spaces                                         | {{ '^is value$'           }}
    tGet.get           key                                                     | {{ '^is unnamed section$' }}
    tGet.get []key                                                             | {{ '^is unnamed section$' }}
    tGet.__section.select accumu
    tGet.__section.set _bashlyk_raw_num 3
    tGet.__section.set _bashlyk_raw_incr=0 "is raw value No.1"
    tGet.__section.set _bashlyk_raw_incr=1 "is raw value No.2"
    tGet.__section.set _bashlyk_raw_incr=2 "is raw value No.3"
    tGet.__section.select unique
    tGet.__section.set _bashlyk_raw_mode =
    tGet.__section.set _bashlyk_raw_uniq=a1 "is raw value No.1"
    tGet.__section.set _bashlyk_raw_uniq=b2 "is raw value No.2"
    tGet.__section.set _bashlyk_raw_uniq=a1 "is raw value No.3"
    tGet.get [a][b]                                                            #? $_bashlyk_iErrorInvalidArgument
    tGet.get [section]unexpected key                                           #? $_bashlyk_iErrorEmptyResult
    eval "$(tGet.get [accumu])"
    echo "3 item expected"
    (( ${#a[@]} == 3 ))                                                        #? true
    eval "$(tGet.get [unique])"
    echo "2 item expected"
    (( ${#a[@]} == 2 ))                                                        #? true
    tGet.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::get</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>a a
  local IFS o k s<span class="sign">=</span><span class="quote">"$*"</span> v

  IFS<span class="sign">=</span><span class="squote">'[]'</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>s <span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  case <span class="quote">"${#a[@]}"</span> in

    3<span class="sign">)</span>
      s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">:</span><span class="sign">-</span>__global__<span class="sign">}</span>
      k<span class="sign">=</span><span class="quote">"${a[2]:-_bashlyk_raw}"</span>
      <span class="sign">;</span><span class="sign">;</span>

    2<span class="sign">)</span>
      s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">:</span><span class="sign">-</span>__global__<span class="sign">}</span>
      k<span class="sign">=</span>_bashlyk_raw
      <span class="sign">;</span><span class="sign">;</span>

    1<span class="sign">)</span>
      s<span class="sign">=</span>__global__
      k<span class="sign">=</span><span class="quote">"${a[0]:-_bashlyk_raw}"</span>
      <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
      error InvalidArgument warn<span class="sign">+</span>return <span class="sign">$</span><span class="sign">*</span>
      <span class="sign">;</span><span class="sign">;</span>

  esac

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>k <span class="sign">=</span><span class="sign">~</span> _bashlyk_raw <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>getArray <span class="sign">$</span>s

  else

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span>s
    s<span class="sign">=</span><span class="quote">"$( ${o}.__section.get $( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span>k<span class="quote">" ) )"</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> echo <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorEmptyResult

  fi

<span class="sign">}</span>
</pre>
<a name="robo20"></a>
<a name="libcfg2fCFG3a3agetopt"></a>
<h2>2.7.  libcfg/CFG::getopt [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::getopt</strong> &lt;option&gt;[--]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get option value after binding command line options to the <a href="#robo16">CFG</a> instance
    ( it makes sense only after the execution of the method "<a href="#robo17">CFG::bind.cli</a>" )
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;option&gt; - option name that used as long option of the CLI and key for
               array of the <a href="#robo16">CFG</a> data
          -- - expected list of the values - serialized array
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments is not specified
    InvalidArgument - invalid format of the arguments
    EmptyResult     - option not found
    NotAvailable    - CLI object not exist ( &lt;o&gt;.bind.cli not runned )
</pre>
<p class="item_name">OUTPUT</p>
<pre>    option value
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    _bashlyk_aArg=( -F CLI -E clear -H 'Hi!' -M test -U a.2 -U a.2 )           #-
    <a href="#robo16">CFG</a> tOpt
    tOpt.getopt                                                                #? $_bashlyk_iErrorMissingArgument
    tOpt.getopt not-exist                                                      #? $_bashlyk_iErrorNotAvailable
    tOpt.getopt invalid - argument - list                                      #? $_bashlyk_iErrorInvalidArgument
    tOpt.bind.cli file{F}: exec{E}:- main-hint{H}: main-msg{M}: unify{U}:=     #? true
    tOpt.getopt file                                                           #? true
    tOpt.getopt exec--                                                         #? true
    tOpt.getopt main-hint                                                      #? true
    tOpt.getopt main-msg                                                       #? true
    tOpt.getopt unify--                                                        #? true
    tOpt.getopt acc                                                            #? $_bashlyk_iErrorEmptyResult
    tOpt.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::getopt</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a a
  local IFS o s<span class="sign">=</span><span class="quote">"$*"</span>

  IFS<span class="sign">=</span><span class="squote">'-'</span> a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>s <span class="sign">)</span>

  case <span class="quote">"${#a[@]}"</span> in

    2<span class="sign">)</span>
      s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">:</span><span class="sign">-</span>__global__<span class="sign">}</span>
      k<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>
    <span class="sign">;</span><span class="sign">;</span>

    1<span class="sign">)</span>
      s<span class="sign">=</span>__global__
      k<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span>
    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
      errorify on MissingArgument <span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> return
      return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidArgument <span class="sign">)</span>
    <span class="sign">;</span><span class="sign">;</span>

  esac

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>
  eval <span class="quote">"o=\${_h${o^^}[__cli__]}"</span>

  errorify on EmptyVariable o <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorNotAvailable <span class="sign">)</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>get <span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">]</span><span class="sign">$</span><span class="sign">{</span>k<span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo21"></a>
<a name="libcfg2fCFG3a3akeys"></a>
<h2>2.8.  libcfg/CFG::keys [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::keys</strong> [\[&lt;section&gt;\]]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Show all the keys of the selected section in a row, separated by commas.
    For the section of the "raw data" (without keys) will be shown the storage
    mode.
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - specified section, default - unnamed global
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - expected like a '[section]key', '[]key' or 'key'
</pre>
<p class="item_name">TODO</p>
<pre>    third argument - IFS
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tKeys
    tKeys.set  [section1] 1key = is value 1
    tKeys.set  [section1] 2key = is value 2
    tKeys.set  [section1] 3key with spaces = is value 3
    tKeys.set  Akey = is value A
    tKeys.set  []Bkey = is value B
    tKeys.set  Ckey with spaces = is value C
    tKeys.set  [section2] += save value
    tKeys.set  [section2] += save value
    tKeys.set  [section3] -= save value No.2
    tKeys.set  [section3] -= save value No.1
    tKeys.set  [section4] = save unique value No.2
    tKeys.set  [section4] = save unique value No.1
    tKeys.keys | sort                                                          | {{{
    Akey
    Bkey
    Ckey with spaces
 }}}
    tKeys.keys [section1] | sort                                               | {{{
    1key
    2key
    3key with spaces
 }}}
    tKeys.keys [section2]                                                      | {{ ^+$ }}
    tKeys.keys [section3]                                                      | {{ ^-$ }}
    tKeys.keys [section4]                                                      | {{ ^=$ }}
    tKeys.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::keys</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a a
  local IFS o k s<span class="sign">=</span><span class="quote">"$*"</span>

  IFS<span class="sign">=</span><span class="squote">'[]'</span> a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>s <span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  case <span class="quote">"${#a[@]}"</span> in

    2<span class="sign">)</span>
      s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">:</span><span class="sign">-</span>__global__<span class="sign">}</span>
    <span class="sign">;</span><span class="sign">;</span>

    0<span class="sign">)</span>
      s<span class="sign">=</span>__global__
    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
      error InvalidArgument warn<span class="sign">+</span>return <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>
    <span class="sign">;</span><span class="sign">;</span>

  esac

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span>s
  id<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>id <span class="sign">$</span>s <span class="sign">)</span>
  sU<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_mode <span class="sign">)</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sU <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"$sU"</span>

  else

    eval <span class="quote">"                                                                     \
                                                                               \
      for k in \"\${!$id[@]}\"; do                                             \
        if [[ ! \$k =~ ^_bashlyk_ ]]; then                                     \
          printf -- '%s\n' \"\$k\";                                            \
        fi                                                                     \
      done;                                                                    \
                                                                               \
    "</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo22"></a>
<a name="libcfg2fCFG3a3akeys2eeach"></a>
<h2>2.9.  libcfg/CFG::keys.each [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::keys.each</strong> [\[&lt;section&gt;\]] &lt;function wrapper&gt; | -- '&lt;command stream&gt;'
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Apply single quoted sequence of the command (or wrapper-function) foreach
    key as '$1' and/or value as '$2' of the selected section.
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt;        - specified section, default - unnamed global
    &lt;command stream&gt; - single quoted sequence of the command (separated by ';')
                       what applied for all non empty values of a &lt;section&gt;.
    &lt;function&gt;       - predefined function as wrapper for command stream
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - expected like a "[section] '...'", "[] '...'" or "'...'"
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local i=0
    <a href="#robo16">CFG</a> tKeysEach
    tKeysEach.set  [section1] 1key = 11
    tKeysEach.set  [section1] 2key = 23
    tKeysEach.set  [section1] 3key with spaces = 47
    tKeysEach.keys.each [section1] -- '
      i=$((i+$2))
      date -R
    '
    echo $i                                                                    | {{ 81 }}
    i=0
    tKeysEach.set  [section1] 4key = 18
    tKeysEach.keys.each [section1] -- 'i=$((i+$2));date -R'
    echo $i                                                                    | {{ 99 }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::keys.each</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bashlyk_cfg_keys_each_b IFS bashlyk_cfg_keys_each_f bashlyk_cfg_keys_each_k
  local bashlyk_cfg_keys_each_s0 bashlyk_cfg_keys_each_s1 bashlyk_cfg_keys_each_v
  local <span class="sign">-</span>a bashlyk_cfg_keys_each_a

  bashlyk_cfg_keys_each_s1<span class="sign">=</span><span class="quote">"$*"</span>
  bashlyk_cfg_keys_each_s0<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_s1<span class="sign">%</span><span class="sign">%</span><span class="sign">-</span><span class="sign">-</span><span class="sign">*</span><span class="sign">}</span>
  bashlyk_cfg_keys_each_s1<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_s1<span class="sign">#</span><span class="sign">*</span><span class="sign">-</span><span class="sign">-</span><span class="sign">}</span>

  IFS<span class="sign">=</span><span class="squote">'[]'</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> bashlyk_cfg_keys_each_a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>bashlyk_cfg_keys_each_s0 <span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  case <span class="quote">"${#bashlyk_cfg_keys_each_a[@]}"</span> in

    3<span class="sign">)</span>
      bashlyk_cfg_keys_each_s<span class="sign">=</span><span class="quote">"[${bashlyk_cfg_keys_each_a[1]}]"</span>
      bashlyk_cfg_keys_each_b<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_a<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span><span class="quote">" )"</span>
      <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_b<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span>bashlyk_cfg_keys_each_s1<span class="sign">}</span>
      <span class="sign">;</span><span class="sign">;</span>

    1<span class="sign">)</span>
      bashlyk_cfg_keys_each_s<span class="sign">=</span><span class="squote">'[]'</span>
      bashlyk_cfg_keys_each_b<span class="sign">=</span><span class="quote">"${bashlyk_cfg_keys_each_a[0]:=_bashlyk_raw_mode}"</span>
      <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
      error InvalidArgument warn<span class="sign">+</span>return <span class="sign">$</span><span class="sign">*</span>
      <span class="sign">;</span><span class="sign">;</span>

  esac

  <a href="#robo83">err::debug</a> 5 argument <span class="sign">$</span>bashlyk_cfg_keys_each_b

  if <span class="sign">$</span><span class="sign">(</span> eval <span class="squote">'typeset -F $bashlyk_cfg_keys_each_b &gt;/dev/null 2&gt;&amp;1'</span> <span class="sign">)</span><span class="sign">;</span> then

    bashlyk_cfg_keys_each_f<span class="sign">=</span><span class="quote">"$bashlyk_cfg_keys_each_b"</span>

  else

    bashlyk_cfg_keys_each_f<span class="sign">=</span><span class="quote">"__${FUNCNAME[0]}__internal"</span>
    eval <span class="quote">"$( printf -- "</span><span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_f<span class="sign">}</span><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span><span class="sign">\</span>n <span class="sign">$</span><span class="sign">{</span>bashlyk_cfg_keys_each_b<span class="sign">}</span> <span class="sign">\</span>n<span class="sign">}</span><span class="sign">\</span>n<span class="quote">" )"</span>

  fi

  <a href="#robo83">err::debug</a> 5 callback function<span class="sign">:</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> declare <span class="sign">-</span>f <span class="sign">$</span>bashlyk_cfg_keys_each_f

  while read bashlyk_cfg_keys_each_k<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>bashlyk_cfg_keys_each_k <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue

    bashlyk_cfg_keys_each_v<span class="sign">=</span><span class="quote">"$( ${FUNCNAME[0]%%.*}.get ${bashlyk_cfg_keys_each_s}${bashlyk_cfg_keys_each_k} )"</span>
    <span class="sign">$</span>bashlyk_cfg_keys_each_f <span class="quote">"$bashlyk_cfg_keys_each_k"</span> <span class="quote">"$bashlyk_cfg_keys_each_v"</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span> <span class="sign">$</span>bashlyk_cfg_keys_each_s <span class="sign">|</span> sort <span class="sign">)</span>

  unset <span class="sign">-</span>f <span class="sign">$</span>bashlyk_cfg_keys_each_f

<span class="sign">}</span>
</pre>
<a name="robo23"></a>
<a name="libcfg2fCFG3a3aload"></a>
<h2>2.10.  libcfg/CFG::load [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::load</strong> [\[&lt;section&gt;\]](&lt;options&gt;|&lt;raw mode&gt;)[,] ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    load the specified configuration data from a group of related files
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt;  - section name, by default is empty for global section
    &lt;options&gt;  - comma separated list of the options for loading. Required or
                 replaced by &lt;raw mode&gt; argument
    &lt;raw mode&gt; - specifiers '-=+' define the section of the store as a list of
                 the "raw" data (without keys):
                 - - replace early load data of the section
                 + - add data to the early loaded data of the section
                 = - add only unique data of the early loaded data
</pre>
<p class="item_name">NOTES</p>
<pre>    configuration sources are ignored if they do not owned by the owner of the
    process or root.
</pre>
<p class="item_name">ERRORS</p>
<pre>    NoSuchFileOrDir - input file not exist
    MissingArgument - parameters and sections are not selected
</pre>
<p class="item_name">EXAMPLE</p>
<pre>   local iniMain iniLoad iniSave                                               #-
   <a href="#robo125">std::temp</a> -v iniMain suffix=.ini                                            #-
   GLOBIGNORE="*:?"                                                            #-
    cat &lt;&lt;-'EOFini' &gt; $iniMain                                                 #-
    section  =  global                                                         #-
    file     =  main                                                           #-
    main     =  true                                                           #-
    TZ=UTC date -R --date='@12345678'                                          #-
    sUname="$(uname -a)"                                                       #-
    if [[ $HOSTNAME ]]; then                                                   #-
         export HOSTNAME=$(hostname)                                           #-
    fi                                                                         #-
    hint   =  $(date -R)                                                       #-
    msg    =  file main                                                        #-
    iXo Xo =  19                                                               #-
    cnt    =  66                                                               #-
    ~simple line~                                                              #-
    before replacing                                                           #-
    *.bak                                                                      #-
    *.tmp                                                                      #-
    *.bak                                                                      #-
    *.tmp                                                                      #-
                                                                               #-
    EOFini                                                                     #-
    iniLoad="${iniMain%/*}/child.${iniMain##*/}"                               #-
    iniSave="${iniMain%/*}/write.${iniMain##*/}"                               #-
    <a href="#robo39">pid::onExit.unlink</a> $iniLoad                                                #-
    <a href="#robo39">pid::onExit.unlink</a> $iniSave                                                #-
    cat &lt;&lt;-'EOFiniChild' &gt; $iniLoad                                            #-
    section  =  global                                                         #-
    file     =  child                                                          #-
    main     =  false                                                          #-
    child    =  true                                                           #-
    TZ=UTC date -R --date='@12345679'                                          #-
    sUname="$(uname)"                                                          #-
    if [[ $HOSTNAME ]]; then                                                   #-
         export HOSTNAME=$(hostname -f)                                        #-
    fi                                                                         #-
    echo $sUname                                                               #-
    hint   =  $(date "+%s") more = equals =                                    #-
    msg    =  child file                                                       #-
    iXo Xo =  19                                                               #-
    cnt    =  80                                                               #-
    simple line                                                                #-
    after replacing                                                            #-
    *.xxx                                                                      #-
    *.tmp                                                                      #-
    test by test                                                               #-
    a = b                                                                      #-
    *.bak                                                                      #-
    *.tmp                                                                      #-
    *.com                                                                      #-
    *.exe                                                                      #-
    *.jpg                                                                      #-
    *.png                                                                      #-
    *.mp3                                                                      #-
    *.dll                                                                      #-
    *.asp                                                                      #-
    *.xxx                                                                      #-
    *.lit                                                                      #-
    EOFiniChild                                                                #-
   <a href="#robo16">CFG</a> tLoad
   ## TODO add more tests
   tLoad.storage.use $iniLoad
   tLoad.load []file,main,child [exec]- [main]hint, msg, cnt [replace]- [unify]= [acc]+ #? true
   tLoad.save $iniSave                                                         #? true
   tLoad.storage.use $iniSave
   tLoad.show                                                                  | {{{

       child    =    true
        file    =    child
        main    =    false


   [ exec ]:

   TZ=UTC date -R --date='@12345679'
   sUname="$(uname)"
   if [[ $HOSTNAME ]]; then
   export HOSTNAME=$(hostname -f)
   fi
   echo $sUname

   :[ exec ]


   [ main ]

          cnt    =    80
         hint    =    $(date "+%s") more = equals =
       iXo Xo    =    19
          msg    =    child file


   [ replace ]

   after replacing


   [ unify ]

   *.bak
   *.lit
   *.tmp
   *.xxx


   [ acc ]

   *.bak
   *.tmp
   *.bak
   *.tmp
   *.com
   *.exe
   *.jpg
   *.png
   *.mp3
   *.dll
   *.asp

 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::load</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a a
  local <span class="sign">-</span>A h hKeyValue hRawMode
  local cfg csv i IFS fmtPairs fmtSections o path reSection reValidSections s
  local sSection

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  cfg<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span>

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use
    cfg<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span>

  <span class="sign">}</span>

  path<span class="sign">=</span><span class="quote">"${cfg%/*}/"</span>
   cfg<span class="sign">=</span><span class="quote">"${cfg##*/}"</span>

  fmtSections<span class="sign">=</span><span class="squote">'^[[:space:]]*(:?)\[[[:space:]]*(%SECTION%)[[:space:]]*\](:?)[[:space:]]*$'</span>

  fmtPairs<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings fmtPairs <span class="sign">)</span>

  <span class="sign">#</span>
  <span class="sign">#</span> Internal temporary function into <strong>CFG::load</strong> namespace
  <span class="sign">#</span>
  <a href="#robo16">CFG</a><span class="sign">:</span><span class="sign">:</span>load<span class="sign">:</span><span class="sign">:</span>parse<span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

    local s sSection

    sSection<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <a href="#robo126">std::trim</a> <span class="sign">$</span><span class="sign">{</span>1<span class="sign">:</span><span class="sign">-</span>__global__<span class="sign">}</span> <span class="sign">)</span>
    s<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span><span class="sign">{</span>2<span class="sign">/</span><span class="sign">/</span><span class="sign">,</span><span class="sign">[</span><span class="sign">,</span> <span class="sign">]</span><span class="sign">/</span><span class="sign">,</span><span class="sign">}</span><span class="quote">" )"</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">=</span><span class="sign">+</span><span class="sign">\</span><span class="sign">-</span><span class="sign">]</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      hRawMode<span class="sign">[</span><span class="sign">$</span>sSection<span class="sign">]</span><span class="sign">=</span><span class="quote">"${s//,/\|}"</span>

    else

      hKeyValue<span class="sign">[</span><span class="sign">$</span>sSection<span class="sign">]</span><span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>fmtPairs<span class="sign">/</span><span class="sign">\</span><span class="sign">%</span>KEY<span class="sign">\</span><span class="sign">%</span><span class="sign">/</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">/</span><span class="sign">/</span><span class="sign">,</span><span class="sign">/</span><span class="sign">\</span><span class="sign">|</span><span class="sign">}</span><span class="sign">}</span>

    fi

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span>sSection
    csv<span class="sign">+</span><span class="sign">=</span><span class="quote">"${sSection}|"</span>

  <span class="sign">}</span>
  <span class="sign">#</span>
  <span class="sign">#</span> end <a href="#robo16">CFG</a><span class="sign">:</span><span class="sign">:</span>load<span class="sign">:</span><span class="sign">:</span>parse
  <span class="sign">#</span>

  s<span class="sign">=</span><span class="sign">$</span><span class="sign">*</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> IFS<span class="sign">=</span><span class="squote">']['</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>s <span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo16">CFG</a><span class="sign">:</span><span class="sign">:</span>load<span class="sign">:</span><span class="sign">:</span>parse <span class="quote">""</span> <span class="quote">"${a[0]}"</span>

  for <span class="sign">(</span><span class="sign">(</span> i<span class="sign">=</span>1<span class="sign">;</span> i <span class="sign">&lt;</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">;</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    <a href="#robo16">CFG</a><span class="sign">:</span><span class="sign">:</span>load<span class="sign">:</span><span class="sign">:</span>parse <span class="quote">"${a[$i]}"</span> <span class="quote">"${a[$i+1]}"</span>

    i<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">+</span>1 <span class="sign">)</span><span class="sign">)</span>

  done

  unset <span class="sign">-</span>f <a href="#robo16">CFG</a><span class="sign">:</span><span class="sign">:</span>load<span class="sign">:</span><span class="sign">:</span>parse

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>cfg <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">\</span><span class="sign">.</span><span class="sign">)</span><span class="sign">?</span><span class="sign">(</span><span class="sign">.</span><span class="sign">*</span><span class="sign">[</span><span class="sign">^</span><span class="sign">.</span><span class="sign">]</span><span class="sign">)</span><span class="sign">(</span><span class="sign">\</span><span class="sign">.</span><span class="sign">)</span><span class="sign">?</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>2<span class="sign">]</span><span class="sign">/</span><span class="sign">/</span><span class="sign">.</span><span class="sign">/</span> <span class="sign">}</span> <span class="sign">)</span>
     a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">=</span><span class="quote">"${BASH_REMATCH[1]}${a[0]}"</span>
    a<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">-</span>1<span class="sign">]</span><span class="sign">=</span><span class="quote">"${a[${#a[@]}-1]}${BASH_REMATCH[3]}"</span>

  fi

  csv<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>csv<span class="sign">%</span><span class="sign">*</span><span class="sign">|</span><span class="sign">}</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>csv <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> reValidSections<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>fmtSections<span class="sign">/</span><span class="sign">\</span><span class="sign">%</span>SECTION<span class="sign">\</span><span class="sign">%</span><span class="sign">/</span><span class="sign">$</span>csv<span class="sign">}</span>

  unset cfg s

  for <span class="sign">(</span><span class="sign">(</span> i <span class="sign">=</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">-</span>1<span class="sign">;</span> i <span class="sign">&gt;</span><span class="sign">=</span> 0<span class="sign">;</span> i<span class="sign">-</span><span class="sign">-</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>cfg    <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> cfg<span class="sign">=</span><span class="quote">"${a[i]}.${cfg}"</span> <span class="sign">|</span><span class="sign">|</span> cfg<span class="sign">=</span><span class="quote">"${a[i]}"</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"${path}${cfg}"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use <span class="sign">$</span><span class="sign">{</span>path<span class="sign">}</span><span class="sign">/</span><span class="sign">$</span><span class="sign">{</span>cfg<span class="sign">}</span>
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>read <span class="sign">$</span>reValidSections

    fi

  done

  eval <span class="quote">"s=\${_h${o^^}[__cli__]}"</span>
  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <a href="#robo125">std::temp</a> cfg

    <span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">.</span>save <span class="sign">$</span>cfg
    s<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span>
    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use <span class="sign">$</span>cfg
    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>read <span class="sign">$</span>reValidSections
    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use <span class="sign">$</span>s

    rm <span class="sign">-</span>f <span class="sign">$</span>cfg

  fi

  return 0

<span class="sign">}</span>
</pre>
<a name="robo24"></a>
<a name="libcfg2fCFG3a3aread"></a>
<h2>2.11.  libcfg/CFG::read [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::read</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Handling a configuration from the single file. Read valid "key=value"
    pairs and as bonus "active" sections data only
</pre>
<p class="item_name">ERRORS</p>
<pre>    NoSuchFileOrDir - input file not exist
    NotPermitted    - owner of the input file differ than owner of the process
</pre>
<p class="item_name">EXAMPLE</p>
<pre>   local ini s S
   <a href="#robo125">std::temp</a> ini suffix=".ini"
    cat &lt;&lt;'EOFini' &gt; ${ini}                                                    #-
    key              = on the global unnamed section                           #-
    key.with.dot     = with dot                                                #-
    key::with::colon = with colon                                              #-
                key = $(date -R)                                               #-
                   b=false                                                     #-
    key with spaces =  value with spaces                                       #-
                 iX =80                                                        #-
                  iY= 25                                                       #-
                  iZ=                                                          #-
        multi equal = value with equal ( = ), more = stop.                     #-
    simple line without "key value" pairs                                      #-
                                                                               #-
    TZ=UTC date -R --date='@12345678'                                          #-
    sUname="$(uname -a)"                                                       #-
    if [[ $HOSTNAME ]]; then                                                   #-
         export HOSTNAME=$(hostname)                                           #-
    fi                                                                         #-
    this is a line of the raw data                                             #-
    key = in the base mode                                                     #-
    key in = the base mode                                                     #-
    key in the = base mode                                                     #-
    *.bak                                                                      #-
    *.tmp                                                                      #-
    # this is a comment                                                        #-
    *.bak                                                                      #-
    *.tmp                                                                      #-
    key = in the base mode                                                     #-
    key in = the base mode                                                     #-
    key in the = base mode                                                     #-
    EOFini                                                                     #-
   <a href="#robo107">_</a> onError warn+return
   <a href="#robo16">CFG</a> tRead
   tRead.read                                                                  #? true
   tRead.storage.show
   tRead.storage.use $ini
   tRead.read                                                                  #? true
   tRead.show                                                                  | {{{

                    key    =    on the global unnamed section
       key::with::colon    =    with colon
           key.with.dot    =    with dot


   [ section with punct (!#%^&amp;*+=|?$) and spaces: 'Foo Bar' &lt;user@host.domain&gt; ]

                  b    =    false
                 iX    =    80
                 iY    =    25
                 iZ    =
                key    =    $(date -R)
    key with spaces    =    value with spaces
        multi equal    =    value with equal ( = ), more = stop.


   [ exec ]:

   TZ=UTC date -R --date='@12345678'
   sUname="$(uname -a)"
   if [[ $HOSTNAME ]]; then
     export HOSTNAME=$(hostname)
   fi

   :[ exec ]


   [ replace ]

              key    =    in the base mode
           key in    =    the base mode
       key in the    =    base mode


   [ section with raw data ]



   [ unify ]

              key    =    in the base mode
           key in    =    the base mode
       key in the    =    base mode

 }}}
   tRead.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::read</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bActiveSection bIgnore csv fn i iKeyWidth reComment reKeyVal reSection
  local reValidSections s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  fn<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span>

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use
    fn<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span>

  <span class="sign">}</span>

  errorify on NoSuchFileOrDir <span class="sign">$</span>fn <span class="sign">|</span><span class="sign">|</span> return

  reSection<span class="sign">=</span><span class="squote">'^[[:space:]]*(:?)\[[[:space:]]*([[:print:]]+?)[[:space:]]*\](:?)[[:space:]]*$'</span>
  reComment<span class="sign">=</span><span class="squote">'^[[:space:]]*$|(^|[[:space:]]+)[\#\;].*$'</span>

  reKeyVal<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings reKeyVal <span class="sign">)</span>

  s<span class="sign">=</span><span class="quote">"__global__"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> reValidSections<span class="sign">=</span><span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> reValidSections<span class="sign">=</span><span class="quote">"$reSection"</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hKeyValue<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> local <span class="sign">-</span>A hKeyValue
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hRawMode<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>  <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> local <span class="sign">-</span>A hRawMode

  <span class="sign">#</span><span class="sign">#</span> TODO permit hi uid <span class="sign">?</span>
  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c stat <span class="sign">-</span>c <span class="sign">%</span>u <span class="sign">$</span>fn <span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">$</span>UID<span class="sign">|</span>0<span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    error NotPermitted <span class="sign">$</span>fn owned by <span class="sign">$</span><span class="sign">(</span> stat <span class="sign">-</span>c <span class="sign">%</span>U <span class="sign">$</span>fn <span class="sign">)</span>

  fi

  bIgnore<span class="sign">=</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">=</span><span class="quote">"$reKeyVal"</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select
  iKeyWidth<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_key_width <span class="sign">)</span>
  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iKeyWidth <span class="sign">|</span><span class="sign">|</span> iKeyWidth<span class="sign">=</span>0

  while read <span class="sign">-</span>t 4<span class="sign">;</span> do

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>reSection <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <span class="sign">#</span><span class="sign">#</span> TODO section <span class="sign">=</span><span class="sign">~</span> <span class="sign">(</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>print<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">!</span><span class="sign">[</span><span class="sign">\</span><span class="sign">[</span><span class="sign">\</span><span class="sign">]</span><span class="sign">]</span><span class="sign">)</span>
      bIgnore<span class="sign">=</span>1
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>reValidSections <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
      bIgnore<span class="sign">=</span>

      <span class="sign">(</span><span class="sign">(</span> i <span class="sign">&gt;</span> 0   <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_raw_num <span class="sign">$</span>i
      <span class="sign">(</span><span class="sign">(</span> iKeyWidth <span class="sign">&gt;</span> 0 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_key_width <span class="sign">$</span>iKeyWidth

      s<span class="sign">=</span><span class="quote">"${BASH_REMATCH[2]}"</span>

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">":"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> bActiveSection<span class="sign">=</span>close
      <span class="sign">#</span><span class="sign">#</span> TODO other modes for active section <span class="sign">?</span>
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>3<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">":"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> hRawMode<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">=</span><span class="quote">"-"</span>

      bIgnore<span class="sign">=</span>1
      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>bActiveSection <span class="sign">=</span><span class="sign">=</span> <span class="quote">"close"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        bActiveSection<span class="sign">=</span>
        <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_raw_mode <span class="quote">"!"</span>
        continue

      fi
      bIgnore<span class="sign">=</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span>s
      i<span class="sign">=</span>0
      iKeyWidth<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_key_width <span class="sign">)</span>
      <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iKeyWidth <span class="sign">|</span><span class="sign">|</span> iKeyWidth<span class="sign">=</span>0

      case <span class="quote">"${hRawMode[$s]}"</span> in

        <span class="sign">-</span><span class="sign">)</span> <span class="sign">;</span><span class="sign">;</span>

        <span class="sign">+</span><span class="sign">)</span> i<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_num <span class="sign">)</span>
           <a href="#robo121">std::isNumber</a> <span class="sign">$</span>i <span class="sign">|</span><span class="sign">|</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_raw_num <span class="sign">$</span><span class="sign">{</span>i<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
           <span class="sign">;</span><span class="sign">;</span>

        <span class="sign">=</span><span class="sign">)</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_raw_mode <span class="quote">"="</span><span class="sign">;</span><span class="sign">;</span>

        <span class="sign">*</span><span class="sign">)</span> hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">=</span><span class="quote">"$reKeyVal"</span><span class="sign">;</span><span class="sign">;</span>

      esac

      continue

    else

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>reComment <span class="sign">|</span><span class="sign">|</span> <span class="sign">$</span>bIgnore <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue

    fi

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span><span class="sign">{</span>hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"${BASH_REMATCH[1]}"</span> <span class="quote">"${BASH_REMATCH[2]}"</span>
        <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">&gt;</span> <span class="sign">$</span>iKeyWidth <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> iKeyWidth<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>

      fi

    else

      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hRawMode<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"="</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        REPLY<span class="sign">=</span><span class="quote">"$( echo $REPLY )"</span>
        <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"_bashlyk_raw_uniq=${REPLY//[\'\"\\ ]/}"</span> <span class="quote">"$REPLY"</span>

      else

        <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"_bashlyk_raw_incr=${i:=0}"</span> <span class="quote">"$REPLY"</span>
        <span class="sign">:</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span>

      fi

    fi

  done <span class="sign">&lt;</span> <span class="sign">$</span>fn

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hRawMode<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">\</span><span class="sign">+</span><span class="sign">|</span><span class="sign">\</span><span class="sign">-</span><span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_raw_num <span class="sign">$</span><span class="sign">{</span>i<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>hKeyValue<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_key_width <span class="sign">$</span>iKeyWidth

  return 0

<span class="sign">}</span>
</pre>
<a name="robo25"></a>
<a name="libcfg2fCFG3a3asave"></a>
<h2>2.12.  libcfg/CFG::save [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::save</strong> [&lt;file&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Save the configuration to the specified file
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;file&gt;  - target file for saving, default specified by 'storage' method
</pre>
<p class="item_name">ERRORS</p>
<pre>    NotExistNotCreated - the target file is not created
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fn
    <a href="#robo125">std::temp</a> fn
    <a href="#robo39">pid::onExit.unlink</a> ${fn}.bak
    <a href="#robo16">CFG</a> tSave
    tSave.__section.select section
    tSave.__section.set key "is value"
    tSave.__section.select
    tSave.__section.set key "unnamed section"
    tSave.save $fn
    tSave.free
    tail -n +4 $fn                                                             | {{{

        key    =    unnamed section


    [ section ]

        key    =    is value

 }}}
    <a href="#robo16">CFG</a> tComments
    ## TODO globs
    tComments.settings chComment = \# this is comment';'
    tComments.save $fn
    cat $fn                                                                    | {{ -Po "^# this is comment; created .* by $USER" }}
    tComments.settings chComment =
    tComments.save $fn
    cat $fn                                                                    | {{ -Po "^# created .* by $USER" }}
    tComments.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::save</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local c fmtComment fn o s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> fn<span class="sign">=</span><span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> fn<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span>

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use
    fn<span class="sign">=</span><span class="quote">"$( ${o}.storage.show )"</span>

  <span class="sign">}</span>

  fmtComment<span class="sign">=</span><span class="squote">'%COMMENT%\n%COMMENT% created %s by %s\n%COMMENT%\n'</span>

  c<span class="sign">=</span><span class="quote">"$( ${o}.settings chComment )"</span>
  s<span class="sign">=</span><span class="quote">"$( ${o}.settings bSaveConfig )"</span>
  <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>c<span class="sign">:</span><span class="sign">=</span><span class="sign">#</span><span class="sign">}</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span>false<span class="sign">|</span>no<span class="sign">|</span>0<span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$fn"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> mv <span class="sign">-</span>f <span class="quote">"$fn"</span> <span class="quote">"${fn}.bak"</span>

  fi

  <span class="sign">#</span><span class="sign">#</span> TODO try <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use<span class="sign">.</span>default
  <span class="sign">(</span> mkdir <span class="sign">-</span>p <span class="quote">"${fn%/*}/"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> touch <span class="quote">"$fn"</span> <span class="sign">)</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1 <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated throw <span class="sign">$</span><span class="sign">{</span>fn<span class="sign">%</span><span class="sign">/</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">{</span>

    printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"${fmtComment//%COMMENT%/$c}"</span> <span class="quote">"$( <a href="#robo112">std::dateR</a> )"</span> <span class="quote">"$( <a href="#robo107">_</a> sUser )"</span>
    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>show

  <span class="sign">}</span> <span class="sign">&gt;</span> <span class="quote">"$fn"</span>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo26"></a>
<a name="libcfg2fCFG3a3aset"></a>
<h2>2.13.  libcfg/CFG::set [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::set</strong> [\[&lt;section&gt;\]]&lt;key&gt; = &lt;value&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    set a value to the specified key of the section
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - specified section, default - unnamed global
    &lt;key&gt;     - named key for "key=value" pair of the input data. For unnamed
                records this argument must be supressed or must have '-' '+'
                value, in this cases return serialized array of items
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments not found
    InvalidArgument - expected like a '[section]key = value', '[]key = value'
                      or 'key = value'
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local -a a
    <a href="#robo16">CFG</a> tSet
    tSet.set                                                                   #? $_bashlyk_iErrorMissingArgument
    tSet.set [section]key = is value
    tSet.set key = is unnamed section
    tSet.set key with spaces = is unnamed section
    tSet.show
    tSet.get [section]key                                                      | {{ '^is value$'           }}
    tSet.get   key                                                             | {{ '^is unnamed section$' }}
    tSet.get []key                                                             | {{ '^is unnamed section$' }}
    tSet.get key with spaces                                                   | {{ '^is unnamed section$' }}
    tSet.set [section1]+= is raw value No.1
    tSet.set [section1] += is raw value No.2
    tSet.set [section1]+  =   is raw value No.3
    tSet.set [section2]=save unique value No.1
    tSet.set [section2] =  save unique value No.2
    tSet.set [section2] =   save unique value No.1
    eval "$(tSet.get [section2])"
    for s in "${a[@]}"; do echo $s; done | sort                                | {{{
    save unique value No.1
    save unique value No.2
 }}}
    eval "$(tSet.get [section1])"
    for s in "${a[@]}"; do echo $s; done | sort                                | {{{
    is raw value No.1
    is raw value No.2
    is raw value No.3
 }}}
    tSet.free
    <a href="#robo107">_</a> onError return
    <a href="#robo16">CFG</a> InvalidInput
    InvalidInput.set Thu, 30 Jun 2016 08:55:36 +0400                           #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    InvalidInput.set [section] Thu, 30 Jun 2016 08:55:36 +0400                 #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    InvalidInput.set []key[ff] = value                                         #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    InvalidInput.set []key = value1
    InvalidInput.show                                                          | {{ -P 'key\s+?=\s+?value1' }}
    InvalidInput.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::set</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local iKeyWidth o k s v

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">\</span><span class="sign">[</span><span class="sign">[</span><span class="sign">^</span><span class="sign">]</span><span class="sign">\</span><span class="sign">[</span><span class="sign">]</span><span class="sign">*</span><span class="sign">\</span><span class="sign">]</span><span class="sign">)</span><span class="sign">?</span><span class="sign">(</span><span class="sign">[</span><span class="sign">^</span><span class="sign">]</span><span class="sign">=</span><span class="sign">\</span><span class="sign">[</span><span class="sign">]</span><span class="sign">*</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">?</span><span class="sign">=</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">?</span><span class="sign">(</span><span class="sign">.</span><span class="sign">*</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">?</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span>
  then

    s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>
    k<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span>
    v<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>3<span class="sign">]</span><span class="sign">}</span>

  else

    error InvalidArgument <span class="sign">$</span><span class="sign">*</span>
    return

  fi

  k<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span>k<span class="quote">" )"</span>
  s<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">%</span><span class="sign">]</span><span class="sign">*</span><span class="sign">}</span><span class="quote">" )"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>s<span class="sign">/</span><span class="sign">[</span><span class="sign">/</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <a href="#robo126">std::trim</a> <span class="quote">"${s/[/}"</span> <span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span>__global__

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>k<span class="sign">:</span><span class="sign">=</span><span class="sign">=</span><span class="sign">}</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span>s

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>k <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">=</span><span class="sign">|</span><span class="sign">\</span><span class="sign">-</span><span class="sign">|</span><span class="sign">\</span><span class="sign">+</span><span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>setRawData <span class="quote">"$k"</span> <span class="quote">"$v"</span>

  else

    iKeyWidth<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_key_width <span class="sign">)</span>
    <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iKeyWidth <span class="sign">|</span><span class="sign">|</span> iKeyWidth<span class="sign">=</span>0

    <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>k<span class="sign">}</span> <span class="sign">&gt;</span> iKeyWidth <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set _bashlyk_key_width <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>k<span class="sign">}</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>k <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings reKey <span class="sign">)</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"$k"</span> <span class="quote">"$v"</span>

    else

      <span class="sign">#</span><span class="sign">#</span> TODO get <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings chComment
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"#[!] - $( error IniExtraCharInKey echo 2&gt;&amp;1 ): $k"</span> <span class="quote">"$v"</span>

    fi

  fi

<span class="sign">}</span>
</pre>
<a name="robo27"></a>
<a name="libcfg2fCFG3a3ashow"></a>
<h2>2.14.  libcfg/CFG::show [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::show</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Show a instance data in the <a href="#robo16">CFG</a> format
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">OUTPUT</p>
<pre>    instance data in the <a href="#robo16">CFG</a> format
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tShow
    tShow.__section.select "tShow"
    tShow.__section.set key "is value"
    tShow.__section.select
    tShow.__section.set key "unnamed section"
    tShow.set [section with spaces] key with spaces = value with spaces
    tShow.show                                                                 | {{{

        key    =    unnamed section


    [ tShow ]

        key    =    is value


    [ section with spaces ]

        key with spaces    =    value with spaces

 }}}
    tShow.free
    echo "autoswitch to the 'conf' mode by prefix of the instance name"
    <a href="#robo16">CFG</a> confAuto
    confAuto.set []valid_key = any_value_No.1
    confAuto.set []anotherKey = any value No.2
    confAuto.set [any section]validKey = any value No.3
    confAuto.set [any section]another_key = any_value_No.4
    confAuto.set [another section]invalid-key = any value No.5
    confAuto.set [another section]_Valid_Key = any value No.6
    confAuto.show                                                              | {{{

    anotherKey="any value No.2"
     valid_key=any_value_No.1


    # [ any section ]

    another_key=any_value_No.4
       validKey="any value No.3"


    # [ another section ]

    _Valid_Key="any value No.6"
    #[!] - Warn: extra character(s) in the key - 2 .. (109): invalid-key="any value No.5"

    }}}
  confAuto.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::show</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i o s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>show

  for <span class="sign">(</span><span class="sign">(</span> i<span class="sign">=</span>0<span class="sign">;</span> i <span class="sign">&lt;</span> <span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>byindex <span class="sign">)</span><span class="sign">;</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    s<span class="sign">=</span><span class="quote">"$( ${o}.__section.byindex $i )"</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span>__global__<span class="sign">|</span>__settings__<span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue
    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>show <span class="quote">"$s"</span>

  done

  printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"\n"</span>

<span class="sign">}</span>
</pre>
<a name="robo28"></a>
<a name="libcfg2fCFG3a3astorage2eshow"></a>
<h2>2.15.  libcfg/CFG::storage.show [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::storage.show</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show current storage name (if defined)
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - the storage name is not specified
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> cfgStorageShow
    cfgStorageShow.storage.show                                                #? $_bashlyk_iErrorEmptyResult
    cfgStorageShow.storage.use external.ini
    cfgStorageShow.storage.show                                                | {{ /external\.ini$ }}
    rm -f external.ini
    cfgStorageShow.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::storage.show</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s

  s<span class="sign">=</span><span class="quote">"$( ${FUNCNAME[0]%%.*}.settings storage )"</span>

  echo <span class="sign">$</span>s

  errorify on EmptyResult <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo29"></a>
<a name="libcfg2fCFG3a3astorage2euse"></a>
<h2>2.16.  libcfg/CFG::storage.use [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::storage.use</strong> [&lt;file&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Bind configuration file for a <a href="#robo16">CFG</a> instance. If specified a short filename,
    its search is first performed in the initialized configuration paths, only
    then in the current directory. The specified file is checked for reading
    and the ability to create it in the absence. If the specified file can't be
    used, an appropriate warning is issued and an internal configuration file
    is generated.
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;file&gt; - external storage file, by default a internal file is generated
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> cfgStorage
    cfgStorage.storage.use
    cfgStorage.settings storage                                                | {{ ${_bashlyk_pathDat}/[[:xdigit:]]*\.cfg$ }}
    cfgStorage.storage.use external.ini
    cfgStorage.settings storage                                                | {{ /external\.ini$ }}
    cfgStorage.storage.use /sys/extern.ini                                     ## can't be used
    cfgStorage.settings storage                                                | {{ ${_bashlyk_pathDat}/[[:xdigit:]]*\.cfg$ }}
    cfgStorage.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::storage.use</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fnErr o s sErr LANG<span class="sign">=</span>C

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    s<span class="sign">=</span><span class="quote">"$( ${o}.settings storage )"</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> eval set <span class="sign">-</span><span class="sign">-</span> <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use<span class="sign">.</span>default<span class="sign">;</span> return<span class="sign">;</span> <span class="sign">}</span>

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$@"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"${@##*/}"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    if <span class="sign">!</span> s<span class="sign">=</span><span class="quote">"$( readlink -eq "</span><span class="sign">$</span>_bashlyk_pathCfg<span class="sign">/</span><span class="sign">$</span><span class="sign">@</span><span class="quote">" )"</span><span class="sign">;</span> then

      if <span class="sign">!</span> s<span class="sign">=</span><span class="quote">"$( readlink -eq "</span><span class="sign">/</span>etc<span class="sign">/</span><span class="sign">$</span>_bashlyk_pathPrefix<span class="sign">/</span><span class="sign">$</span><span class="sign">@</span><span class="quote">" )"</span><span class="sign">;</span> then

        s<span class="sign">=</span><span class="quote">"$( readlink -eq "</span><span class="sign">$</span><span class="sign">@</span><span class="quote">" )"</span>

      fi

    fi

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="quote">"$_bashlyk_pathCfg/$@"</span>

  else

    s<span class="sign">=</span><span class="quote">"$( readlink -eq "</span><span class="sign">$</span><span class="sign">@</span><span class="quote">" )"</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="quote">"$@"</span>

  fi

  <a href="#robo125">std::temp</a> fnErr

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">#</span><span class="sign">#</span> TODO readonly maybe <span class="sign">-</span> touch <span class="quote">"$s"</span>
    head <span class="sign">-</span>c 1 <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> sErr<span class="sign">=</span><span class="quote">"NotPermitted"</span>

  else

    if <span class="sign">(</span> mkdir <span class="sign">-</span>p <span class="quote">"${s%/*}/"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> touch <span class="quote">"$s"</span> <span class="sign">)</span><span class="sign">;</span> then

      <a href="#robo39">pid::onExit.unlink</a> <span class="quote">"${s%/*}"</span>
      <a href="#robo40">pid::onExit.unlink.empty</a> <span class="quote">"$s"</span>
      s<span class="sign">=</span><span class="quote">"$( readlink -eq "</span><span class="sign">$</span>s<span class="quote">" )"</span> <span class="sign">|</span><span class="sign">|</span> sErr<span class="sign">=</span><span class="squote">'NoSuchFile'</span>

    else

      sErr<span class="sign">=</span><span class="squote">'NotExistNotCreated'</span>

    fi

  fi <span class="sign">&gt;</span><span class="sign">$</span>fnErr 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sErr <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span>No <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span>fnErr <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> error <span class="sign">$</span>sErr warn <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">,</span> details <span class="sign">-</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">&lt;</span> <span class="sign">$</span>fnErr<span class="sign">)</span>

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>storage<span class="sign">.</span>use<span class="sign">.</span>default

    <a href="#robo84">err::debugf</a> 3 <span class="squote">'used default storage - "%s"\n'</span> <span class="quote">"$( ${o}.storage.show )"</span>

  else

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings storage <span class="sign">=</span> <span class="sign">$</span>s

  fi

<span class="sign">}</span>
</pre>
<a name="robo30"></a>
<a name="libcfg2fCFG3a3astorage2euse2edefault"></a>
<h2>2.17.  libcfg/CFG::storage.use.default [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::storage.use.default</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Bind external storage (filename &amp; etc) for the configuration object
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> cfgStorDef
    cfgStorDef.storage.use.default
    cfgStorDef.settings storage                                                | {{ ${_bashlyk_pathDat}/[[:xdigit:]]*\.cfg$ }}
    cfgStorDef.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::storage.use.default</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fnErr o s LANG<span class="sign">=</span>C

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  s<span class="sign">=</span><span class="quote">"$( exec -c sha1sum &lt;&lt;&lt; "</span><span class="sign">$</span><span class="sign">{</span>0<span class="sign">}</span><span class="sign">:</span><span class="sign">:</span><span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="quote">" )"</span>
  s<span class="sign">=</span><span class="quote">"${_bashlyk_pathDat}/${s:0:40}.cfg"</span>

  <a href="#robo125">std::temp</a> fnErr

  if <span class="sign">!</span> <span class="sign">(</span> mkdir <span class="sign">-</span>p <span class="quote">"${s%/*}/"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> touch <span class="quote">"$s"</span> <span class="sign">)</span> <span class="sign">&gt;</span> <span class="sign">$</span>fnErr 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

    error NotExistNotCreated throw <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">,</span> details <span class="sign">-</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">&lt;</span> <span class="sign">$</span>fnErr<span class="sign">)</span>

  fi

  <a href="#robo39">pid::onExit.unlink</a> <span class="quote">"${s%/*}"</span>
  <a href="#robo40">pid::onExit.unlink.empty</a> <span class="quote">"$s"</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings storage <span class="sign">=</span> <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo45"></a>
<a name="libcfg2fCFG3a3a5f5fsection2ebyindex"></a>
<h2>2.18.  libcfg/CFG::__section.byindex [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.byindex</strong> [&lt;index&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get the name of the section at the specified index, or number of then
    registered sections.
</pre>
<p class="item_name">NOTES</p>
<pre>    <a href="#robo16">CFG</a> private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;index&gt; - index of the section in the common list in order of registration,
              default - total number of the registered sections
</pre>
<p class="item_name">OUTPUT</p>
<pre>    section name or total number of the registered sections
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tSectionIndex
    tSectionIndex.__section.select
    tSectionIndex.__section.select sItem1
    tSectionIndex.__section.select sItem2
    tSectionIndex.__section.select test "with double" quotes
    tSectionIndex.__section.byindex                                            | {{ ^4$          }}
    tSectionIndex.__section.byindex 0                                          | {{ ^__global__$ }}
    tSectionIndex.__section.byindex 1                                          | {{ ^sItem1$     }}
    tSectionIndex.__section.byindex 2                                          | {{ ^sItem2$     }}
    tSectionIndex.__section.byindex 3                                          | {{ '^test with double quotes$' }}
    tSectionIndex.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.byindex</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span> s

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> i<span class="sign">=</span><span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> i<span class="sign">=</span><span class="sign">@</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>i <span class="sign">=</span><span class="sign">=</span> <span class="sign">@</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="squote">'#'</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="squote">''</span>

  eval <span class="quote">"echo \${${s}_a${o^^}[$i]}"</span>

<span class="sign">}</span>
</pre>
<a name="robo46"></a>
<a name="libcfg2fCFG3a3a5f5fsection2egetArray"></a>
<h2>2.19.  libcfg/CFG::__section.getArray [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.getArray</strong> [&lt;section&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get unnamed records from specified section as serialized array. Try to get
    a unique "raw" records (with the prefix "_bashlyk_raw_uniq=...") or
    incremented records (with prefix "_bashlyk_raw_incr=...")
</pre>
<p class="item_name">NOTES</p>
<pre>    <a href="#robo16">CFG</a> private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - specified section, default - unnamed global
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments not found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local -a a
    <a href="#robo16">CFG</a> tGA
    tGA.__section.select sect1
    tGA.__section.set _bashlyk_raw_num 3
    tGA.__section.set _bashlyk_raw_incr=0 "is raw value No.1"
    tGA.__section.set _bashlyk_raw_incr=1 "is raw value No.2"
    tGA.__section.set _bashlyk_raw_incr=2 "is raw value No.3"
    tGA.__section.select sect2
    tGA.__section.set _bashlyk_raw_mode =
    tGA.__section.set '_bashlyk_raw_uniq=a1' "is raw value No.1"
    tGA.__section.set '_bashlyk_raw_uniq=b2' "is raw value No.2"
    tGA.__section.set '_bashlyk_raw_uniq=a1' "is raw value No.3"
    eval "$(tGA.__section.getArray sect1)"
    echo "3 item expected"
    (( ${#a[@]} == 3 ))                                                        #? true
    eval "$(tGA.__section.getArray sect2)"
    echo "2 item expected"
    (( ${#a[@]} == 2 ))                                                        #? true
    tGA.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.getArray</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a a
  local i id iC o s sU

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>
  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span><span class="sign">*</span>
  id<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>id <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>
  <a href="#robo120">std::isHash</a> <span class="sign">$</span>id <span class="sign">|</span><span class="sign">|</span> error InvalidHash <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span><span class="sign">(</span><a href="#robo107">_</a> onError<span class="sign">)</span> <span class="sign">$</span>id

  sU<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_mode <span class="sign">)</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sU <span class="sign">=</span><span class="sign">=</span> <span class="quote">"="</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    eval <span class="quote">"                                                                     \
                                                                               \
      for i in \"\${!$id[@]}\"; do                                             \
                                                                               \
        [[ \$i =~ ^_bashlyk_raw_uniq= ]] &amp;&amp; a[\${#a[@]}]=\"\${$id[\$i]}\";     \
                                                                               \
      done;                                                                    \
                                                                               \
    "</span>

  else

    iC<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_num <span class="sign">)</span>
    if <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iC <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> iC <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

      eval <span class="quote">"                                                                   \
                                                                               \
        for (( i=0; i &lt; $iC; i++ )); do                                        \
                                                                               \
          a[\${#a[@]}]=\"\${$id[_bashlyk_raw_incr=\$i]}\";                     \
                                                                               \
        done;                                                                  \
                                                                               \
      "</span>

    fi

  fi

  <span class="sign">#</span>
  <span class="sign">#</span> expected defined items of a result array
  <span class="sign">#</span>
  s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> declare <span class="sign">-</span>pa a 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span>declare<span class="sign">.</span><span class="sign">-</span>a<span class="sign">.</span>a<span class="sign">=</span><span class="sign">\</span><span class="sign">'</span><span class="sign">?</span><span class="sign">\</span><span class="sign">(</span><span class="sign">.</span><span class="sign">+</span><span class="sign">\</span><span class="sign">)</span><span class="sign">\</span><span class="sign">'</span><span class="sign">?</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> echo <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorEmptyResult <span class="sign">)</span>

<span class="sign">}</span>
</pre>
<a name="robo47"></a>
<a name="libcfg2fCFG3a3a5f5fsection2eid"></a>
<h2>2.20.  libcfg/CFG::__section.id [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.id</strong> [&lt;section&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get a link of the storage for specified section or links for all storages.
</pre>
<p class="item_name">NOTES</p>
<pre>    <a href="#robo16">CFG</a> private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - section name, '@' - all sections, default - unnamed 'global'
</pre>
<p class="item_name">OUTPUT</p>
<pre>    associative array(s), in which are stored data of the section(s)
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tSectionId1
    <a href="#robo16">CFG</a> tSectionId2
    tSectionId1.__section.select
    tSectionId1.__section.id                                                   | {{ ^_hTSECTIONID1_[[:xdigit:]]*$ }}
    tSectionId2.__section.id @                                                 | {{ ^_hTSECTIONID2_settings$ }}
    tSectionId1.free
    tSectionId2.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.id</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  eval <span class="quote">"echo \${_h${o^^}[${*:-__global__}]}"</span>

<span class="sign">}</span>
</pre>
<a name="robo48"></a>
<a name="libcfg2fCFG3a3a5f5fsection2eselect"></a>
<h2>2.21.  libcfg/CFG::__section.select [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.select</strong> [&lt;section&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    select current section of the instance, prepare <a href="#robo16">CFG</a> getter/setter for the
    private storage of the selected section
</pre>
<p class="item_name">NOTES</p>
<pre>    <a href="#robo16">CFG</a> private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - section name, default - unnamed global
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s
    <a href="#robo16">CFG</a> tSel
    tSel.__section.select                                                      #? true
    tSel.__section.set key "is value from unnamed section"
    tSel.__section.get key                                                     | {{'^is value from unnamed section$'}}
    tSel.__section.select tSect                                                #? true
    tSel.__section.set key "is value"
    tSel.__section.get key                                                     | {{ '^is value$' }}
    tSel.__section.select section with spaces                                  #? true
    tSel.__section.set "key with spaces" "is value"
    tSel.__section.get "key with spaces"                                       | {{ '^is value$' }}
    tSel.__section.id @                                                        | {{ -P "^_hTSEL.*(settings|[[:xdigit:]]*)$" }}
    tSel.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.select</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local id o s<span class="sign">=</span><span class="quote">"${@:-__global__}"</span>

  s<span class="sign">=</span><span class="quote">"${s//\"/\'\'}"</span>

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>
  eval <span class="quote">"id=\${_h${o^^}[$s]}"</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>id <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    id<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c sha1sum <span class="sign">&lt;</span><span class="sign">&lt;</span><span class="sign">&lt;</span> <span class="quote">"$s"</span> <span class="sign">)</span>
    id<span class="sign">=</span><span class="quote">"_h${o^^}<a href="#robo107">_</a>${id:0:40}"</span>

    declare <span class="sign">-</span>Ag <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>id<span class="sign">=</span><span class="quote">"()"</span>

    eval <span class="quote">"_h${o^^}[$s]=$id; _a${o^^}[\${#_a${o^^}[@]}]=\"$s\""</span>

  fi

  eval <span class="quote">"                                                                       \
                                                                               \
    id=\${_h${o^^}[$s]};                                                       \
    ${o}.__section.set() { [[ \$1 ]] &amp;&amp; $id[\$1]=\"\$2\"; };                   \
    ${o}.__section.get() { [[ \$* ]] &amp;&amp; echo \"\${$id[\$*]}\"; };              \
                                                                               \
  "</span>

<span class="sign">}</span>
</pre>
<a name="robo49"></a>
<a name="libcfg2fCFG3a3a5f5fsection2esetRawData"></a>
<h2>2.22.  libcfg/CFG::__section.setRawData [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.setRawData</strong> -|=|+ &lt;data&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    set "raw" data record to the current section with special key prefix
    '_bashlyk_raw_...'
</pre>
<p class="item_name">NOTES</p>
<pre>    <a href="#robo16">CFG</a> private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    -+   - add "raw" record with incremented key like "_bashlyk_raw_incr=&lt;No&gt;"
    =    - add or update "raw" unique record with key like
           "_bashlyk_raw_uniq=&lt;input data without spaces and quotes&gt;"
    data - input data, interpreted as "raw" record
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - unexpected "raw" mode
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tSRawData
    tSRawData.__section.select "unique_values"
    tSRawData.__section.setRawData "=" "save only unique 1"
    tSRawData.__section.setRawData "=" "save only unique 2"
    tSRawData.__section.setRawData "=" "save only unique 1"
    tSRawData.__section.select "accumulated_values"
    tSRawData.__section.setRawData "+" "save all 1"
    tSRawData.__section.setRawData "+" "save all 2"
    tSRawData.__section.setRawData "+" "save all 1"
    tSRawData.show                                                             | {{{



    [ unique_values ]

    save only unique 1
    save only unique 2


    [ accumulated_values ]

    save all 1
    save all 2
    save all 1

 }}}
    tSRawData.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.setRawData</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local c<span class="sign">=</span><span class="sign">$</span>1 i o s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  shift <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span><span class="sign">*</span><span class="quote">" )"</span>

  case <span class="quote">"$c"</span> in

    <span class="sign">=</span><span class="sign">)</span>

       <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"_bashlyk_raw_uniq=${s//[\'\"\\ ]/}"</span> <span class="quote">"$s"</span>

    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">-</span><span class="sign">|</span><span class="sign">+</span><span class="sign">)</span>

       i<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_num <span class="sign">)</span>
       <a href="#robo121">std::isNumber</a> <span class="sign">$</span>i <span class="sign">|</span><span class="sign">|</span> i<span class="sign">=</span>0
       <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="quote">"_bashlyk_raw_incr=${i}"</span> <span class="quote">"$s"</span>
       <span class="sign">:</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span>
       <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="squote">'_bashlyk_raw_num'</span> <span class="sign">$</span>i

    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>

      return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidArgument <span class="sign">)</span>

  esac

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set <span class="squote">'_bashlyk_raw_mode'</span> <span class="quote">"$c"</span>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo50"></a>
<a name="libcfg2fCFG3a3a5f5fsection2eshow"></a>
<h2>2.23.  libcfg/CFG::__section.show [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::__section.show</strong> [&lt;section&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show a content of the specified section
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;section&gt; - section name, default - unnamed section
</pre>
<p class="item_name">OUTPUT</p>
<pre>    the contents (must be empty) of the specified section with name as header
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tSShow
    tSShow.__section.select tSect
    tSShow.__section.set key "is value"
    tSShow.__section.show tSect                                                | {{{


    [ tSect ]

    key    =    is value
 }}}
    tSShow.__section.select
    tSShow.__section.set key "unnamed section"
    tSShow.__section.show                                                      | {{{

    key    =    unnamed section
 }}}
    tSShow.free
    <a href="#robo16">CFG</a> tSShow2
    tSShow2.settings.shellmode true
    tSShow2.set [ tSect2 ] keyFirst   = is first value
    tSShow2.set [ tSect2 ] keySecond  = is second value
    tSShow2.set [ tSect2 ] keyOneWord = is_one_world_value
    tSShow2.__section.show tSect2                                              | {{{


    [ tSect2 ]

      keyFirst="is first value"
    keyOneWord=is_one_world_value
     keySecond="is second value"
 }}}
    tSShow2.free
    <a href="#robo16">CFG</a> tCheckSpaces
    tCheckSpaces.set [ section ] key = value
    tCheckSpaces.settings.section.padding = false
    tCheckSpaces.show                                                          | {{ '^\[section\]$'   }}
    tCheckSpaces.settings.section.padding = true
    tCheckSpaces.show                                                          | {{ '^\[ section \]$' }}
    tCheckSpaces.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::__section.show</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local iC id k o sA sU s

  o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select <span class="sign">$</span><span class="sign">*</span>
  id<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>id <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  sU<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_mode <span class="sign">)</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sU <span class="sign">=</span><span class="sign">=</span> <span class="squote">'!'</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sA<span class="sign">=</span><span class="squote">':'</span> <span class="sign">|</span><span class="sign">|</span> sA<span class="sign">=</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"$( ${o}.settings fmtSection0 )"</span> <span class="quote">"${@//\'\'/\"}"</span> <span class="quote">"$sA"</span>

  else

    echo <span class="quote">""</span>

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sU <span class="sign">=</span><span class="sign">=</span> <span class="quote">"="</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    eval <span class="quote">"                                                                     \
                                                                               \
      for k in \"\${!$id[@]}\"; do                                             \
                                                                               \
        [[ \$k =~ ^_bashlyk_raw_uniq= ]] &amp;&amp; printf -- '%s\n' \"\${$id[\$k]}\"; \
                                                                               \
      done | sort;                                                             \
                                                                               \
    "</span>

  else

    iC<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_raw_num <span class="sign">)</span>

    if <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iC <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> iC <span class="sign">&gt;</span> 0 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

      for <span class="sign">(</span><span class="sign">(</span> k<span class="sign">=</span>0<span class="sign">;</span> k <span class="sign">&lt;</span> <span class="sign">$</span>iC<span class="sign">;</span> k<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

        <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get <span class="quote">"_bashlyk_raw_incr=$k"</span>

      done

    else

      local bQuote iKeyWidth iPad v

      iKeyWidth<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get _bashlyk_key_width <span class="sign">)</span>
      <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iKeyWidth <span class="sign">|</span><span class="sign">|</span> iKeyWidth<span class="sign">=</span><span class="squote">''</span>

      iPad<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings iPadding <span class="sign">)</span>

      <a href="#robo121">std::isNumber</a> <span class="sign">$</span>iPad <span class="sign">|</span><span class="sign">|</span> iPad<span class="sign">=</span>4

      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>settings<span class="sign">.</span>shellmode <span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span>true<span class="sign">|</span>yes<span class="sign">|</span>1<span class="sign">)</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        bQuote<span class="sign">=</span>true
        iPad<span class="sign">=</span>0

      else

        bQuote<span class="sign">=</span><span class="squote">''</span>

      fi

      eval <span class="quote">"                                                                   \
                                                                               \
        for k in \"\${!$id[@]}\"; do                                           \
          if [[ ! \$k =~ ^_bashlyk_ ]]; then                                   \
            v=\${$id[\$k]};                                                    \
            [[ \$bQuote ]] &amp;&amp; v=\$( <a href="#robo123">std::lazyquote</a> \$v );                      \
            printf -- '%${iPad}s%${iKeyWidth}s%${iPad}s=%${iPad}s%s\n'         \
              \"\" \"\$k\" \"\" \"\"  \"\$v\";                                 \
          fi                                                                   \
        done | sort;                                                           \
                                                                               \
      "</span>

    fi

  fi

  <span class="sign">#</span><span class="sign">#</span> TODO unnamed section behavior <span class="sign">?</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sA <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="quote">"$( ${o}.settings fmtSection1 )"</span> <span class="quote">"$sA"</span> <span class="quote">"${@//\'\'/\"}"</span>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo51"></a>
<a name="libcfg2fCFG3a3asettings"></a>
<h2>2.24.  libcfg/CFG::settings [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::settings</strong> [ &lt;key&gt; [ = &lt;value&gt; ] ]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    set or get propertie(s) of the <a href="#robo16">CFG</a> instance
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;key&gt;   - select propertie for action - get (show) or set
    &lt;value&gt; - set new value for selected properties
              default, show all properties with section header
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ERRORS</p>
<pre>    iErrorInvalidArgument - invalid key name ( char class :alnum: expected )
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tSettings
    tSettings.set key = value
    tSettings.settings bBooleanOption     =   true
    tSettings.settings sSimpleFakeOption  =   simple fake option
    tSettings.settings sSimpleFakeOption                                       | {{ '^simple fake option$' }}
    tSettings.settings bBooleanOption                                          | {{ ^true$                 }}
    ## TODO improves required
    tSettings.settings                                                         | {{{


    [ __settings__ ]

           bBooleanOption    =    true
              bSaveConfig    =    true
          bSectionPadding    =    true
               bShellMode    =    false
                chComment    =    #
                 fmtPairs    =    ^[[:space:]]*\b(%KEY%)\b[[:space:]]*=[[:space:]]*(.*)[[:space:]]*$
              fmtSection0    =    \n\n[ %s ]%s\n\n
              fmtSection1    =    \n%s[ %s ]\n
                    reKey    =    ^\b([^=]+)\b$
                 reKeyVal    =    ^[[:space:]]*\b([^=]+)\b[[:space:]]*=[[:space:]]*(.*)[[:space:]]*$
        sSimpleFakeOption    =    simple fake option
 }}}
    tSettings.settings bSection With Spaces                                    #? $_bashlyk_iErrorInvalidArgument
    tSettings.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::settings</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span> k s v

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">(</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alnum<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">+</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">=</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">(</span><span class="sign">.</span><span class="sign">*</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>set <span class="sign">[</span> __settings__ <span class="sign">]</span> <span class="sign">$</span><span class="sign">*</span>

  elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">(</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alnum<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">+</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>get <span class="sign">[</span> __settings__ <span class="sign">]</span> <span class="sign">$</span><span class="sign">*</span>

  elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>show <span class="squote">'__settings__'</span>

  else

    return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidArgument <span class="sign">)</span>

  fi

  return <span class="sign">$</span><span class="sign">?</span>

<span class="sign">}</span>
</pre>
<a name="robo52"></a>
<a name="libcfg2fCFG3a3asettings2esection2epadding"></a>
<h2>2.25.  libcfg/CFG::settings.section.padding [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::settings.section.padding</strong> [ [=] true|false ]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    enable/disable padding with one whitespace around section name.
    default is enabled
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    true  - enable
    false - disable
    without argument show current state of the section padding
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - expected true or false
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tShellmode
    tShellmode.settings.section.padding                                        | {{ ^true$  }}
    tShellmode.settings.section.padding = FALSE                                #? true
    tShellmode.settings.section.padding                                        | {{ ^false$ }}
    tShellmode.settings.section.padding = error                                #? $_bashlyk_iErrorInvalidArgument
    tShellmode.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::settings.section.padding</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">=</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select __settings__

  case <span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">,</span><span class="sign">,</span><span class="sign">}</span> in

    true<span class="sign">|</span>yes<span class="sign">|</span>1<span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtSection0 <span class="quote">"\n\n[ %s ]%s\n\n"</span>
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtSection1 <span class="quote">"\n%s[ %s ]\n"</span>
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set bSectionPadding true

    <span class="sign">;</span><span class="sign">;</span>

    false<span class="sign">|</span>no<span class="sign">|</span>0<span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtSection0 <span class="quote">"\n\n[%s]%s\n\n"</span>
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtSection1 <span class="quote">"\n%s[%s]\n"</span>
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set bSectionPadding false

    <span class="sign">;</span><span class="sign">;</span>

            <span class="squote">''</span><span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get bSectionPadding

    <span class="sign">;</span><span class="sign">;</span>

             <span class="sign">*</span><span class="sign">)</span>

      return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidArgument <span class="sign">)</span>

    <span class="sign">;</span><span class="sign">;</span>

  esac

<span class="sign">}</span>
</pre>
<a name="robo53"></a>
<a name="libcfg2fCFG3a3asettings2eshellmode"></a>
<h2>2.26.  libcfg/CFG::settings.shellmode [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo72">libcfg</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>CFG::settings.shellmode</strong> [ [=] true|false ]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    enable/disable "active configuration" for instance INI. For example, save
    the configuration with "shellmode = true" looks like:

          var="value with whitespaces doublequoted"
      varmore=example
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    true  - enable
    false - disable
    without argument show current state of the shellmode
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - expected true or false
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <a href="#robo16">CFG</a> tShellmode
    tShellmode.settings.shellmode                                              | {{ ^false$ }}
    tShellmode.settings.shellmode = YEs                                        #? true
    tShellmode.settings.shellmode                                              | {{ ^true$  }}
    tShellmode.settings.shellmode = error                                      #? $_bashlyk_iErrorInvalidArgument
    tShellmode.free
    <a href="#robo16">CFG</a> cnfAuto
    cnfAuto.settings.shellmode                                                 | {{ ^true$  }}
    cnfAuto.free
    <a href="#robo16">CFG</a> configAuto
    configAuto.settings.shellmode                                              | {{ ^false$ }}
    configAuto.free
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>CFG::settings.shellmode</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local o<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>FUNCNAME<span class="sign">[</span>0<span class="sign">]</span><span class="sign">%</span><span class="sign">%</span><span class="sign">.</span><span class="sign">*</span><span class="sign">}</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">=</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift

  <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>select __settings__

  case <span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">,</span><span class="sign">,</span><span class="sign">}</span> in

    true<span class="sign">|</span>yes<span class="sign">|</span>1<span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set reKey <span class="sign">$</span>_bashlyk_CNF_reKey
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set reKeyVal <span class="sign">$</span>_bashlyk_CNF_reKeyVal
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtPairs <span class="sign">$</span>_bashlyk_CNF_fmtPairs
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set bShellMode true

    <span class="sign">;</span><span class="sign">;</span>

    false<span class="sign">|</span>no<span class="sign">|</span>0<span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set reKey <span class="sign">$</span>_bashlyk_INI_reKey
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set reKeyVal <span class="sign">$</span>_bashlyk_INI_reKeyVal
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set fmtPairs <span class="sign">$</span>_bashlyk_INI_fmtPairs
      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>set bShellMode false

    <span class="sign">;</span><span class="sign">;</span>

            <span class="squote">''</span><span class="sign">)</span>

      <span class="sign">$</span><span class="sign">{</span>o<span class="sign">}</span><span class="sign">.</span>__section<span class="sign">.</span>get bShellMode

    <span class="sign">;</span><span class="sign">;</span>

             <span class="sign">*</span><span class="sign">)</span>

      return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidArgument <span class="sign">)</span>

    <span class="sign">;</span><span class="sign">;</span>

  esac

<span class="sign">}</span>
</pre>
<a name="robo73"></a>
<a name="BASHLYK2fliberr"></a>
<h1>3.  BASHLYK/liberr [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    a set of functions to handle errors
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a> <a href="#robo75">libmsg</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo1"></a>
<a name="liberr2fUsed20libraries"></a>
<h2>3.1.  liberr/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo75">libmsg</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo75">libmsg</a>.sh"</span>
</pre>
<a name="robo9"></a>
<a name="liberr2fGlobal20Variables"></a>
<h2>3.2.  liberr/Global Variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">declare <span class="sign">-</span>rg _bashlyk_aRequiredCmd_err<span class="sign">=</span><span class="quote">"[ rm sed"</span>

declare <span class="sign">-</span>rg _bashlyk_methods_err<span class="sign">=</span><span class="quote">"

    __add_throw_to_command CommandNotFound __convert_try_to_func debug
    EmptyArgument EmptyOrMissingArgument EmptyResult EmptyVariable
    exception.message generate __generate InvalidVariable MissingArgument
    NotExistNotCreated NotNumber AlreadyExist NoSuchFileOrDir NoSuchFile
    NoSuchDir orr postfix sourcecode stacktrace status status.show
"</span>

declare <span class="sign">-</span>rg _bashlyk_aExport_err<span class="sign">=</span><span class="quote">"

    abort catch err::{exception.message,stacktrace,status,sourcecode} errorify
    errorify+echo errorify+warn exit+echo exit+warn error show throw try warn

"</span>

declare <span class="sign">-</span>rg _bashlyk_err_reAct<span class="sign">=</span><span class="squote">'^((echo|warn)|(((echo|warn)[+])?(exit|return))|(throw))$'</span>
declare <span class="sign">-</span>rg _bashlyk_err_reArg<span class="sign">=</span><span class="squote">'(error|<a href="#robo32">err::generate</a>|\$\(.?<a href="#robo32">err::generate</a>.\"\$\@\".?\))[[:space:]]*?([^\&gt;]*)[[:space:]]*?[\&gt;\|]?'</span>

<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_onError<span class="sign">:</span><span class="sign">=</span>throw<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iPidMax<span class="sign">:</span><span class="sign">=</span>999999<span class="sign">}</span>
<span class="sign">#</span>
<span class="sign">#</span> Error states definition
<span class="sign">#</span>
_bashlyk_iError<span class="sign">=</span>255
_bashlyk_iErrorUnknown<span class="sign">=</span>254
_bashlyk_iErrorUnexpected<span class="sign">=</span>254
_bashlyk_iErrorEmptyOrMissingArgument<span class="sign">=</span>253
_bashlyk_iErrorMissingArgument<span class="sign">=</span>253
_bashlyk_iErrorEmptyArgument<span class="sign">=</span>253
_bashlyk_iErrorNonValidArgument<span class="sign">=</span>252
_bashlyk_iErrorNotValidArgument<span class="sign">=</span>252
_bashlyk_iErrorInvalidArgument<span class="sign">=</span>252
_bashlyk_iErrorEmptyResult<span class="sign">=</span>251
_bashlyk_iErrorNotSupported<span class="sign">=</span>241
_bashlyk_iErrorNotPermitted<span class="sign">=</span>240
_bashlyk_iErrorBrokenIntegrity<span class="sign">=</span>230
_bashlyk_iErrorAbortedBySignal<span class="sign">=</span>220
_bashlyk_iErrorInvalidOption<span class="sign">=</span>201
_bashlyk_iErrorNonValidVariable<span class="sign">=</span>200
_bashlyk_iErrorInvalidVariable<span class="sign">=</span>200
_bashlyk_iErrorInvalidFunction<span class="sign">=</span>199
_bashlyk_iErrorInvalidHash<span class="sign">=</span>198
_bashlyk_iErrorEmptyVariable<span class="sign">=</span>197
_bashlyk_iErrorNotNumber<span class="sign">=</span>196
_bashlyk_iErrorNotInteger<span class="sign">=</span>195
_bashlyk_iErrorNotDecimal<span class="sign">=</span>194
_bashlyk_iErrorNotExistNotCreated<span class="sign">=</span>190
_bashlyk_iErrorAlreadyExist<span class="sign">=</span>188
_bashlyk_iErrorNoSuchDir<span class="sign">=</span>187
_bashlyk_iErrorNoSuchFile<span class="sign">=</span>186
_bashlyk_iErrorNoSuchFileOrDir<span class="sign">=</span>185
_bashlyk_iErrorNoSuchProcess<span class="sign">=</span>184
_bashlyk_iErrorCurrentProcess<span class="sign">=</span>183
_bashlyk_iErrorAlreadyStarted<span class="sign">=</span>182
_bashlyk_iErrorNotChildProcess<span class="sign">=</span>181
_bashlyk_iErrorCommandNotFound<span class="sign">=</span>180
_bashlyk_iErrorAlreadyLocked<span class="sign">=</span>179
_bashlyk_iErrorUserXsessionNotFound<span class="sign">=</span>171
_bashlyk_iErrorXsessionNotFound<span class="sign">=</span>170
_bashlyk_iErrorIncompatibleVersion<span class="sign">=</span>169
_bashlyk_iErrorTryBlockException<span class="sign">=</span>168
_bashlyk_iErrorTimeExpired<span class="sign">=</span>167
_bashlyk_iErrorNotAvailable<span class="sign">=</span>166
_bashlyk_iErrorNotDetected<span class="sign">=</span>0
_bashlyk_iErrorSuccess<span class="sign">=</span>0
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorUnknown<span class="sign">]</span><span class="sign">=</span><span class="quote">"unknown (unexpected) error"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorMissingArgument<span class="sign">]</span><span class="sign">=</span><span class="quote">"empty or missing argument"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorInvalidArgument<span class="sign">]</span><span class="sign">=</span><span class="quote">"invalid argument"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorEmptyVariable<span class="sign">]</span><span class="sign">=</span><span class="quote">"empty variable"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorEmptyResult<span class="sign">]</span><span class="sign">=</span><span class="quote">"empty result"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotSupported<span class="sign">]</span><span class="sign">=</span><span class="quote">"not supported"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotPermitted<span class="sign">]</span><span class="sign">=</span><span class="quote">"not permitted"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorBrokenIntegrity<span class="sign">]</span><span class="sign">=</span><span class="quote">"broken integrity"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorAbortedBySignal<span class="sign">]</span><span class="sign">=</span><span class="quote">"aborted by signal"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorInvalidOption<span class="sign">]</span><span class="sign">=</span><span class="quote">"parsing CLI is failed - invalid option(s)"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorInvalidVariable<span class="sign">]</span><span class="sign">=</span><span class="quote">"invalid variable"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorInvalidFunction<span class="sign">]</span><span class="sign">=</span><span class="quote">"invalid function"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorInvalidHash<span class="sign">]</span><span class="sign">=</span><span class="quote">"invalid hash"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotNumber<span class="sign">]</span><span class="sign">=</span><span class="quote">"not number"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotInteger<span class="sign">]</span><span class="sign">=</span><span class="quote">"not integer"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotDecimal<span class="sign">]</span><span class="sign">=</span><span class="quote">"not decimal number"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotExistNotCreated<span class="sign">]</span><span class="sign">=</span><span class="quote">"not exist and not created"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorAlreadyExist<span class="sign">]</span><span class="sign">=</span><span class="quote">"already exist"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNoSuchDir<span class="sign">]</span><span class="sign">=</span><span class="quote">"no such directory"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNoSuchFile<span class="sign">]</span><span class="sign">=</span><span class="quote">"no such file"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNoSuchFileOrDir<span class="sign">]</span><span class="sign">=</span><span class="quote">"no such file or directory"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNoSuchProcess<span class="sign">]</span><span class="sign">=</span><span class="quote">"no such process"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotChildProcess<span class="sign">]</span><span class="sign">=</span><span class="quote">"not child process"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorCurrentProcess<span class="sign">]</span><span class="sign">=</span><span class="quote">"this current process"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorAlreadyStarted<span class="sign">]</span><span class="sign">=</span><span class="quote">"already started with PID"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorCommandNotFound<span class="sign">]</span><span class="sign">=</span><span class="quote">"command not found"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorAlreadyLocked<span class="sign">]</span><span class="sign">=</span><span class="quote">"already locked"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorUserXsessionNotFound<span class="sign">]</span><span class="sign">=</span><span class="quote">"user X-Session not found"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorXsessionNotFound<span class="sign">]</span><span class="sign">=</span><span class="quote">"X-Session not found"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorIncompatibleVersion<span class="sign">]</span><span class="sign">=</span><span class="quote">"incompatible version"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorTryBlockException<span class="sign">]</span><span class="sign">=</span><span class="quote">"try block exception"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorTimeExpired<span class="sign">]</span><span class="sign">=</span><span class="quote">"time expired"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotAvailable<span class="sign">]</span><span class="sign">=</span><span class="quote">"target is not available"</span>
_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>_bashlyk_iErrorNotDetected<span class="sign">]</span><span class="sign">=</span><span class="quote">"unknown (unexpected) error, maybe everything is fine"</span>
</pre>
<a name="robo14"></a>
<a name="liberr2fAliases"></a>
<h2>3.3.  liberr/Aliases [ aliases ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ aliases ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    usable aliases for exported functions
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">alias           try<span class="sign">=</span><span class="squote">'try()'</span>
alias         error<span class="sign">=</span><span class="squote">'eval $( <a href="#robo32">err::generate</a> "$@" )'</span>
alias          show<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> echo'</span>
alias          warn<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> warn'</span>
alias         abort<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> exit'</span>
alias         throw<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> throw'</span>
alias      errorify<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> return'</span>
alias     exit<span class="sign">+</span>echo<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> echo+exit'</span>
alias     exit<span class="sign">+</span>warn<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> warn+exit'</span>
alias errorify<span class="sign">+</span>echo<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> echo+return'</span>
alias errorify<span class="sign">+</span>warn<span class="sign">=</span><span class="squote">'<a href="#robo69">err::postfix</a> warn+return'</span>
alias         catch<span class="sign">=</span><span class="squote">'; eval "$( <a href="#robo55">err::__convert_try_to_func</a> )" ||'</span>
</pre>
<a name="robo31"></a>
<a name="liberr2ferr3a3aexception2emessage"></a>
<h2>3.4.  liberr/err::exception.message [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::exception.message</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show last error status
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">INPUTS</p>
<pre>    used global variables $_bashlyk_{i,s}LastError
</pre>
<p class="item_name">OUTPUT</p>
<pre>    try show commandline, status(error code) and output
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - _bashlyk_iLastError[$BASHPID] empty
    NotNumber       - _bashlyk_iLastError[$BASHPID] is not number
</pre>
<p class="item_name">EXAMPLE</p>
<pre>   _bashlyk_iLastError[$BASHPID]=''
   <strong>err::exception.message</strong>                                                      #? $_bashlyk_iErrorMissingArgument
   _bashlyk_iLastError[$BASHPID]='not number'
   <strong>err::exception.message</strong>                                                      #? $_bashlyk_iErrorNotNumber
   local s fn                                                                  #-
   error4test() { echo "${0##*/}: special error for testing"; return 210; };   #-
   <a href="#robo125">std::temp</a> fn                                                                #-
   cat &lt;&lt;-'EOFtry' &gt; $fn                                                       #-
   try {                                                                       #-
     uname -a                                                                  #-
     date -R                                                                   #-
     uname                                                                     #-
     error4test                                                                #-
     true                                                                      #-
   } catch {                                                                   #-
                                                                               #-
     <strong>err::exception.message</strong>                                                    #-
                                                                               #-
   }                                                                           #-
   EOFtry                                                                      #-
   . $fn                                                                       | {{{
   ... fail..(210)

   try block exception:
   ~~~~~~~~~~~~~~~~~~~~
    status: 210
   command: error4test
    output: {
    <a href="#robo79">testunit</a>.sh: special error for testing
   }
 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::exception.message</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local msg<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_sLastError<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">}</span> rc<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_iLastError<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">}</span>

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>rc <span class="sign">|</span><span class="sign">|</span> return

  printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"\ntry block exception:\n~~~~~~~~~~~~~~~~~~~~\n status: %s\n"</span> <span class="quote">"$rc"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>msg <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"${msg}\n"</span>

  return <span class="sign">$</span>rc

<span class="sign">}</span>
</pre>
<a name="robo32"></a>
<a name="liberr2ferr3a3agenerate"></a>
<h2>3.5.  liberr/err::generate [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::generate</strong> [&lt;state&gt;] [&lt;action&gt;] [--] [&lt;message&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Generate code for flexible error handling, which depends on the global
    variable or arguments. Possible to combine with each other the following
    types of code:
        * Output the warning message
        * Function termination with error code
        * Completion of the script with error code
        * Call stack trace
    The generated code is intended for execution by the eval utility
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;action&gt; - directly determines how the error handling. Possible actions:

     echo        - just prepare a message from the string argument to STDERR
     warn        - prepare a message from the string argument for transmission
                   to the notification system
     return      - set return from the function. In the global context - the
                   end of the script (exit)
     echo+return - the combined action of 'echo'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to STDERR
     warn+return - the combined action of 'warn'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to the notification
                   system
     exit        - set unconditional completion of the script
     echo+exit   - the same as 'exit', but with the transfer of messages from a
                   string of arguments to STDERR
     warn+exit   - the same as 'echo+exit', but with the transfer of messages
                   to the notification system
     throw       - the same as 'warn+exit', but with the transfer of messages
                   and the call stack to the notification system

    If an action is not specified, it uses stored in the global variable
    $_bashlyk_onError action. If it is not valid, then use action 'throw'

    &lt;state&gt; - number or predefined name as 'iError&lt;Name&gt;' or '&lt;Name&gt;' by which
              one can get the error code from the global variable
              $_bashlyk_iError&lt;..&gt; and its description from global hash
              $_bashlyk_hError
              If the error code is not specified, it is set to the return code
              of the last executed command. In the end, the resulting numeric
              code initializes a global variable $_bashlyk_iLastError[$BASHPID]

    &lt;message&gt; - An error detail, such as the file name. When specifying a
                message, you should keep in mind that the error table
                ($_bashlyk_hError) has already prepared the descriptions.
                Important!!! Only one line is expected, additional lines can be
                processed by the interpreter. To avoid execution of these lines
                as a code, you need to remove linefeeds from variables, do not
                apply double quotes around them (see examples).
</pre>
<p class="item_name">OUTPUT</p>
<pre>    command line, which can be performed using the eval &lt;...&gt;
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fn s
    false || error NoSuchFileOrDir warn /notexist                              #? true
    _bashlyk_onError=debug
    false || error NoSuchFileOrDir exit /notexist                              #? $_bashlyk_iErrorNoSuchFileOrDir
    <a href="#robo68">err::orr</a> 100 || error echo                                                 #? true
    <a href="#robo68">err::orr</a> 101 || error 115 echo+return                                      #? 115
    <a href="#robo68">err::orr</a> 102 || error 116                                                  #? 116
    <a href="#robo68">err::orr</a> 103 || error bla-bla bla                                          #? 103
    <a href="#robo68">err::orr</a> 103 || error CommandNotFound bla-bla bla                          #? $_bashlyk_iErrorCommandNotFound
    <a href="#robo68">err::orr</a> 104 || error                                                      #? 104
    <a href="#robo125">std::temp</a> fn
    w &gt; $fn                                                                    #-
    error InvalidArgument warn "$(<a href="#robo118">std::inline</a>&lt; &lt;(w))"                          #? true ## See test log for the absence of multiline artefacts
    error InvalidArgument warn -- $(w)                                         #? true ## See test log for the absence of multiline artefacts
    error InvalidArgument warn "$(<a href="#robo118">std::inline</a> lf_tag &lt; $fn)"                   #? true ## See test log for the absence of multiline artefacts
    error InvalidArgument warn "test "$(w)" test"                              #? true ## See test log for the absence of multiline artefacts
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::generate</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bashlyk_err_gen_rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  if   <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">-</span> <span class="sign">=</span><span class="sign">~</span> i <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <a href="#robo107">_</a> onError return
    echo <span class="quote">"echo [!]"</span>

  elif <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$( <a href="#robo33">err::sourcecode</a> )"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_err_reArg <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <a href="#robo56">err::__generate</a> <span class="sign">$</span>bashlyk_err_gen_rc <span class="sign">$</span><span class="sign">(</span> eval echo <span class="quote">"${BASH_REMATCH[2]}"</span> <span class="sign">)</span>

  else

    echo <span class="quote">"echo \"$@ - invalid arguments for error handling, abort...\"; exit $_bashlyk_iErrorInvalidArgument;"</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo33"></a>
<a name="liberr2ferr3a3asourcecode"></a>
<h2>3.6.  liberr/err::sourcecode [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::sourcecode</strong> [&lt;level&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get source code line for selected stack level ( 0 default )
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">OUTPUT</p>
<pre>    source code line
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::sourcecode</strong> | {{'^err::sourcecode_test$'}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::sourcecode</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fn i

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> i<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>1 <span class="sign">+</span> 1 <span class="sign">)</span><span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> i<span class="sign">=</span>1

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>BASH_SOURCE<span class="sign">[</span>i<span class="sign">+</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    fn<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_SOURCE<span class="sign">[</span>i<span class="sign">+</span>1<span class="sign">]</span><span class="sign">}</span>

  else

    fn<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_PWD<span class="sign">}</span><span class="sign">/</span><span class="sign">$</span><span class="sign">{</span>BASH_SOURCE<span class="sign">[</span>i<span class="sign">+</span>1<span class="sign">]</span><span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span>

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>fn <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>f <span class="sign">$</span>fn  <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>s <span class="sign">$</span>fn <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <a href="#robo121">std::isNumber</a> <span class="sign">$</span><span class="sign">{</span>BASH_LINENO<span class="sign">[</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sed <span class="sign">-</span>n <span class="quote">"${BASH_LINENO[i]}p"</span> <span class="sign">$</span>fn

  else

    return <span class="sign">$</span>_bashlyk_iErrorNoSuchFile

  fi

<span class="sign">}</span>
</pre>
<a name="robo34"></a>
<a name="liberr2ferr3a3astacktrace"></a>
<h2>3.7.  liberr/err::stacktrace [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::stacktrace</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    OUTPUT BASH Stack Trace
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">OUTPUT</p>
<pre>    BASH Stack Trace
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::stacktrace</strong> | {{'1: code err::stacktrace_test'}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::stacktrace</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i s<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'\u00a0'</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'Stack trace by %s from %s {\n'</span> <span class="quote">"${FUNCNAME[0]}"</span> <span class="quote">"${BASH_SOURCE[0]}"</span>

  for <span class="sign">(</span><span class="sign">(</span> i<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>FUNCNAME<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">-</span>1<span class="sign">;</span> i <span class="sign">&gt;</span><span class="sign">=</span> 0<span class="sign">;</span> i<span class="sign">-</span><span class="sign">-</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>BASH_LINENO<span class="sign">[</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">=</span> 0 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue

    printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s%d: call %s:%s %s ..\n%s%d: code %s\n'</span>                        <span class="sign">\</span>
              <span class="quote">"$s"</span> <span class="quote">"$i"</span> <span class="quote">"${BASH_SOURCE[$i+1]:=&lt;shell&gt;}"</span>                        <span class="sign">\</span>
              <span class="quote">"${BASH_LINENO[$i]}"</span> <span class="quote">"${FUNCNAME[$i]}"</span>                           <span class="sign">\</span>
              <span class="quote">"$s"</span> <span class="quote">"$i"</span> <span class="quote">"$( <a href="#robo33">err::sourcecode</a> $i || echo ....... )"</span>

    s<span class="sign">+</span><span class="sign">=</span><span class="quote">" "</span>

  done

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'}\n\n'</span>

<span class="sign">}</span>
</pre>
<a name="robo35"></a>
<a name="liberr2ferr3a3astatus"></a>
<h2>3.8.  liberr/err::status [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::status</strong> &lt;number&gt; &lt;string&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Set in global variables $_bashlyk_{i,s}Error[$BASHPID] arbitrary values as
    error states - number and string
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;number&gt; - error code - number or predefined name as 'iErrorXXX' or 'XXX'
    &lt;string&gt; - error text
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - arguments missing
    Unknown         - first argument is non valid
    1-255           - valid value of first argument
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::status</strong>                                                                #? $_bashlyk_iErrorInvalidVariable
    <strong>err::status</strong> invalid argument                                               #? $_bashlyk_iErrorUnknown
    <strong>err::status</strong> 555                                                            #? $_bashlyk_iErrorUnexpected
    <strong>err::status</strong> AlreadyStarted "$$"                                            #? $_bashlyk_iErrorAlreadyStarted
    <strong>err::status</strong> iErrorInvalidVariable 12Invalid test                           #? $_bashlyk_iErrorInvalidVariable
    <strong>err::status</strong> | {{ '^invalid variable - 12Invalid test (200)$' }}
    <strong>err::status</strong> NotAvailable test unit
    echo $(<strong>err::status</strong>) | {{'^target is not available - test unit (166)$'}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::status</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iLastError<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <a href="#robo70">err::status.show</a> <span class="sign">$</span>BASHPID

    elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iLastError<span class="sign">[</span><span class="sign">$</span><span class="sign">$</span><span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <a href="#robo70">err::status.show</a> <span class="sign">$</span><span class="sign">$</span>

    fi

    return

  fi

  <a href="#robo68">err::orr</a> <span class="sign">$</span>1

  local i<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  <span class="sign">(</span><span class="sign">(</span> i <span class="sign">=</span><span class="sign">=</span> 255 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> i<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorUnknown <span class="sign">|</span><span class="sign">|</span> shift

  _bashlyk_iLastError<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">=</span><span class="sign">$</span>i

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> _bashlyk_sLastError<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">=</span><span class="quote">"$*"</span>

  return <span class="sign">$</span>i

<span class="sign">}</span>
</pre>
<a name="robo54"></a>
<a name="liberr2ferr3a3a5f5fadd5fthrow5fto5fcommand"></a>
<h2>3.9.  liberr/err::__add_throw_to_command [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::__add_throw_to_command</strong> &lt;command line&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    add controlled trap for errors of the &lt;commandline&gt;
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;commandline&gt; - source command line
</pre>
<p class="item_name">OUTPUT</p>
<pre>    changed command line
</pre>
<p class="item_name">NOTES</p>
<pre>    private method, used for 'try ..catch' emulation
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s='command --with -a -- arguments' cmd='<strong>err::__add_throw_to_command</strong>'
    $cmd $s                                                                    | {{{
    _bashlyk_sLastError[$BASHPID]="command: $(<a href="#robo126">std::trim</a> command --with -a -- arguments)\n output: {\n$(command --with -a -- arguments 2&gt;&amp;1)\n}" &amp;&amp; echo -n . || return $?;
 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::__add_throw_to_command</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s

  s<span class="sign">=</span><span class="squote">'_bashlyk_sLastError[$BASHPID]="command: $(<a href="#robo126">std::trim</a> '</span><span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">/</span><span class="sign">;</span><span class="sign">/</span><span class="sign">}</span><span class="squote">')\n output: '</span>
  s<span class="sign">+</span><span class="sign">=</span><span class="squote">'{\n$('</span><span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">/</span><span class="sign">;</span><span class="sign">/</span><span class="sign">}</span><span class="squote">' 2&gt;&amp;1)\n}" &amp;&amp; echo -n . || return $?;'</span>

  echo <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo55"></a>
<a name="liberr2ferr3a3a5f5fconvert5ftry5fto5ffunc"></a>
<h2>3.10.  liberr/err::__convert_try_to_func [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::__convert_try_to_func</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    convert "try" block to the function with controlled traps of the errors
</pre>
<p class="item_name">OUTPUT</p>
<pre>    function definition for evaluate
</pre>
<p class="item_name">NOTES</p>
<pre>    private method, used for 'try ..catch' emulation
</pre>
<p class="item_name">TODO</p>
<pre>    error handling for input 'try' function checking not worked
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::__convert_try_to_func</strong>                                                 | {{"^${TMPDIR}/.*ok.*fail.*; false; }$"}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::__convert_try_to_func</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s
  <a href="#robo125">std::temp</a> <span class="sign">-</span>v s

  while read <span class="sign">-</span>t 4<span class="sign">;</span> do

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">(</span>try <span class="sign">\</span><span class="sign">(</span><span class="sign">\</span><span class="sign">)</span><span class="sign">|</span><span class="sign">\</span><span class="sign">{</span><span class="sign">|</span><span class="sign">\</span><span class="sign">}</span><span class="sign">)</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <a href="#robo54">err::__add_throw_to_command</a> <span class="sign">$</span>REPLY

    else

      <span class="sign">#</span>echo <span class="quote">"${REPLY/try/try${s//\//.}}"</span>
      echo <span class="quote">"${REPLY/try/$s}"</span>

    fi

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> declare <span class="sign">-</span>f try 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null<span class="sign">)</span>

  echo <span class="sign">$</span>s<span class="squote">' &amp;&amp; echo " ok." || { <a href="#robo35">err::status</a> $?; echo " fail..($?)"; false; }'</span>
  rm <span class="sign">-</span>f <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo56"></a>
<a name="liberr2ferr3a3a5f5fgenerate"></a>
<h2>3.11.  liberr/err::__generate [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::__generate</strong> [&lt;state&gt;] [&lt;action&gt;] [[hint=]&lt;message&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    The internal part of the function <a href="#robo32">err::generate</a> for protecting variables in
    arguments from local variables of this functions when calling the "eval"
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;action&gt; - directly determines how the error handling. Possible actions:

     echo        - just prepare a message from the string argument to STDERR
     warn        - prepare a message from the string argument for transmission
                   to the notification system
     return      - set return from the function. In the global context - the
                   end of the script (exit)
     echo+return - the combined action of 'echo'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to STDERR
     warn+return - the combined action of 'warn'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to the notification
                   system
     exit        - set unconditional completion of the script
     echo+exit   - the same as 'exit', but with the transfer of messages from a
                   string of arguments to STDERR
     warn+exit   - the same as 'echo+exit', but with the transfer of messages
                   to the notification system
     throw       - the same as 'warn+exit', but with the transfer of messages
                   and the call stack to the notification system

    If an action is not specified, it uses stored in the global variable
    $_bashlyk_onError action. If it is not valid, then use action 'throw'

    state - number or predefined name as 'iError&lt;Name&gt;' or '&lt;Name&gt;' by which
            one can get the error code from the global variable
            $_bashlyk_iError&lt;..&gt; and its description from global hash
            $_bashlyk_hError
            If the error code is not specified, it is set to the return code of
            the last executed command. In the end, the resulting numeric code
            initializes a global variable $_bashlyk_iLastError[$BASHPID]

    message - error detail, such as the filename. When specifying message
    should bear in mind that in the error table ($_bashlyk_hError) are already
    prepared descriptions &lt;...&gt;
</pre>
<p class="item_name">OUTPUT</p>
<pre>    command line, which can be performed using the eval &lt;...&gt;
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmd
    cmd='<strong>err::__generate</strong> 1 NoSuchFileOrDir warn /notexist'
    _bashlyk_onError=debug
    $cmd                                                                       | {{{
    <a href="#robo34">err::stacktrace</a> | <a href="#robo99">msg::warn</a> -  Warn: no\ such\ file\ or\ directory\ -\ /notexist\ ..\ \(185\) &gt;&amp;2; <a href="#robo35">err::status</a> 185 "/notexist"; :; #
 }}}
    _bashlyk_onError=echo
    $cmd                                                                       | {{{
    <a href="#robo99">msg::warn</a>  Warn: no\ such\ file\ or\ directory\ -\ /notexist\ ..\ \(185\) &gt;&amp;2; <a href="#robo35">err::status</a> 185 "/notexist"; :; #
 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::__generate</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i IFS sAction sMessage s rc rs fn echo warn
  local <span class="sign">-</span>a a
  <span class="sign">#</span>
  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> rc<span class="sign">=</span><span class="sign">$</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorUnknown
  <span class="sign">#</span>
      IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>
        a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">/</span><span class="sign">-</span><span class="sign">-</span><span class="sign">/</span><span class="sign">}</span> <span class="sign">)</span>
     echo<span class="sign">=</span><span class="squote">'echo'</span>
     warn<span class="sign">=</span><span class="squote">'<a href="#robo99">msg::warn</a>'</span>
  sAction<span class="sign">=</span><span class="sign">$</span>_bashlyk_onError

  if   <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_err_reAct <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    sAction<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>
    rs<span class="sign">=</span><span class="sign">$</span>rc
    i<span class="sign">=</span>1

  elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_err_reAct <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    sAction<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rs<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">|</span><span class="sign">|</span> rs<span class="sign">=</span><span class="sign">$</span>rc
    i<span class="sign">=</span>2

  else

    i<span class="sign">=</span>0
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rs<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> i<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> rs<span class="sign">=</span><span class="sign">$</span>rc

  fi

  <a href="#robo68">err::orr</a> <span class="sign">$</span>rs<span class="sign">;</span> rs<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  if <span class="sign">(</span><span class="sign">(</span> rs <span class="sign">&gt;</span><span class="sign">=</span> <span class="sign">$</span>_bashlyk_iErrorUnknown <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    s<span class="sign">=</span><span class="quote">"(may be previous..) "</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>rc<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      rs<span class="sign">=</span><span class="sign">$</span>rc
      s<span class="sign">+</span><span class="sign">=</span><span class="quote">"${_bashlyk_hError[$rc]} - ${a[@]} .. ($rc)"</span>

    else

      <span class="sign">(</span><span class="sign">(</span> rs <span class="sign">=</span><span class="sign">=</span> 255 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rs<span class="sign">=</span><span class="sign">$</span>rc
      s<span class="sign">+</span><span class="sign">=</span><span class="quote">"${a[@]} .. ($rc)"</span>

    fi

  else

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_hError<span class="sign">[</span><span class="sign">$</span>rs<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      s<span class="sign">=</span><span class="quote">"${_bashlyk_hError[$rs]} - ${a[@]:$i} .. ($rs)"</span>

    else

      s<span class="sign">=</span><span class="quote">"${a[@]:$i} .. ($rs)"</span>

    fi

  fi

  printf <span class="sign">-</span>v s <span class="quote">"%q"</span> <span class="quote">"$s"</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"${FUNCNAME[1]}"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"main"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">-</span>z <span class="quote">"${FUNCNAME[1]}"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sAction <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">(</span><span class="sign">(</span>echo<span class="sign">|</span>warn<span class="sign">)</span><span class="sign">\</span><span class="sign">+</span><span class="sign">)</span><span class="sign">?</span>return<span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sAction<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>sAction<span class="sign">/</span>return<span class="sign">/</span>exit<span class="sign">}</span>

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_onError <span class="sign">=</span><span class="sign">=</span> debug <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    echo<span class="sign">=</span><span class="squote">'<a href="#robo34">err::stacktrace</a> | <a href="#robo110">std::cat</a>'</span>
    warn<span class="sign">=</span><span class="squote">'<a href="#robo34">err::stacktrace</a> | <a href="#robo99">msg::warn</a> -'</span>

  fi

  case <span class="quote">"${sAction,,}"</span> in

           echo<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">': '</span><span class="sign">;</span>        sMessage<span class="sign">=</span><span class="quote">"$echo  Warn: "</span><span class="sign">;</span><span class="sign">;</span>
    echo<span class="sign">+</span>return<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">'return $?'</span><span class="sign">;</span> sMessage<span class="sign">=</span><span class="quote">"$echo Error: "</span><span class="sign">;</span><span class="sign">;</span>
      echo<span class="sign">+</span>exit<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">'exit $?'</span><span class="sign">;</span>   sMessage<span class="sign">=</span><span class="quote">"$echo Error: "</span><span class="sign">;</span><span class="sign">;</span>
           warn<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">': '</span><span class="sign">;</span>        sMessage<span class="sign">=</span><span class="quote">"$warn  Warn: "</span><span class="sign">;</span><span class="sign">;</span>
    warn<span class="sign">+</span>return<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">'return $?'</span><span class="sign">;</span> sMessage<span class="sign">=</span><span class="quote">"$warn Error: "</span><span class="sign">;</span><span class="sign">;</span>
      warn<span class="sign">+</span>exit<span class="sign">)</span> sAction<span class="sign">=</span><span class="squote">'exit $?'</span><span class="sign">;</span>   sMessage<span class="sign">=</span><span class="quote">"$warn Error: "</span><span class="sign">;</span><span class="sign">;</span>
    exit<span class="sign">|</span>return<span class="sign">)</span> sAction<span class="sign">=</span><span class="quote">"${sAction,,} \$?"</span><span class="sign">;</span> sMessage<span class="sign">=</span><span class="quote">": "</span><span class="sign">;</span><span class="sign">;</span>
              <span class="sign">*</span><span class="sign">)</span>
                 sAction<span class="sign">=</span><span class="squote">'exit $?'</span>
                 sMessage<span class="sign">=</span><span class="squote">'<a href="#robo34">err::stacktrace</a> | <a href="#robo99">msg::warn</a> - Error: '</span>
          <span class="sign">;</span><span class="sign">;</span>

  esac

  i<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">:</span><span class="sign">$</span>i<span class="sign">}</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_onError <span class="sign">=</span><span class="sign">=</span> debug <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    sAction<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>sAction<span class="sign">/</span>exit<span class="sign">/</span><a href="#robo68">err::orr</a><span class="sign">}</span>
    sAction<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>sAction<span class="sign">/</span>return<span class="sign">/</span><a href="#robo68">err::orr</a><span class="sign">}</span>

  fi

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s &gt;&amp;2; <a href="#robo35">err::status</a> %s "%s"; %s; #'</span> <span class="sign">\</span>
            <span class="quote">"${sMessage}${s}"</span> <span class="quote">"$rs"</span> <span class="quote">"${i//\;/}"</span> <span class="quote">"$sAction"</span>

<span class="sign">}</span>
</pre>
<a name="robo57"></a>
<a name="liberr2ferr3a3aAlreadyExist"></a>
<h2>3.12.  liberr/err::AlreadyExist [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::AlreadyExist</strong> &lt;filename&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is empty, not exists, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;filename&gt; - filesystem object for checking
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    AlreadyExist - specified filesystem object is exists
    0            - no arguments, specified filesystem object are not found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmdYes='/bin/sh' pathNo1="/tmp" cmdNo1="bin_${RANDOM}"
    <strong>err::AlreadyExist</strong>                                                          #? true
    <strong>err::AlreadyExist</strong> $cmdNo1                                                  #? true
    $(<strong>err::AlreadyExist</strong> $pathNo1 || exit 123)                                  #? 123
    <strong>err::AlreadyExist</strong> $cmdYes                                                  #? $_bashlyk_iErrorAlreadyExist
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::AlreadyExist</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>e <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return <span class="sign">$</span>_bashlyk_iErrorAlreadyExist <span class="sign">|</span><span class="sign">|</span> return 0

<span class="sign">}</span>
</pre>
<a name="robo58"></a>
<a name="liberr2ferr3a3aCommandNotFound"></a>
<h2>3.13.  liberr/err::CommandNotFound [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::CommandNotFound</strong> &lt;filename&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is not empty, exists and executable
    designed to check the conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    filename - argument for executable file matching by searching the PATH
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    CommandNotFound - no arguments, specified filename is nonexistent or not
                      executable
    0               - specified filename are found and executable
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmdYes='sh' cmdNo1="bin_${RANDOM}" cmdNo2="bin_${RANDOM}"
    <strong>err::CommandNotFound</strong>                                                       #? $_bashlyk_iErrorCommandNotFound
    <strong>err::CommandNotFound</strong> $cmdNo1                                               #? $_bashlyk_iErrorCommandNotFound
    $( <strong>err::CommandNotFound</strong> $cmdNo2 || exit 123 )                              #? 123
    <strong>err::CommandNotFound</strong> $cmdYes                                               #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::CommandNotFound</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> hash <span class="quote">"$*"</span> 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorCommandNotFound

<span class="sign">}</span>
</pre>
<a name="robo59"></a>
<a name="liberr2ferr3a3aEmptyResult"></a>
<h2>3.14.  liberr/err::EmptyResult [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::EmptyResult</strong> &lt;argument&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is not empty
    designed to check the conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;argument&gt; - one argument
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    EmptyResult - argument is empty
    0           - non empty argument
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a b="$RANDOM"
    <strong>err::EmptyResult</strong>                                                           #? $_bashlyk_iErrorEmptyResult
    <strong>err::EmptyResult</strong> $a                                                        #? $_bashlyk_iErrorEmptyResult
    $(<strong>err::EmptyResult</strong> $a || exit 123)                                         #? 123
    $(<strong>err::EmptyResult</strong> $b &amp;&amp; exit 123)                                         #? 123
    <strong>err::EmptyResult</strong> $b                                                        #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::EmptyResult</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorEmptyResult

<span class="sign">}</span>
</pre>
<a name="robo60"></a>
<a name="liberr2ferr3a3aEmptyVariable"></a>
<h2>3.15.  liberr/err::EmptyVariable [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::EmptyVariable</strong> &lt;variable&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, valid variable
    designed to check the conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    variable - expected variable name
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    EmptyVariable - argument is empty, invalid or empty variable
    0             - valid not empty variable
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a b="$RANDOM"
    <strong>err::EmptyVariable</strong>                                                         #? $_bashlyk_iErrorEmptyVariable
    <strong>err::EmptyVariable</strong> a                                                       #? $_bashlyk_iErrorEmptyVariable
    $(<strong>err::EmptyVariable</strong> a || exit 123)                                        #? 123
    $(<strong>err::EmptyVariable</strong> b &amp;&amp; exit 123)                                        #? 123
    <strong>err::EmptyVariable</strong> b                                                       #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::EmptyVariable</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo122">std::isVariable</a> <span class="quote">"$1"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>1<span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorEmptyVariable

<span class="sign">}</span>
</pre>
<a name="robo61"></a>
<a name="liberr2ferr3a3aInvalidVariable"></a>
<h2>3.16.  liberr/err::InvalidVariable [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::InvalidVariable</strong> &lt;variable&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, valid variable, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;variable&gt; - expected variable name
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    InvalidVariable - argument is empty or invalid variable
    0               - valid variable
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::InvalidVariable</strong>                                                       #? $_bashlyk_iErrorInvalidVariable
    <strong>err::InvalidVariable</strong> 1a                                                    #? $_bashlyk_iErrorInvalidVariable
    <strong>err::InvalidVariable</strong> a1                                                    #? true
    $(<strong>err::InvalidVariable</strong> 2b || exit 123)                                     #? 123
    $(<strong>err::InvalidVariable</strong> c3 &amp;&amp; exit 123)                                     #? 123
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::InvalidVariable</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo122">std::isVariable</a> <span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorInvalidVariable

<span class="sign">}</span>
</pre>
<a name="robo62"></a>
<a name="liberr2ferr3a3aMissingArgument"></a>
<h2>3.17.  liberr/err::MissingArgument [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::MissingArgument</strong> &lt;argument&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is not empty
    designed to check the conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    argument - one argument
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    MissingArgument - argument is empty
    0               - non empty argument
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a b="$RANDOM"
    <strong>err::MissingArgument</strong>                                                       #? $_bashlyk_iErrorMissingArgument
    <strong>err::MissingArgument</strong> $a                                                    #? $_bashlyk_iErrorMissingArgument
    $(<strong>err::MissingArgument</strong> $a || exit 123)                                     #? 123
    $(<strong>err::MissingArgument</strong> $b &amp;&amp; exit 123)                                     #? 123
    <strong>err::MissingArgument</strong> $b                                                    #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::MissingArgument</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

<span class="sign">}</span>
</pre>
<a name="robo63"></a>
<a name="liberr2ferr3a3aNoSuchDir"></a>
<h2>3.18.  liberr/err::NoSuchDir [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::NoSuchDir</strong> &lt;directory&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, exists, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;directory&gt; - directory for checking
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    NoSuchDir - no arguments, specified directory is nonexistent
    0         - specified directory are found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local pathYes='/tmp' pathNo1="/bin_${RANDOM}" pathNo2="/bin_${RANDOM}"
    <strong>err::NoSuchDir</strong>                                                             #? $_bashlyk_iErrorNoSuchDir
    <strong>err::NoSuchDir</strong> $pathNo1                                                    #? $_bashlyk_iErrorNoSuchDir
    $(<strong>err::NoSuchDir</strong> $pathNo2 || exit 123)                                     #? 123
    <strong>err::NoSuchDir</strong> $pathYes                                                    #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::NoSuchDir</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>d <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNoSuchDir

<span class="sign">}</span>
</pre>
<a name="robo64"></a>
<a name="liberr2ferr3a3aNoSuchFile"></a>
<h2>3.19.  liberr/err::NoSuchFile [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::NoSuchFile</strong> &lt;filename&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, exists, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;filename&gt; - filesystem object for checking
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    NoSuchFile - no arguments, specified file is nonexistent
    0          - specified file are found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmdYes='/bin/sh' cmdNo1="bin_${RANDOM}" cmdNo2="bin_${RANDOM}"
    <strong>err::NoSuchFile</strong>                                                            #? $_bashlyk_iErrorNoSuchFile
    <strong>err::NoSuchFile</strong> $cmdNo1                                                    #? $_bashlyk_iErrorNoSuchFile
    $(<strong>err::NoSuchFile</strong> $cmdNo2 || exit 123)                                     #? 123
    <strong>err::NoSuchFile</strong> $cmdYes                                                    #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::NoSuchFile</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>f <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNoSuchFile

<span class="sign">}</span>
</pre>
<a name="robo65"></a>
<a name="liberr2ferr3a3aNoSuchFileOrDir"></a>
<h2>3.20.  liberr/err::NoSuchFileOrDir [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::NoSuchFileOrDir</strong> &lt;filename&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, exists, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;filename&gt; - filesystem object for checking
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    NoSuchFileOrDir - no arguments, specified filesystem object is nonexistent
    0               - specified filesystem object are found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmdYes='/bin/sh' cmdNo1="bin_${RANDOM}" cmdNo2="bin_${RANDOM}"
    <strong>err::NoSuchFileOrDir</strong>                                                       #? $_bashlyk_iErrorNoSuchFileOrDir
    <strong>err::NoSuchFileOrDir</strong> $cmdNo1                                               #? $_bashlyk_iErrorNoSuchFileOrDir
    $(<strong>err::NoSuchFileOrDir</strong> $cmdNo2 || exit 123)                                #? 123
    <strong>err::NoSuchFileOrDir</strong> $cmdYes                                               #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::NoSuchFileOrDir</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>e <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNoSuchFileOrDir

<span class="sign">}</span>
</pre>
<a name="robo66"></a>
<a name="liberr2ferr3a3aNotExistNotCreated"></a>
<h2>3.21.  liberr/err::NotExistNotCreated [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::NotExistNotCreated</strong> &lt;path&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, exists or succesfully created.
    Designed to check the conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;path&gt; - filesystem directory for checking
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    NotExistNotCreated - no arguments, the specified path does not exist and is
                         not created
    0                  - specified path are found or created
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local pathYes='/tmp' pathNo1=""
    <strong>err::NotExistNotCreated</strong>                                                    #? $_bashlyk_iErrorNotExistNotCreated
    <strong>err::NotExistNotCreated</strong> $pathNo1                                           #? $_bashlyk_iErrorNotExistNotCreated
    $(<strong>err::NotExistNotCreated</strong> $pathNo1 || exit 123)                            #? 123
    <strong>err::NotExistNotCreated</strong> $pathYes                                           #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::NotExistNotCreated</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNotExistNotCreated

  if <span class="sign">!</span> mkdir <span class="sign">-</span>p <span class="quote">"$@"</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

    return <span class="sign">$</span>_bashlyk_iErrorNotExistNotCreated

  else

    return 0

  fi

<span class="sign">}</span>
</pre>
<a name="robo67"></a>
<a name="liberr2ferr3a3aNotNumber"></a>
<h2>3.22.  liberr/err::NotNumber [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::NotNumber</strong> &lt;argument&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return true if argument is non empty, valid number, designed to check the
    conditions in the function <a href="#robo69">err::postfix</a>
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;argument&gt; - expected number
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    NotNumber  - argument is empty or not number
    0          - valid number
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::NotNumber</strong>                                                             #? $_bashlyk_iErrorNotNumber
    <strong>err::NotNumber</strong> 1a                                                          #? $_bashlyk_iErrorNotNumber
    <strong>err::NotNumber</strong> 12                                                          #? true
    $(<strong>err::NotNumber</strong> 2b || exit 123)                                           #? 123
    $(<strong>err::NotNumber</strong> 33 &amp;&amp; exit 123)                                           #? 123
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::NotNumber</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNotNumber

<span class="sign">}</span>
</pre>
<a name="robo68"></a>
<a name="liberr2ferr3a3aorr"></a>
<h2>3.23.  liberr/err::orr [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::orr</strong> [&lt;arg&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    return status from 0 to 255 (default 255)
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    arg - expected 0-254
</pre>
<p class="item_name">NOTES</p>
<pre>    public method
  ERROR
    255 - first argument is not valid
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>err::orr</strong>                                                                   #? 255
    <strong>err::orr</strong> 0                                                                 #? true
    <strong>err::orr</strong> 123                                                               #? 123
    <strong>err::orr</strong> 256                                                               #? 255
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::orr</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    i<span class="sign">=</span><span class="sign">$</span>1

  else

    eval <span class="quote">"i=\"\$_bashlyk_iError${1}\""</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>i <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> eval <span class="quote">"i=\"\$_bashlyk_${1}\""</span>

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>i <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> i <span class="sign">&lt;</span> 256 <span class="sign">)</span><span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> i<span class="sign">=</span>255

  return <span class="sign">$</span>i

<span class="sign">}</span>
</pre>
<a name="robo69"></a>
<a name="liberr2ferr3a3apostfix"></a>
<h2>3.24.  liberr/err::postfix [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::postfix</strong> &lt;action&gt; on &lt;state&gt; &lt;argument&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Flexible error handling. Processing is controlled by global variables or
    arguments, and consists in a warning message, the function returns, or the
    end of the script with a certain return code. Messages may include a stack
    trace and printed to stderr
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;action&gt; - directly determines how the error handling. Possible actions:
     echo        - just prepare a message from the string argument to STDERR
     warn        - prepare a message from the string argument for transmission
                   to the notification system
     return      - set return from the function. In the global context - the
                   end of the script (exit)
     echo+return - the combined action of 'echo'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to STDERR
     warn+return - the combined action of 'warn'+'return', however, if the code
                   is not within the function, it is only the transfer of
                   messages from a string of arguments to the notification
                   system
     exit        - set unconditional completion of the script
     echo+exit   - the same as 'exit', but with the transfer of messages from a
                   string of arguments to STDERR
     warn+exit   - the same as 'echo+exit', but with the transfer of messages
                   to the notification system
     throw       - the same as 'warn+exit', but with the transfer of messages
                   and the call stack to the notification system
    &lt;state&gt;      - handled error type, are supported:
                     CommandNotFound
                     NoSuchFileOrDir
                     InvalidVariable
                     EmptyVariable
                     MissingArgument
                     EmptyResult
    &lt;argument&gt;   - checked value by type (see &lt;state&gt;)
</pre>
<p class="item_name">OUTPUT</p>
<pre>    see error ...
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fn1 fn2
    <a href="#robo125">std::temp</a> fn1
    <a href="#robo125">std::temp</a> fn2
    <strong>err::postfix</strong> warn on NoSuchFileOrDir /err.handler                          #? true
    errorify+echo on CommandNotFound notexist.return                           #? $_bashlyk_iErrorCommandNotFound
    warn on NoSuchFileOrDir /notexist.warn                                     #? true
    $(throw on NoSuchFileOrDir "$fn1" "$fn2")                                  #? true
    errorify on NoSuchFileOrDir "/notexist.echo" "/notexist.warn"              #? $_bashlyk_iErrorNoSuchFileOrDir
    $(throw on NoSuchFileOrDir "/notexist.throw.child")                        #? $_bashlyk_iErrorNoSuchFileOrDir
    $(exit+echo on CommandNotFound notexist.exit+echo.child)                   #? $_bashlyk_iErrorCommandNotFound
    $(errorify on CommandNotFound notexist.errorify.child || return)           #? $_bashlyk_iErrorCommandNotFound
    $(errorify on NotNumber q123 || return)                                    #? $_bashlyk_iErrorNotNumber
    $(errorify on NotExistNotCreated || return)                                #? $_bashlyk_iErrorNotExistNotCreated
    warn on CommandNotFound notexist nomoreexist                               #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::postfix</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local <span class="sign">-</span>a aErrHandler<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>
  local re<span class="sign">=</span><span class="squote">'^(echo|warn)$|^((echo|warn)[+])?(exit|return)$|^throw$'</span> i<span class="sign">=</span>0 j<span class="sign">=</span>0 s
  <span class="sign">#</span><span class="sign">#</span> TODO add reAction and reState for safely arguments parsing

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> error InvalidArgument throw <span class="sign">$</span><span class="sign">{</span>1<span class="sign">:</span><span class="sign">-</span>first argument<span class="sign">}</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">=</span> on  <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> error InvalidArgument throw <span class="sign">$</span><span class="sign">{</span>1<span class="sign">:</span><span class="sign">-</span>second argument<span class="sign">}</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1        <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> error MissingArgument throw <span class="sign">$</span><span class="sign">{</span>1<span class="sign">:</span><span class="sign">-</span>third argument<span class="sign">}</span>

  if <span class="sign">!</span> declare <span class="sign">-</span>f err<span class="sign">:</span><span class="sign">:</span><span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

    error InvalidArgument throw <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span>

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> error <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">:</span>3<span class="sign">}</span>

  for s in <span class="quote">"$@"</span><span class="sign">;</span> do

    <span class="sign">:</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> j<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span>

    if <span class="sign">!</span> err<span class="sign">:</span><span class="sign">:</span><span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span>s<span class="sign">;</span> then

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="sign">$</span>j

      <span class="sign">(</span><span class="sign">(</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">=</span><span class="sign">=</span> 0 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> aErrHandler<span class="sign">[</span>3<span class="sign">]</span><span class="sign">=</span><span class="sign">$</span>s <span class="sign">|</span><span class="sign">|</span> aErrHandler<span class="sign">[</span>3<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">", $s"</span>

    fi

  done

  if <span class="sign">(</span><span class="sign">(</span> i <span class="sign">&gt;</span> 0 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    <span class="sign">(</span><span class="sign">(</span> i <span class="sign">&gt;</span> 1 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> aErrHandler<span class="sign">[</span>3<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">" [total $i]"</span>
    error <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>aErrHandler<span class="sign">[</span>3<span class="sign">]</span><span class="sign">}</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo70"></a>
<a name="liberr2ferr3a3astatus2eshow"></a>
<h2>3.25.  liberr/err::status.show [ internal function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ internal function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::status.show</strong> [&lt;pid&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Show last saved error state for process with &lt;pid&gt; or $BASHPID default
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;pid&gt; - select process, default current bash subshell $BASHPID
</pre>
<p class="item_name">NOTES</p>
<pre>    private method
</pre>
<p class="item_name">ERRORS</p>
<pre>    Unknown         - first argument is non valid
    1-254           - valid value of first argument
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local pid=$BASHPID
    echo "$_bashlyk_iPidMax" | {{ "^[[:digit:]]*$" }}
    <a href="#robo35">err::status</a> iErrorInvalidVariable "12Invalid"                              #? $_bashlyk_iErrorInvalidVariable
    <strong>err::status.show</strong>                                                           #? $_bashlyk_iErrorInvalidVariable
    <strong>err::status.show</strong> invalid argument                                          #? $_bashlyk_iErrorInvalidVariable
    <strong>err::status.show</strong> $$                                                        #? $_bashlyk_iErrorInvalidVariable
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::status.show</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local pid

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>1 <span class="sign">&lt;</span> <span class="sign">$</span>_bashlyk_iPidMax <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> pid<span class="sign">=</span><span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> pid<span class="sign">=</span><span class="sign">$</span>BASHPID

  local i s

  i<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_iLastError<span class="sign">[</span><span class="sign">$</span>pid<span class="sign">]</span><span class="sign">}</span>
  s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_sLastError<span class="sign">[</span><span class="sign">$</span>pid<span class="sign">]</span><span class="sign">}</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>i <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>i <span class="sign">&lt;</span> 255 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    echo <span class="quote">"${_bashlyk_hError[$i]} - $s ($i)"</span>
    return <span class="sign">$</span>i

  else

    echo <span class="quote">"$s ($i)"</span>
    return <span class="sign">$</span>_bashlyk_iErrorUnexpected

  fi

<span class="sign">}</span>
</pre>
<a name="robo83"></a>
<a name="liberr2ferr3a3adebug"></a>
<h2>3.26.  liberr/err::debug [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::debug</strong> &lt;level&gt; &lt;message&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show a &lt;message&gt; on stderr if the &lt;level&gt; is equal or less than the
    $DEBUGLEVEL value otherwise return code 1
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;level&gt;   - decimal number of the debug level ( 0 for wrong argument)
    &lt;message&gt; - debug message
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show a &lt;message&gt; on stderr
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0               - &lt;level&gt; equal or less than $DEBUGLEVEL value
    1               - &lt;level&gt; more than $DEBUGLEVEL value
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    DEBUGLEVEL=0
    <strong>err::debug</strong>                                                                 #? $_bashlyk_iErrorMissingArgument
    <strong>err::debug</strong> 0 echo level 0                                                  #? true
    <strong>err::debug</strong> 1 silence level 0                                               #? 1
    DEBUGLEVEL=5
    <strong>err::debug</strong> 0 echo level 5                                                  #? true
    <strong>err::debug</strong> 6 echo 5                                                        #? 1
    <strong>err::debug</strong> default level test '(0)'                                        #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::debug</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>DEBUGLEVEL<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span> <span class="sign">&gt;</span><span class="sign">=</span> <span class="sign">$</span>1 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> return 1

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span> <span class="sign">&gt;</span><span class="sign">&amp;</span>2

  return 0

<span class="sign">}</span>
</pre>
<a name="robo84"></a>
<a name="liberr2ferr3a3adebugf"></a>
<h2>3.27.  liberr/err::debugf [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo73">liberr</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>err::debugf</strong> &lt;level&gt; &lt;format&gt; &lt;values&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show a formatted message on the stderr if the &lt;level&gt; is equal or less than
    the $DEBUGLEVEL value otherwise return code 1
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;level&gt;  - decimal number of the debug level ( 0 for wrong argument)
    &lt;format&gt; - printf format string
    &lt;values&gt; - values for format string
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show a formatted message on the stderr
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0               - &lt;level&gt; equal or less than $DEBUGLEVEL value
    1               - &lt;level&gt; more than $DEBUGLEVEL value
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    DEBUGLEVEL=0
    <strong>err::debugf</strong>                                                                #? $_bashlyk_iErrorMissingArgument
    <strong>err::debugf</strong> 0 '%s: %s\n' 'level0' "$(date -R)" 2&gt;&amp;1                        | {{ ^level0: }}
    <strong>err::debugf</strong> 1 '%s\n' 'level 1'                                             #? 1
    DEBUGLEVEL=5
    <strong>err::debugf</strong> 4 "%s: %s\n" "level5" "$(date -R)" 2&gt;&amp;1                        | {{ ^level5: }}
    <strong>err::debugf</strong> 6 '%s:\n' 'level6'                                             #? 1
    <strong>err::debugf</strong> '%s:\n' 'default0' 2&gt;&amp;1                                        | {{ ^default0: }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>err::debugf</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>DEBUGLEVEL<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span> <span class="sign">&gt;</span><span class="sign">=</span> <span class="sign">$</span>1 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift <span class="sign">|</span><span class="sign">|</span> return 1

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> eval <span class="squote">'printf -- "$@" &gt;&amp;2'</span>

  return <span class="sign">$</span><span class="sign">?</span>

<span class="sign">}</span>
</pre>
<a name="robo74"></a>
<a name="BASHLYK2fliblog"></a>
<h1>4.  BASHLYK/liblog [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    The library contains a set of functions for controlling the output of the
    script messages
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a> <a href="#robo75">libmsg</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo2"></a>
<a name="liblog2fUsed20libraries"></a>
<h2>4.1.  liblog/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
</pre>
<a name="robo10"></a>
<a name="liblog2fGlobal20variables"></a>
<h2>4.2.  liblog/Global variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">#</span><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_fnLogSock<span class="sign">:</span><span class="sign">=</span><span class="sign">}</span>
<span class="sign">#</span><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_pidLogSock<span class="sign">:</span><span class="sign">=</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>HOSTNAME<span class="sign">:</span><span class="sign">=</span>localhost<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_emailSubj<span class="sign">:</span><span class="sign">=</span><span class="quote">"${_bashlyk_sUser}@${HOSTNAME}::${_bashlyk_s0}"</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_fnLog<span class="sign">:</span><span class="sign">=</span><span class="quote">"${_bashlyk_pathLog}/${_bashlyk_s0}.log"</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_bUseSyslog<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_bNotUseLog<span class="sign">:</span><span class="sign">=</span>1<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sCond4Log<span class="sign">:</span><span class="sign">=</span>redirect<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iPidMax<span class="sign">:</span><span class="sign">=</span>999999<span class="sign">}</span>

declare <span class="sign">-</span>rg _bashlyk_aRequiredCmd_log<span class="sign">=</span><span class="quote">"

    [ date hostname logger mkdir mkfifo rm touch tty

"</span>

declare <span class="sign">-</span>rg _bashlyk_aExport_log<span class="sign">=</span><span class="quote">"

    log::{add,file,ger,init,interactivity,necessity,terminality}

"</span>
</pre>
<a name="robo85"></a>
<a name="liblog2flog3a3aadd"></a>
<h2>4.3.  liblog/log::add [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::add</strong> [-] [&lt;text&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Wrapper around <a href="#robo87">log::ger</a> to support stream from standard input
</pre>
<p class="item_name">INPUTS</p>
<pre>    -      - data is expected from standard input
    &lt;text&gt; - String (tag) for output.
             If there is a "-" as the first argument, then the string is
             considered a prefix (tag) for each line from the standard input.
</pre>
<p class="item_name">OUTPUT</p>
<pre>   Depends on output parameters
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    # TODO improve test
    echo -n . | <strong>log::add</strong> -                                                     | {{ '^\.$'       }}
    echo test | <strong>log::add</strong> - tag                                                 | {{ '^tag test$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::add</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local sTag s

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    shift
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sTag<span class="sign">=</span><span class="quote">"$* "</span>

    while read s <span class="sign">|</span><span class="sign">|</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> do <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo87">log::ger</a> <span class="quote">"${sTag}${s}"</span><span class="sign">;</span> done

  else

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo87">log::ger</a> <span class="quote">"$*"</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo86"></a>
<a name="liblog2flog3a3afile"></a>
<h2>4.4.  liblog/log::file [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::file</strong> [&lt;filename&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Wrapper around <a href="#robo88">log::init</a> to activate output redirection to the log
    &lt;filename&gt; with error handling
</pre>
<p class="item_name">ERRORS</p>
<pre>     NotExistNotCreated - log file can not be created, abort
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fnLog=$(mktemp --suffix=.log || tempfile -s .test.log)
    rm -f $fnLog
    <strong>log::file</strong> $fnLog                                                           #? true
    ls -l $fnLog                                                               #? true
    rm -f $fnLog
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::file</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  case <span class="quote">"$1"</span> in
          <span class="squote">''</span><span class="sign">)</span> <span class="sign">;</span><span class="sign">;</span>
    <span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span><span class="sign">)</span> _bashlyk_fnLog<span class="sign">=</span><span class="quote">"${_bashlyk_pathLog}/$1"</span><span class="sign">;</span><span class="sign">;</span>
           <span class="sign">*</span><span class="sign">)</span>
              _bashlyk_fnLog<span class="sign">=</span><span class="quote">"$1"</span>
              _bashlyk_pathLog<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_fnLog<span class="sign">%</span><span class="sign">/</span><span class="sign">*</span><span class="sign">}</span>
           <span class="sign">;</span><span class="sign">;</span>
  esac

  <span class="sign">{</span>

    mkdir <span class="sign">-</span>p <span class="quote">"$_bashlyk_pathLog"</span>
    touch <span class="quote">"$_bashlyk_fnLog"</span>

  <span class="sign">}</span> <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated throw <span class="sign">$</span>_bashlyk_fnLog

  <a href="#robo88">log::init</a>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo87"></a>
<a name="liblog2flog3a3ager"></a>
<h2>4.5.  liblog/log::ger [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::ger</strong> &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    log engine for adding &lt;text&gt; to log file with standart stamps if logging is
    setted
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;text&gt; - input text
</pre>
<p class="item_name">OUTPUT</p>
<pre>    There are four possibilities:
     * stdout only
     * $_bashlyk_fnLog only
     * syslog by logger and stdout
     * syslog by logger and $_bashlyk_fnLog
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local bInteract bNotUseLog bTerminal
    <a href="#robo107">_</a> =bInteract
    <a href="#robo107">_</a> =bNotUseLog
    <a href="#robo107">_</a> =bTerminal
    local b=true fnExec reT reP s
    fnExec=$(mktemp --suffix=.sh || tempfile -s .test.sh)
    reT='[ADFJMNOS][abceglnoprtuyv]{2} [0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}'
    reP="[[:space:]]$HOSTNAME ${0##*/}\[[[:digit:]]{${#_bashlyk_iPidMax}}\]:[[:space:]].*"
    cat &lt;&lt;'EOF' &gt; $fnExec                                                      #-
    local fnLog=$(mktemp --suffix=.log || tempfile -s .test.log)               #-
    <a href="#robo107">_</a> fnLog $fnLog                                                             #-
    <a href="#robo107">_</a> bInteract 0                                                              #-
    <a href="#robo107">_</a> bNotUseLog 0                                                             #-
    <a href="#robo107">_</a> bTerminal 0                                                              #-
    <a href="#robo88">log::init</a>                                                                  #-
    <a href="#robo107">_</a> fnLog                                                                    #-
    <strong>log::ger</strong> test                                                              #-
    date                                                                       #-
    echo $_bashlyk_pidLogSock                                                  #-
    echo '%d'                                                                  #-
    EOF                                                                        #-
    . $fnExec
    kill $_bashlyk_pidLogSock
    rm -f $_bashlyk_fnLogSock
    sleep 0.1
    while read -t9 s; do [[ $s =~ ^${reT}${reP}$ ]] || b=false; done &lt; $fnLog  #-
    [[ $b == true ]]                                                           #? true
    rm -f $fnExec $fnLog
    <a href="#robo107">_</a> bInteract "$bInteract"
    <a href="#robo107">_</a> bNotUseLog "$bNotUseLog"
    <a href="#robo107">_</a> bTerminal "$bTerminal"
    ## TODO test syslog mode
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::ger</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bSysLog bUseLog sTagLog IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  bSysLog<span class="sign">=</span>0
  bUseLog<span class="sign">=</span>0

  sTagLog<span class="sign">=</span><span class="quote">"${_bashlyk_s0}[$(printf -- "</span><span class="sign">%</span>0<span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>_bashlyk_iPidMax<span class="sign">}</span>d<span class="quote">" $$)]"</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>z <span class="quote">"$_bashlyk_bUseSyslog"</span> <span class="sign">|</span><span class="sign">|</span> <span class="quote">"$_bashlyk_bUseSyslog"</span> <span class="sign">-</span>eq 0 <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    bSysLog<span class="sign">=</span>0

  else

    bSysLog<span class="sign">=</span>1

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_bNotUseLog <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>_bashlyk_bNotUseLog <span class="sign">!</span><span class="sign">=</span> 0 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> bUseLog<span class="sign">=</span>0 <span class="sign">|</span><span class="sign">|</span> bUseLog<span class="sign">=</span>1

  else

    <a href="#robo90">log::necessity</a> <span class="sign">&amp;</span><span class="sign">&amp;</span> bUseLog<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> bUseLog<span class="sign">=</span>0

  fi

  mkdir <span class="sign">-</span>p <span class="quote">"$_bashlyk_pathLog"</span> <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated throw <span class="sign">$</span>_bashlyk_pathLog

  <a href="#robo39">pid::onExit.unlink</a> <span class="sign">$</span>_bashlyk_pathLog

  case <span class="quote">"${bSysLog}${bUseLog}"</span> in

    00<span class="sign">)</span>
        printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$@"</span>
     <span class="sign">;</span><span class="sign">;</span>

    01<span class="sign">)</span>
        <a href="#robo91">log::stamp</a> <span class="quote">"$HOSTNAME $sTagLog: $*"</span> <span class="sign">&gt;</span><span class="sign">&gt;</span> <span class="sign">$</span>_bashlyk_fnLog
     <span class="sign">;</span><span class="sign">;</span>

    10<span class="sign">)</span>
        printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span>
        logger <span class="sign">-</span>t <span class="quote">"$sTagLog"</span> <span class="quote">"$*"</span>
     <span class="sign">;</span><span class="sign">;</span>

    11<span class="sign">)</span>
        <a href="#robo91">log::stamp</a> <span class="quote">"$HOSTNAME $sTagLog: $*"</span> <span class="sign">&gt;</span><span class="sign">&gt;</span> <span class="sign">$</span>_bashlyk_fnLog
        logger <span class="sign">-</span>t <span class="quote">"$sTagLog"</span> <span class="quote">"$*"</span>
     <span class="sign">;</span><span class="sign">;</span>

  esac

<span class="sign">}</span>
</pre>
<a name="robo88"></a>
<a name="liblog2flog3a3ainit"></a>
<h2>4.6.  liblog/log::init [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::init</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Creating a named pipe for redirecting the output of stdout and stderr to a
     log file with automatic addition of standard stamps.
</pre>
<p class="item_name">ERRORS</p>
<pre>     1                  - The socket is not created, but the output of the
                          stdout and the stderr is redirected to the log file
                          (without stamps)
     NotExistNotCreated - The socket directory does not exist and can not be
                          created
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fnLog=$(mktemp --suffix=.log || tempfile -s .test.log)
    <a href="#robo107">_</a> fnLog $fnLog                                                             #? true
    <strong>log::init</strong>                                                                  #? true
    ls -l $fnLog                                                               #? true
    rm -f $fnLog
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::init</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fnSock IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_sArg <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    fnSock<span class="sign">=</span><span class="quote">"$(<a href="#robo115">std::getMD5</a> ${_bashlyk_s0} ${_bashlyk_sArg}).${$}.socket"</span>
    fnSock<span class="sign">=</span><span class="quote">"${_bashlyk_pathRun}/${fnSock}"</span>

  else

    fnSock<span class="sign">=</span><span class="quote">"${_bashlyk_pathRun}/${_bashlyk_s0}.${$}.socket"</span>

  fi

  mkdir <span class="sign">-</span>p <span class="sign">$</span>_bashlyk_pathRun <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated return<span class="sign">+</span>warn <span class="sign">$</span>_bashlyk_pathRun

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>a <span class="quote">"$fnSock"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rm <span class="sign">-</span>f <span class="sign">$</span>fnSock

  if mkfifo <span class="sign">-</span>m 0600 <span class="sign">$</span>fnSock <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

    <span class="sign">(</span> <a href="#robo85">log::add</a> <span class="sign">-</span> <span class="sign">&lt;</span> <span class="sign">$</span>fnSock <span class="sign">)</span><span class="sign">&amp;</span>
    _bashlyk_pidLogSock<span class="sign">=</span><span class="sign">$</span><span class="sign">!</span>
    exec <span class="sign">&gt;</span><span class="sign">&gt;</span><span class="sign">$</span>fnSock 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

    _bashlyk_fnLogSock<span class="sign">=</span><span class="sign">$</span>fnSock
    <a href="#robo39">pid::onExit.unlink</a> <span class="sign">$</span>fnSock

    return 0

  else

    error NotExistNotCreated warn Socket <span class="sign">$</span>fnSock not created<span class="sign">.</span><span class="sign">.</span>

    exec <span class="sign">&gt;</span><span class="sign">&gt;</span><span class="sign">$</span>_bashlyk_fnLog 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

    _bashlyk_fnLogSock<span class="sign">=</span><span class="sign">$</span>_bashlyk_fnLog

    return 1

  fi

<span class="sign">}</span>
</pre>
<a name="robo89"></a>
<a name="liblog2flog3a3ainteractivity"></a>
<h2>4.7.  liblog/log::interactivity [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::interactivity</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Checking the operating mode of standard input and output devices
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0 - "non-interactive" mode, there is redirection of standard input and/or
         output
    1 - "interactive" mode, redirection of standard input and/or output is not
        detected
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>log::interactivity</strong>                                                         #? true
    <strong>log::interactivity</strong>                                                         #= false
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::interactivity</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>t 1 <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>t 0 <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span>TERM <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="quote">"$TERM"</span> <span class="sign">!</span><span class="sign">=</span> <span class="quote">"dumb"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">\</span>
    <span class="sign">&amp;</span><span class="sign">&amp;</span> _bashlyk_bInteract<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> _bashlyk_bInteract<span class="sign">=</span>0

  return <span class="sign">$</span>_bashlyk_bInteract

<span class="sign">}</span>
</pre>
<a name="robo90"></a>
<a name="liblog2flog3a3anecessity"></a>
<h2>4.8.  liblog/log::necessity [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::necessity</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Check the conditions for using the log file
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0 - save stdout and stderr to log file
    1 - logging do not required
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    _bashlyk_sCond4Log='redirect'
    <strong>log::necessity</strong>                                                             #? true
    <strong>log::necessity</strong>                                                             #= false
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::necessity</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <a href="#robo92">log::terminality</a>
  <a href="#robo89">log::interactivity</a>

  case <span class="sign">$</span><span class="sign">{</span>_bashlyk_sCond4Log<span class="sign">}</span> in

    redirect<span class="sign">)</span>
              _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bInteract <span class="sign">;</span><span class="sign">;</span>
      noterm<span class="sign">)</span>
              _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bTerminal <span class="sign">;</span><span class="sign">;</span>
           <span class="sign">*</span><span class="sign">)</span>
              _bashlyk_bNotUseLog<span class="sign">=</span><span class="sign">$</span>_bashlyk_bInteract <span class="sign">;</span><span class="sign">;</span>
  esac

  return <span class="sign">$</span>_bashlyk_bNotUseLog

<span class="sign">}</span>
</pre>
<a name="robo91"></a>
<a name="liblog2flog3a3astamp"></a>
<h2>4.9.  liblog/log::stamp [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::stamp</strong> &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Show input &lt;text&gt; with time stamp in format 'Mar 28 10:03:40' (LC_ALL=C)
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;text&gt; - suffix to the header
</pre>
<p class="item_name">OUTPUT</p>
<pre>    input &lt;text&gt; with time stamp in format 'Mar 28 10:03:40' (LC_ALL=C)
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local re
    re='^[ADFJMNOS][abceglnoprtuyv]{2} [0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2} AB$'
    <strong>log::stamp</strong> AB | {{ -E "$re" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">if <span class="sign">(</span><span class="sign">(</span> _bashlyk_ShellVersion <span class="sign">&gt;</span> 4002000 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

  <strong>log::stamp</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> LC_ALL<span class="sign">=</span>C printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%(%b %d %H:%M:%S)T %s\n'</span> <span class="squote">'-1'</span> <span class="quote">"$*"</span><span class="sign">;</span> <span class="sign">}</span>

else

  <strong>log::stamp</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> LC_ALL<span class="sign">=</span>C date <span class="quote">"+%b %d %H:%M:%S ${*//%/%%}"</span><span class="sign">;</span> <span class="sign">}</span>

fi
</pre>
<a name="robo92"></a>
<a name="liblog2flog3a3aterminality"></a>
<h2>4.10.  liblog/log::terminality [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo74">liblog</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>log::terminality</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Checking the presence of a control terminal
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0 - terminal not detected
    1 - terminal detected
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>log::terminality</strong>                                                           #? false
    <strong>log::terminality</strong>                                                           #= false
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>log::terminality</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  tty <span class="sign">&gt;</span> <span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> _bashlyk_bTerminal<span class="sign">=</span>1 <span class="sign">|</span><span class="sign">|</span> _bashlyk_bTerminal<span class="sign">=</span>0
  return <span class="sign">$</span>_bashlyk_bTerminal

<span class="sign">}</span>
</pre>
<a name="robo75"></a>
<a name="BASHLYK2flibmsg"></a>
<h1>5.  BASHLYK/libmsg [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    A set of functions for delivering messages from the script using various
    transports:
    - X Window System Notification System
    - e-mail
    - write utility
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo3"></a>
<a name="libmsg2fUsed20libraries"></a>
<h2>5.1.  libmsg/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
</pre>
<a name="robo11"></a>
<a name="libmsg2fGlobal20variables"></a>
<h2>5.2.  libmsg/Global variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>HOSTNAME<span class="sign">:</span><span class="sign">=</span>localhost<span class="sign">}</span>
<span class="sign">#</span><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_envXSession<span class="sign">:</span><span class="sign">=</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sLogin<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c logname 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_emailSubj<span class="sign">:</span><span class="sign">=</span><span class="quote">"${_bashlyk_sUser}@${HOSTNAME}::${0##*/}"</span><span class="sign">}</span>

declare <span class="sign">-</span>rg _bashlyk_externals_msg<span class="sign">=</span><span class="quote">"

    grep logname mail notify-send|kdialog|zenity|xmessage pgrep rm stat sudo
    write

"</span>

declare <span class="sign">-</span>rg _bashlyk_exports_msg<span class="sign">=</span><span class="quote">"

    msg::{echo,getXsessionProperties,mail,notify,notify2x,notifyTool,warn}

"</span>
</pre>
<a name="robo93"></a>
<a name="libmsg2fmsg3a3aecho"></a>
<h2>5.3.  libmsg/msg::echo [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::echo</strong> [-] &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Build a message from arguments and standard input
</pre>
<p class="item_name">INPUTS</p>
<pre>    -      - data is read from standard input
    &lt;text&gt; - is used as a header for a stream from standard input
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>msg::echo</strong> 'test'                                                           | {{{
    test
 }}}
    <strong>msg::echo</strong> - subject &lt;&lt;&lt; body                                               | {{{
    subject
    ----
    body
 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::echo</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    shift
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n----\n'</span> <span class="quote">"$*"</span>

    <a href="#robo110">std::cat</a>

  else

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo94"></a>
<a name="libmsg2fmsg3a3agetXsessionProperties"></a>
<h2>5.4.  libmsg/msg::getXsessionProperties [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::getXsessionProperties</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Get some environment global variables from first local X-Window session
</pre>
<p class="item_name">ERRORS</p>
<pre>    CommandNotFound  - no commands were found to send the message to the active
                       X-Window session
    XsessionNotFound - X-Session not found
    NotPermitted     - not permitted
    ## TODO improve test
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>msg::getXsessionProperties</strong> || echo "X-Session error ($?)"
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::getXsessionProperties</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local a pid s sB sD sX sudo user userX IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>
  local <span class="sign">-</span>A h

  a<span class="sign">=</span><span class="quote">"

      x-session-manager gnome-session gnome-session-flashback lxsession
      mate-session-manager openbox razorqt-session xfce4-session kwin twin
      Xwayland

  "</span>

  user<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span><a href="#robo107">_</a> sUser<span class="sign">)</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$user"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"root"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span>SUDO_USER <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> user<span class="sign">=</span><span class="sign">$</span>SUDO_USER

  for s in <span class="sign">$</span>a<span class="sign">;</span> do h<span class="sign">[</span><span class="sign">$</span>s<span class="sign">]</span><span class="sign">=</span>1<span class="sign">;</span> done

  while read <span class="sign">-</span>t 4<span class="sign">;</span> do

    h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>REPLY<span class="sign">#</span><span class="sign">*</span>Exec<span class="sign">=</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span>1

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> exec <span class="sign">-</span>c grep <span class="squote">'^Exec=.*'</span> <span class="sign">/</span>usr<span class="sign">/</span>share<span class="sign">/</span>xsessions<span class="sign">/</span><span class="sign">*</span><span class="sign">.</span>desktop 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span>

  for s in <span class="sign">$</span>a <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">;</span> do

    for pid in <span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c pgrep <span class="sign">-</span>f <span class="quote">"${s##*/}"</span> <span class="sign">)</span><span class="sign">;</span> do

      userX<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c stat <span class="sign">-</span>c <span class="sign">%</span>U <span class="sign">/</span>proc<span class="sign">/</span><span class="sign">$</span>pid <span class="sign">)</span>
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>userX <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
      <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$user"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"$userX"</span> <span class="sign">|</span><span class="sign">|</span> <span class="quote">"$user"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"root"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue

      <span class="sign">#</span><span class="sign">#</span> TODO many X<span class="sign">-</span>Sessions <span class="sign">?</span>
      sB<span class="sign">=</span><span class="quote">"$(exec -c grep -az DBUS_SESSION_BUS_ADDRESS= /proc/${pid}/environ)"</span>
      sD<span class="sign">=</span><span class="quote">"$(exec -c grep -az DISPLAY= /proc/${pid}/environ)"</span>
      sX<span class="sign">=</span><span class="quote">"$(exec -c grep -az XAUTHORITY= /proc/${pid}/environ)"</span>

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sB <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span>sD <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> break 2

   done

  done 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>userX <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorXsessionNotFound

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>user <span class="sign">=</span><span class="sign">=</span> <span class="sign">$</span>userX <span class="sign">|</span><span class="sign">|</span> <span class="sign">$</span>user <span class="sign">=</span><span class="sign">=</span> root <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorNotPermitted

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sB <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span>sD <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span><a href="#robo107">_</a> sUser<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> root <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sudo<span class="sign">=</span><span class="quote">"sudo -u $userX"</span> <span class="sign">|</span><span class="sign">|</span> sudo<span class="sign">=</span><span class="squote">''</span>

  <a href="#robo107">_</a> sXSessionProp <span class="quote">"$sudo $sD $sX $sB"</span>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo95"></a>
<a name="libmsg2fmsg3a3amail"></a>
<h2>5.5.  libmsg/msg::mail [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::mail</strong> [[-] &lt;arg&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Send &lt;text&gt; as email
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - if this is the name of a non-empty existing file, the data is read
            from it, otherwise the argument string is treated as the message
            text
    -     - data is read from standard input
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    CommandNotFound - 'mail' command not found
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    echo "notification testing" | <strong>msg::mail</strong> - "<a href="#robo71">bashlyk</a>::<strong>msg::mail</strong>"
    [ $? -eq $(<a href="#robo107">_</a> iErrorCommandNotFound) -o $? -eq 0 ] &amp;&amp; true                  #? true
    <strong>msg::mail</strong> -
    [ $? -eq $(<a href="#robo107">_</a> iErrorCommandNotFound) -o $? -eq 0 ] &amp;&amp; true                  #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::mail</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return
  errorify on CommandNotFound mail <span class="sign">|</span><span class="sign">|</span> return

  local sTo<span class="sign">=</span><span class="sign">$</span>_bashlyk_sLogin IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>


  <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>sTo<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span>_bashlyk_sUser<span class="sign">}</span>
  <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>sTo<span class="sign">:</span><span class="sign">=</span>postmaster<span class="sign">}</span>

  <span class="sign">{</span>

    case <span class="quote">"$1"</span> in

      <span class="sign">-</span><span class="sign">)</span>

         shift <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo93">msg::echo</a> <span class="sign">$</span><span class="sign">{</span><span class="sign">*</span><span class="sign">:</span><span class="sign">-</span>empty message<span class="sign">}</span>

       <span class="sign">;</span><span class="sign">;</span>

      <span class="sign">*</span><span class="sign">)</span>

         <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo110">std::cat</a> <span class="sign">&lt;</span> <span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span>

       <span class="sign">;</span><span class="sign">;</span>

    esac

  <span class="sign">}</span> <span class="sign">|</span> mail <span class="sign">-</span>s <span class="quote">"${_bashlyk_emailSubj}"</span> <span class="sign">$</span>_bashlyk_emailOptions <span class="sign">$</span>sTo

  return <span class="sign">$</span><span class="sign">?</span>

<span class="sign">}</span>
</pre>
<a name="robo96"></a>
<a name="libmsg2fmsg3a3anotify"></a>
<h2>5.6.  libmsg/msg::notify [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::notify</strong> [-] &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Send the message to the active user of the local X-Window desktop or the
    process owner using one of the available methods:
    - X-Window desktop notification service
    - e-mail
    - 'write' utility or show to the standard output of the script
</pre>
<p class="item_name">INPUTS</p>
<pre>    -      - data is read from standard input
    &lt;text&gt; - is used as a header for a stream from standard input
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no input data
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local sBody="notification testing" sSubj="<a href="#robo71">bashlyk</a>::<strong>msg::notify</strong>"
    echo "$sBody" | <strong>msg::notify</strong> - "$sSubj"                                     #? true
    [[ $rc -eq 0 ]] &amp;&amp; sleep 1.5
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::notify</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fnTmp

  <a href="#robo125">std::temp</a> fnTmp

  <span class="sign">#</span><span class="sign">#</span> TODO limit input data for safety
  <a href="#robo93">msg::echo</a> <span class="sign">$</span><span class="sign">*</span> <span class="sign">&gt;</span> <span class="sign">$</span>fnTmp

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span>fnTmp <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_MissingArgument

  <a href="#robo97">msg::notify2x</a> <span class="sign">$</span>fnTmp <span class="sign">|</span><span class="sign">|</span> <a href="#robo95">msg::mail</a> <span class="sign">$</span>fnTmp <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_sLogin <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> write <span class="sign">$</span>_bashlyk_sLogin <span class="sign">&lt;</span> <span class="sign">$</span>fnTmp

  <span class="sign">}</span>

  <a href="#robo90">log::necessity</a> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo110">std::cat</a> <span class="sign">&lt;</span> <span class="sign">$</span>fnTmp

  rm <span class="sign">-</span>f <span class="sign">$</span>fnTmp

  return <span class="sign">$</span>i

<span class="sign">}</span>
</pre>
<a name="robo97"></a>
<a name="libmsg2fmsg3a3anotify2x"></a>
<h2>5.7.  libmsg/msg::notify2x [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::notify2x</strong> &lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Sending message through notification services based on X-Window
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - if this is the name of a non-empty existing file, the data is read
            from it, otherwise the argument string is treated as the message
            text
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument  - no input data
    CommandNotFound  - clients  for sending not found
    XsessionNotFound - X-Session not found
    NotPermitted     - not permitted
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local sBody="notification testing" sSubj="<a href="#robo71">bashlyk</a>::<strong>msg::notify2x</strong>" rc
    <strong>msg::notify2x</strong> "${sSubj}\n----\n${sBody}\n"
    rc=$?
    echo $rc                                                                   | {{ "$(<a href="#robo107">_</a> iErrorNotPermitted)\|$(<a href="#robo107">_</a> iErrorXsessionNotFound)\|0" }}
    [[ $rc -eq 0 ]] &amp;&amp; sleep 1.5
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::notify2x</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local iTimeout<span class="sign">=</span>8 s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$*"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"$( <a href="#robo110">std::cat</a> &lt; "</span><span class="sign">$</span><span class="sign">*</span><span class="quote">" )"</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="quote">"$( printf -- "</span><span class="sign">$</span><span class="sign">*</span><span class="quote">" )"</span>

  for cmd in notify<span class="sign">-</span>send kdialog zenity xmessage<span class="sign">;</span> do

    <a href="#robo98">msg::notifyTool</a> <span class="sign">$</span>cmd <span class="quote">"$(<a href="#robo107">_</a> emailSubj)"</span> <span class="quote">"$s"</span> <span class="quote">"$iTimeout"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> break

  done

  return <span class="sign">$</span><span class="sign">?</span>

<span class="sign">}</span>
</pre>
<a name="robo98"></a>
<a name="libmsg2fmsg3a3anotifyTool"></a>
<h2>5.8.  libmsg/msg::notifyTool [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::notifyTool</strong> &lt;command&gt; &lt;title&gt; &lt;text&gt; &lt;timeout&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Sending messages through notification services based on X-Window
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;command&gt; - The notification utility, in this version this is one of:
                notify-send
                kdialog
                zenity
                xmessage
      &lt;title&gt; - Message header
       &lt;text&gt; - Message body
    &lt;timeout&gt; - Message window time
       &lt;user&gt; - recipient of the message
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    CommandNotFound - no commands were found to send the message to the active
                      X-Window session
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local title="<a href="#robo71">bashlyk</a>::<strong>msg::notifyTool</strong>" body="notification testing"
    local rc
    DEBUGLEVEL=$(( DEBUGLEVEL + 1 ))
    <strong>msg::notifyTool</strong> notify-send "$title" "$body" 8
    rc=$?
    echo $?                                                                    | {{ "$(<a href="#robo107">_</a> iErrorCommandNotFound)\|0" }}
    [[ $rc -eq 0 ]] &amp;&amp; sleep 2
    <strong>msg::notifyTool</strong> kdialog     "$title" "$body" 8
    rc=$?
    echo $?                                                                    | {{ "$(<a href="#robo107">_</a> iErrorCommandNotFound)\|0" }}
    [[ $rc -eq 0 ]] &amp;&amp; sleep 2
    <strong>msg::notifyTool</strong> zenity      "$title" "$body" 2
    rc=$?
    echo $?                                                                    | {{ "$(<a href="#robo107">_</a> iErrorCommandNotFound)\|0" }}
    [[ $rc -eq 0 ]] &amp;&amp; sleep 2
    <strong>msg::notifyTool</strong> xmessage    "$title" "$body" 4
    rc=$?
    echo $?                                                                    | {{ "$(<a href="#robo107">_</a> iErrorCommandNotFound)\|0" }}
    DEBUGLEVEL=$(( DEBUGLEVEL - 1 ))
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::notifyTool</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local h t rc X IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>4 <span class="sign">&amp;</span><span class="sign">&amp;</span> t<span class="sign">=</span><span class="sign">$</span>4 <span class="sign">|</span><span class="sign">|</span> t<span class="sign">=</span>8

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> sXSessionProp <span class="sign">)</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> <a href="#robo94">msg::getXsessionProperties</a> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span><span class="sign">?</span>

  X<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> sXSessionProp <span class="sign">)</span>
  <span class="sign">#</span>
  local <span class="sign">-</span>A h<span class="sign">=</span><span class="sign">(</span>
    <span class="sign">[</span>zenity<span class="sign">]</span><span class="sign">=</span><span class="quote">"$X $1 --notification --timeout $(($t/2)) --text '$(printf -- "</span><span class="sign">%</span>s via <span class="sign">%</span>s<span class="sign">\</span>n<span class="sign">\</span>n<span class="sign">%</span>s<span class="sign">\</span>n<span class="quote">" "</span><span class="sign">$</span>2<span class="quote">" "</span><span class="sign">$</span>1<span class="quote">" "</span> <span class="sign">$</span>3<span class="quote">")'"</span>
    <span class="sign">[</span>xmessage<span class="sign">]</span><span class="sign">=</span><span class="quote">"$X $1 -center -timeout $t '$(printf -- "</span><span class="sign">%</span>s via <span class="sign">%</span>s<span class="sign">\</span>n<span class="sign">\</span>n<span class="sign">%</span>s<span class="sign">\</span>n<span class="quote">" "</span><span class="sign">$</span>2<span class="quote">" "</span><span class="sign">$</span>1<span class="quote">" "</span> <span class="sign">$</span>3<span class="quote">")'"</span>
    <span class="sign">[</span>kdialog<span class="sign">]</span><span class="sign">=</span><span class="quote">"$X $1 --title \"$2 via $1\" --passivepopup '$(printf -- "</span><span class="sign">%</span>s<span class="quote">" "</span> <span class="sign">$</span>3<span class="quote">")' $t"</span>
    <span class="sign">[</span>notify<span class="sign">-</span>send<span class="sign">]</span><span class="sign">=</span><span class="quote">"$X $1 -t $t \"$2 via $1\" '$(printf -- "</span><span class="sign">%</span>s<span class="quote">" "</span> <span class="sign">$</span>3<span class="quote">")'"</span>
  <span class="sign">)</span>

  if hash <span class="quote">"$1"</span> 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null<span class="sign">;</span> then

    if <span class="sign">(</span><span class="sign">(</span> DEBUGLEVEL <span class="sign">&gt;</span> 5 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

      <span class="sign">#</span><span class="sign">#</span> save stderr for debugging
      <a href="#robo125">std::temp</a> t keep<span class="sign">=</span>true prefix<span class="sign">=</span><span class="squote">'msg.'</span> suffix<span class="sign">=</span><span class="quote">".notify_command.${1}.err"</span>

      eval <span class="quote">"${h[$1]}"</span> 2<span class="sign">&gt;</span><span class="sign">$</span>t
      rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span>t <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"\n%s status: %s\n"</span> <span class="quote">"$1"</span> <span class="quote">"$rc"</span> <span class="sign">&gt;</span><span class="sign">&gt;</span> <span class="sign">$</span>t <span class="sign">|</span><span class="sign">|</span> rm <span class="sign">-</span>f <span class="sign">$</span>t

    else

      eval <span class="quote">"${h[$1]}"</span>
      rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

    fi

    <span class="sign">#</span><span class="sign">#</span> TODO zenity with <span class="sign">-</span><span class="sign">-</span>timeout option return 5
    <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"zenity"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="quote">"$rc"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"5"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rc<span class="sign">=</span>0

  else

    <a href="#robo35">err::status</a> CommandNotFound <span class="quote">"$1"</span>
    rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>

  fi

  return <span class="sign">$</span>rc

<span class="sign">}</span>
</pre>
<a name="robo99"></a>
<a name="libmsg2fmsg3a3awarn"></a>
<h2>5.9.  libmsg/msg::warn [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo75">libmsg</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>msg::warn</strong> [-] &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Show input message or data from special variable. In the case of
    non-interactive execution  message is sent notification system.
</pre>
<p class="item_name">INPUTS</p>
<pre>    -      - read message from stdin
    &lt;text&gt; - message string. With stdin data ("-" option required) used as
             header. By default ${_bashlyk_sLastError[$BASHPID]}
</pre>
<p class="item_name">OUTPUT</p>
<pre>   show input message or value of ${_bashlyk_sLastError[$BASHPID]}
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    # TODO more fine test required
    _bashlyk_sLastError[$BASHPID]="<strong>msg::warn</strong> testing .."
    local bNotUseLog=$_bashlyk_bNotUseLog
    _bashlyk_bNotUseLog=1
    <strong>msg::warn</strong>                                                                  #? true
    _bashlyk_bNotUseLog=0
    date -R | <strong>msg::warn</strong> - "<a href="#robo71">bashlyk</a>::<strong>msg::warn</strong> testing (non-interactive mode)"  #? true
    _bashlyk_bNotUseLog=1
    date -R | <strong>msg::warn</strong> - "<strong>msg::warn</strong> test int"                                 #? true
    _bashlyk_bNotUseLog=$bNotUseLog
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>msg::warn</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> s<span class="sign">=</span><span class="quote">"${_bashlyk_sLastError[$BASHPID]}"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$_bashlyk_bNotUseLog"</span> <span class="sign">!</span><span class="sign">=</span> <span class="quote">"0"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo93">msg::echo</a> <span class="sign">$</span>s <span class="sign">|</span><span class="sign">|</span> <a href="#robo96">msg::notify</a> <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo76"></a>
<a name="BASHLYK2flibnet"></a>
<h1>6.  BASHLYK/libnet [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    interface to sipcalc command
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo4"></a>
<a name="libnet2fUsed20libraries"></a>
<h2>6.1.  libnet/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
</pre>
<a name="robo12"></a>
<a name="libnet2fGlobal20variables"></a>
<h2>6.2.  libnet/Global variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">declare <span class="sign">-</span>rg _bashlyk_net_externals<span class="sign">=</span><span class="squote">'sipcalc'</span>
declare <span class="sign">-</span>rg _bashlyk_net_reAddress<span class="sign">=</span><span class="squote">'[[:space:]]address[[:space:]]+-[[:space:]]([0-9.]+)$'</span>
declare <span class="sign">-</span>rg _bashlyk_net_reHost<span class="sign">=</span><span class="quote">"^Host${_bashlyk_net_reAddress}"</span>
declare <span class="sign">-</span>rg _bashlyk_net_reNetwork<span class="sign">=</span><span class="quote">"^Network${_bashlyk_net_reAddress}"</span>
declare <span class="sign">-</span>rg _bashlyk_net_reBroadcast<span class="sign">=</span><span class="quote">"^Broadcast${_bashlyk_net_reAddress}"</span>
declare <span class="sign">-</span>rg _bashlyk_net_reMask<span class="sign">=</span><span class="squote">'^Network[[:space:]]mask[[:space:]]+-[[:space:]]([0-9.]+)$'</span>
declare <span class="sign">-</span>rg _bashlyk_net_reWildcard<span class="sign">=</span><span class="squote">'^Cisco[[:space:]]wildcard[[:space:]]+-[[:space:]]([0-9.]+)$'</span>
declare <span class="sign">-</span>rg _bashlyk_net_reMaskBit<span class="sign">=</span><span class="squote">'^Network[[:space:]]mask[[:space:]]\(bits\)[[:space:]]+-[[:space:]]([0-9]+)$'</span>
declare <span class="sign">-</span>rg _bashlyk_net_reRange<span class="sign">=</span><span class="squote">'^Usable[[:space:]]range[[:space:]]+-[[:space:]]([0-9.]+)[[:space:]]-[[:space:]]([0-9.]+)$'</span>
<span class="sign">#</span><span class="sign">#</span><span class="sign">#</span><span class="sign">#</span><span class="sign">#</span><span class="sign">#</span><span class="sign">#</span>
declare <span class="sign">-</span>rg _bashlyk_net_exports<span class="sign">=</span><span class="squote">'net::ipv4.{broadcast,cidr,host,mask,network,range,wildcard}'</span>
</pre>
<a name="robo15"></a>
<a name="libnet2fAliases"></a>
<h2>6.3.  libnet/Aliases [ aliases ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ aliases ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    aliases for deprecated functions
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">alias udfGetValidIPsOnly<span class="sign">=</span><span class="squote">'<a href="#robo102">net::ipv4.host</a>'</span>
alias udfGetValidCIDR<span class="sign">=</span><span class="squote">'<a href="#robo101">net::ipv4.cidr</a>'</span>
</pre>
<a name="robo100"></a>
<a name="libnet2fnet3a3aipv42ebroadcast"></a>
<h2>6.4.  libnet/net::ipv4.broadcast [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.broadcast</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    try get IPv4 broadcast address
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every argument is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of valid IPv4 broadcast addresses
</pre>
<p class="item_name">ERRORS</p>
<pre>    EmptyResult - no result (or arguments)
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.broadcast</strong>                                                        #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.broadcast</strong> 999.8.7.6                                              #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.broadcast</strong> 192.168.116.116/27                                     | {{ '^192\.168\.116\.127$' }}
    <strong>net::ipv4.broadcast</strong> localhost                                              #? true
    <strong>net::ipv4.broadcast</strong> localhost/32                                           | {{ '^127\.0\.0\.1$'       }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.broadcast</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reBroadcast <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo101"></a>
<a name="libnet2fnet3a3aipv42ecidr"></a>
<h2>6.5.  libnet/net::ipv4.cidr [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.cidr</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    resolve arguments as IPv4 CIDR (address/mask) and return valid values list
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every argument is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of valid IPv4 CIDR
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.cidr</strong>                                                             #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.cidr</strong> 999.8.7.6                                                   #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.cidr</strong> 999.8.7.6/23                                                #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.cidr</strong> 1.2.3.4                                                     | {{ '^1\.2\.3\.4/32$' }}
    <strong>net::ipv4.cidr</strong> 1.2.3.4/23                                                  | {{ '^1\.2\.3\.4/23$' }}
    udfGetValidCIDR 1.2.3.4/23                                                 | {{ '^1\.2\.3\.4/23$' }}
    <strong>net::ipv4.cidr</strong> 1.2.3.4/43                                                  #? $_bashlyk_iErrorEmptyResult
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.cidr</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local s
  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    if   <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reHost <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      s<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span>

    elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reMaskBit <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="quote">"${s}/${BASH_REMATCH[1]}"</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>
      unset s

    else

      continue

    fi

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo102"></a>
<a name="libnet2fnet3a3aipv42ehost"></a>
<h2>6.6.  libnet/net::ipv4.host [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.host</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    validate arguments as IPv4 address and return only valid values list
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every argument is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of valid IPv4 host addresses
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.host</strong>                                                             #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.host</strong> 999.8.7.6                                                   #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.host</strong> 192.168.116.116                                             | {{ '^192\.168\.116\.116$' }}
    <strong>net::ipv4.host</strong> localhost                                                   #? true
    <strong>net::ipv4.host</strong> localhost/32                                                | {{ '^127\.0\.0\.1$'       }}
    udfGetValidIPsOnly localhost/32                                            | {{ '^127\.0\.0\.1$'       }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.host</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reHost <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo103"></a>
<a name="libnet2fnet3a3aipv42emask"></a>
<h2>6.7.  libnet/net::ipv4.mask [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.mask</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get network mask for source arguments
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every arguments is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of the network mask
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.mask</strong>                                                             #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.mask</strong> 999.8.7.6                                                   #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.mask</strong> 192.168.116.116/27                                          | {{ '^255\.255\.255\.224$' }}
    <strong>net::ipv4.mask</strong> localhost                                                   #? true
    <strong>net::ipv4.mask</strong> localhost/32                                                | {{ '^255\.255\.255\.255$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.mask</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reMask <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo104"></a>
<a name="libnet2fnet3a3aipv42enetwork"></a>
<h2>6.8.  libnet/net::ipv4.network [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.network</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    try get IPv4 network addresses
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every words is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of valid IPv4 network addresses
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.network</strong>                                                          #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.network</strong> 999.8.7.6                                                #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.network</strong> 192.168.116.116/27                                       | {{ '^192\.168\.116\.96$' }}
    <strong>net::ipv4.network</strong> localhost                                                #? true
    <strong>net::ipv4.network</strong> localhost/32                                             | {{ '^127\.0\.0\.1$'      }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.network</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reNetwork <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo105"></a>
<a name="libnet2fnet3a3aipv42erange"></a>
<h2>6.9.  libnet/net::ipv4.range [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.range</strong> (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    resolve first valid argument (only!) as IPv4 CIDR (address/mask) and return
    list of the usable range of the IPv4 addresses for network of source
    argument
</pre>
<p class="item_name">INPUTS</p>
<pre>    (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - IP, DNS hostnames or CIDR -
                                                (default mask /32)
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of the valid IPv4
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.range</strong>                                                            #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.range</strong> 999.8.7.6                                                  #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.range</strong> 999.8.7.6/33                                               #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.range</strong> 1.2.3.4                                                    #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.range</strong> 192.168.116.116/27                                         | {{ '^192\.168\.116\.97.*\.126$' }}
    <strong>net::ipv4.range</strong> 1.2.3.4/43                                                 #? $_bashlyk_iErrorEmptyResult
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.range</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local IFS i s
  local <span class="sign">-</span>a aA aB
  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    if   <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reRange <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      IFS<span class="sign">=</span><span class="squote">'.'</span>
      aA<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">)</span>
      aB<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>2<span class="sign">]</span><span class="sign">}</span> <span class="sign">)</span>
      IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

      break

    else

     continue

    fi

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  for <span class="sign">(</span><span class="sign">(</span> i <span class="sign">=</span> 0<span class="sign">;</span> i <span class="sign">&lt;</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>aA<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">;</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span>aA<span class="sign">[</span><span class="sign">$</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">=</span><span class="sign">=</span> <span class="sign">$</span><span class="sign">{</span>aB<span class="sign">[</span><span class="sign">$</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      s<span class="sign">+</span><span class="sign">=</span><span class="quote">"${aB[$i]} "</span>

    else

      s<span class="sign">+</span><span class="sign">=</span><span class="quote">"{${aA[$i]}..${aB[$i]}} "</span>

    fi

  done

  s<span class="sign">=</span><span class="quote">"$( <a href="#robo126">std::trim</a> "</span><span class="sign">$</span>s<span class="quote">" )"</span>
  eval <span class="quote">"echo ${s// /.}"</span>

  errorify on EmptyResult <span class="sign">$</span>s

<span class="sign">}</span>
</pre>
<a name="robo106"></a>
<a name="libnet2fnet3a3aipv42ewildcard"></a>
<h2>6.10.  libnet/net::ipv4.wildcard [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo76">libnet</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>net::ipv4.wildcard</strong> &lt;arg&gt; ...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get network Cisco wildcard for source arguments
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; ... - every arguments is a IP, DNS hostnames or CIDR -
                (&lt;IPv4&gt;|&lt;hostname&gt;)[/&lt;network mask bits&gt;] - default mask /32
</pre>
<p class="item_name">OUTPUT</p>
<pre>    separated by white space list of the network wildcard
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>net::ipv4.wildcard</strong>                                                             #? $_bashlyk_iErrorMissingArgument
    <strong>net::ipv4.wildcard</strong> 999.8.7.6                                                   #? $_bashlyk_iErrorEmptyResult
    <strong>net::ipv4.wildcard</strong> 192.168.116.116/27                                          | {{ '^0\.0\.0\.31$' }}
    <strong>net::ipv4.wildcard</strong> localhost                                                   #? true
    <strong>net::ipv4.wildcard</strong> localhost/32                                                | {{ '^0\.0\.0\.0$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>net::ipv4.wildcard</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  local <span class="sign">-</span>A h

  while read <span class="sign">-</span>t 32<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>_bashlyk_net_reWildcard <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> h<span class="sign">[</span><span class="sign">$</span><span class="sign">{</span>BASH_REMATCH<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span><span class="sign">]</span><span class="sign">=</span><span class="squote">'ok'</span>

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span> sipcalc <span class="sign">-</span>d4 <span class="sign">$</span><span class="sign">*</span> <span class="sign">)</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${!h[*]}"</span>

  errorify on EmptyResult <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>h<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span>

<span class="sign">}</span>
</pre>
<a name="robo77"></a>
<a name="BASHLYK2flibpid"></a>
<h1>7.  BASHLYK/libpid [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    A set of functions for process control from shell scripts:
    * create a PID file
    * protection against restarting
    * stop some processes of the specified command
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo78">libstd</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo5"></a>
<a name="libpid2fUsed20libraries"></a>
<h2>7.1.  libpid/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo78">libstd</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo78">libstd</a>.sh"</span>
</pre>
<a name="robo13"></a>
<a name="libpid2fGlobal20Variables"></a>
<h2>7.2.  libpid/Global Variables [ Global variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ Global variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_s0<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>0<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_iPidMax<span class="sign">:</span><span class="sign">=</span>999999<span class="sign">}</span>

declare <span class="sign">-</span>rg _bashlyk_externals_pid<span class="sign">=</span><span class="quote">"

    [ flock head kill mkdir pgrep rm rmdir sleep

"</span>

declare <span class="sign">-</span>rg _bashlyk_exports_pid<span class="sign">=</span><span class="quote">"

    pid::{file,onExit.close,onExit.stop,onExit.unlink,onStarted.exit,status,
          stop,trap}

"</span>
</pre>
<a name="robo36"></a>
<a name="libpid2fpid3a3afile"></a>
<h2>7.3.  libpid/pid::file [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::file</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Protection against re-run the script with the given arguments. PID file is
    created when this script is not already running. If the script has
    arguments, the PID file is created with the name of a MD5-hash this command
    line, or it is derived from the name of the script.
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">ERRORS</p>
<pre>    AlreadyStarted     - process of command line already started
    AlreadyLocked      - PID file locked by flock
    NotExistNotCreated - PID file don't created
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local cmd fmt='#!/bin/bash\n%s . <a href="#robo71">bashlyk</a>\n%s || exit $?\n%s\n'             #-
    <a href="#robo125">std::temp</a> cmd path=$TMPEXEC                                                #? true
    printf -- "$fmt" '_bashlyk_log=nouse' '<strong>pid::file</strong>' 'sleep 8' | tee $cmd
    chmod +x $cmd                                                              #? true
    ($cmd)&amp;                                                                    #? true
    sleep 0.5                                                                  #-
    ( $cmd || false )                                                          #? false
    <strong>pid::file</strong>                                                                  #? true
    test -f $_bashlyk_fnPid                                                    #? true
    head -n 1 $_bashlyk_fnPid                                                  | {{ -w $$ }}
    rm -f $_bashlyk_fnPid
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::file</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local fnPid pid

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>n <span class="quote">"$( <a href="#robo107">_</a> sArg )"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    fnPid<span class="sign">=</span><span class="quote">"$( <a href="#robo107">_</a> pathRun )/$( <a href="#robo115">std::getMD5</a> $( <a href="#robo107">_</a> s0 ) $( <a href="#robo107">_</a> sArg ) ).pid"</span>

  else

    fnPid<span class="sign">=</span><span class="quote">"$( <a href="#robo107">_</a> pathRun )/$( <a href="#robo107">_</a> s0 ).pid"</span>

  fi

  mkdir <span class="sign">-</span>p <span class="quote">"${fnPid%/*}"</span> <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated echo<span class="sign">+</span>return <span class="sign">$</span><span class="sign">{</span>fnPid<span class="sign">%</span><span class="sign">/</span><span class="sign">*</span><span class="sign">}</span>

  fd<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> <a href="#robo114">std::getFreeFD</a> <span class="sign">)</span>

  throw on EmptyVariable fd

  eval <span class="quote">"exec $fd&gt;&gt;${fnPid}"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span>fnPid <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> pid<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c head <span class="sign">-</span>n 1 <span class="sign">$</span>fnPid <span class="sign">)</span>

  if eval <span class="quote">"flock -n $fd"</span><span class="sign">;</span> then

    if <a href="#robo42">pid::status</a> <span class="quote">"$pid"</span> <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> s0 <span class="sign">)</span> <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> sArg <span class="sign">)</span><span class="sign">;</span> then

      error AlreadyStarted echo<span class="sign">+</span>return <span class="sign">$</span>pid

    fi

    if printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"%s\n%s\n"</span> <span class="quote">"$$"</span> <span class="quote">"$0 $( <a href="#robo107">_</a> sArg )"</span> <span class="sign">&gt;</span> <span class="sign">$</span>fnPid<span class="sign">;</span> then

      <a href="#robo107">_</a> fnPid <span class="sign">$</span>fnPid
      <a href="#robo39">pid::onExit.unlink</a> <span class="sign">$</span>fnPid
      <a href="#robo37">pid::onExit.close</a>  <span class="sign">$</span>fd

    else

      error NotExistNotCreated echo<span class="sign">+</span>return <span class="sign">$</span>fnPid

    fi

  else

    if <a href="#robo42">pid::status</a> <span class="quote">"$pid"</span> <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> s0 <span class="sign">)</span> <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> sArg <span class="sign">)</span><span class="sign">;</span> then

      error AlreadyStarted echo<span class="sign">+</span>return <span class="sign">$</span>pid

    else

      error AlreadyLocked echo<span class="sign">+</span>return <span class="sign">$</span>fnPid

    fi

  fi

  return 0

<span class="sign">}</span>
</pre>
<a name="robo37"></a>
<a name="libpid2fpid3a3aonExit2eclose"></a>
<h2>7.4.  libpid/pid::onExit.close [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::onExit.close</strong> &lt;FILEDESCRIPTOR(s)&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    add list of &lt;FILEDESCRIPTOR(s)&gt; for close on exit
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;FILEDESCRIPTOR(s)&gt; - whitespace separated file descriptors list
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::onExit.close</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  _bashlyk_afdClean<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">" $*"</span>

  trap <span class="quote">"<a href="#robo44">pid::trap</a>"</span> EXIT INT TERM

<span class="sign">}</span>
</pre>
<a name="robo38"></a>
<a name="libpid2fpid3a3aonExit2estop"></a>
<h2>7.5.  libpid/pid::onExit.stop [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::onExit.stop</strong> &lt;PID(s)&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Adds &lt;PID(s)&gt; to the cleanup list when the current process is terminated.
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;PID(s)&gt; - whitespace separated PID list
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    sleep 99 &amp;
    <strong>pid::onExit.stop</strong> $!
    test "${_bashlyk_apidClean[$BASHPID]}" -eq "$!"                            #? true
    ps -p $! -o pid=                                                           | {{ -w $! }}
    echo $(<strong>pid::onExit.stop</strong> $!; echo "$BASHPID : $! ")
    ps -p $! -o pid=                                                           | {{ -w $! }}1
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::onExit.stop</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  _bashlyk_apidClean<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">" $*"</span>

  trap <span class="quote">"<a href="#robo44">pid::trap</a>"</span> EXIT INT TERM

<span class="sign">}</span>
</pre>
<a name="robo39"></a>
<a name="libpid2fpid3a3aonExit2eunlink"></a>
<h2>7.6.  libpid/pid::onExit.unlink [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::onExit.unlink</strong> &lt;file(s)&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    add list of filesystem objects for removing on exit
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;file(s)&gt; - whitespace separated files and/or directories list.
                Warning! names with whitespaces must be doublequoted
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a fn1 fn2 fn3 fn4 path1 path2 s=$RANDOM

    <a href="#robo125">std::temp</a> fn1 keep=true suffix=.${s}1
    : $( <strong>pid::onExit.unlink</strong> $fn1 )
    [ -f $fn1 ]                                                                #? false

    : $( <a href="#robo125">std::temp</a> fn2 suffix=.${s}2 keep=true )
    ls -1 ${TMPDIR}/*.${s}2 2&gt;/dev/null                                        | {{ ".*\.${s}2" }}0
    IFS=$'\n' a=( $( ls -1 ${TMPDIR}/*.${s}2 ) )
    : $(<strong>pid::onExit.unlink</strong> "${a[@]}" )
    ls -1 ${TMPDIR}/*.${s}2 2&gt;/dev/null                                        | {{ ".*\.${s}2" }}1

    <a href="#robo125">std::temp</a> path1 keep=true suffix=.${s}3 type=dir
    : $(<strong>pid::onExit.unlink</strong> $path1 )
    ls -1d ${TMPDIR}/*.${s}3 2&gt;/dev/null                                       | {{ ".*\.${s}3" }}1

    : $(<a href="#robo125">std::temp</a> path2 suffix=.${s}4 keep=true type=dir)
    ls -1d ${TMPDIR}/*.${s}4 2&gt;/dev/null                                       | {{ ".*\.${s}4" }}0
    IFS=$'\n' a=( $(ls -1d ${TMPDIR}/*.${s}4) )
    : $(<strong>pid::onExit.unlink</strong> "${a[@]}" )
    ls -1d ${TMPDIR}/*.${s}4 2&gt;/dev/null                                       | {{ ".*\.${s}4" }}1

    : $( <a href="#robo125">std::temp</a> fn3 prefix=fn3_ suffix=".with spaces.tmp" keep=true )
    : $( <a href="#robo125">std::temp</a> fn4 prefix=fn4_ suffix=".with spaces.tmp" keep=true )
    ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null                                  | {{ "aces.tmp$" }}
    IFS=$'\n' a=( $(ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null) )
    : $(<strong>pid::onExit.unlink</strong> "${a[@]}" )
    ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null                                  | {{ "aces.tmp$" }}1
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::onExit.unlink</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  local s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">'\n'</span>

  for s in <span class="quote">"$@"</span><span class="sign">;</span> do _bashlyk_afoClean<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">"${s}${IFS}"</span><span class="sign">;</span> done

  trap <span class="quote">"<a href="#robo44">pid::trap</a>"</span> EXIT INT TERM

<span class="sign">}</span>
</pre>
<a name="robo40"></a>
<a name="libpid2fpid3a3aonExit2eunlink2eempty"></a>
<h2>7.7.  libpid/pid::onExit.unlink.empty [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::onExit.unlink.empty</strong> &lt;file(s)&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    add list of zero size files for removing on exit
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;file(s)&gt; - whitespace separated files and/or directories list
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a fn1 fn2 fn3 fn4 path1 path2 s=$RANDOM

    <a href="#robo125">std::temp</a> fn1 keep=true suffix=.${s}1
    : $( <strong>pid::onExit.unlink.empty</strong> $fn1 )
    [ -f $fn1 ]                                                                #? false

    : $( <a href="#robo125">std::temp</a> fn2 suffix=.${s}2 keep=true )
    ls -1 ${TMPDIR}/*.${s}2 2&gt;/dev/null                                        | {{ ".*\.${s}2" }}0
    IFS=$'\n' a=( $( ls -1 ${TMPDIR}/*.${s}2 ) )
    : $(<strong>pid::onExit.unlink.empty</strong> "${a[@]}" )
    ls -1 ${TMPDIR}/*.${s}2 2&gt;/dev/null                                        | {{ ".*\.${s}2" }}1

    <a href="#robo125">std::temp</a> path1 keep=true suffix=.${s}3 type=dir
    : $(<strong>pid::onExit.unlink.empty</strong> $path1 )
    ls -1d ${TMPDIR}/*.${s}3 2&gt;/dev/null                                       | {{ ".*\.${s}3" }}1

    : $(<a href="#robo125">std::temp</a> path2 suffix=.${s}4 keep=true type=dir)
    ls -1d ${TMPDIR}/*.${s}4 2&gt;/dev/null                                       | {{ ".*\.${s}4" }}0
    IFS=$'\n' a=( $(ls -1d ${TMPDIR}/*.${s}4) )
    : $(<strong>pid::onExit.unlink.empty</strong> "${a[@]}" )
    ls -1d ${TMPDIR}/*.${s}4 2&gt;/dev/null                                       | {{ ".*\.${s}4" }}1

    : $( <a href="#robo125">std::temp</a> fn3 prefix=fn3_ suffix=".with spaces.tmp" keep=true )
    : $( <a href="#robo125">std::temp</a> fn4 prefix=fn4_ suffix=".with spaces.tmp" keep=true )
    ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null                                  | {{ "aces.tmp$" }}0
    IFS=$'\n' a=( $(ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null) )
    : $(<strong>pid::onExit.unlink.empty</strong> "${a[@]}" )
    ls -1 ${TMPDIR}/fn*spaces.tmp 2&gt;/dev/null                                  | {{ "aces.tmp$" }}1
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::onExit.unlink.empty</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  local s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">'\n'</span>

  for s in <span class="quote">"$@"</span><span class="sign">;</span> do _bashlyk_afoEmpty<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">+</span><span class="sign">=</span><span class="quote">"${s}${IFS}"</span><span class="sign">;</span> done

  trap <span class="quote">"<a href="#robo44">pid::trap</a>"</span> EXIT INT TERM

<span class="sign">}</span>
</pre>
<a name="robo41"></a>
<a name="libpid2fpid3a3aonStarted2eexit"></a>
<h2>7.8.  libpid/pid::onStarted.exit [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::onStarted.exit</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Alias-wrapper for <a href="#robo36">pid::file</a> with extended behavior:
    If command line process already exist then
    this current process with identical command line stopped
    else created pid file and current process don`t stopped.
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">ERRORS</p>
<pre>    AlreadyStarted     - PID file exist and command line process already
                         started, current process stopped
    NotExistNotCreated - PID file don't created, current process stopped
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>pid::onStarted.exit</strong>                                                        #? true
    ## TODO check error states
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::onStarted.exit</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <a href="#robo36">pid::file</a> <span class="sign">|</span><span class="sign">|</span> exit

<span class="sign">}</span>
</pre>
<a name="robo42"></a>
<a name="libpid2fpid3a3astatus"></a>
<h2>7.9.  libpid/pid::status [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::status</strong> &lt;PID&gt; &lt;pattern&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Compare the &lt;PID&gt; with a command line &lt;pattern&gt; which must contain the
    process name
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;PID&gt;     - process id
    &lt;pattern&gt; - command line pattern with process name
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    Success         - a process with a &lt;PID&gt; and a name that satisfies the
                      &lt;pattern&gt; exists and it is not the current process.
    NoSuchProcess   - a process with a &lt;PID&gt; and a name that satisfies the
                      &lt;pattern&gt; not found.
    CurrentProcess  - a process with a &lt;PID&gt; and a name that satisfies the
                      &lt;pattern&gt; identical to the PID of the current process.
    InvalidArgument - &lt;PID&gt; is not number
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    (sleep 8)&amp;                                                                 #-
    local pid=$!                                                               #-
    ps -p $pid -o pid= -o args=
    <strong>pid::status</strong>                                                                #? $_bashlyk_iErrorMissingArgument
    <strong>pid::status</strong> $pid sleep 8                                                   #? true
    <strong>pid::status</strong> $pid sleep 88                                                  #? $_bashlyk_iErrorNoSuchProcess
    <strong>pid::status</strong> $$ $0                                                          #? $_bashlyk_iErrorCurrentProcess
    <strong>pid::status</strong> notvalid $0                                                    #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    ## PID value more than PID_MAX
    <strong>pid::status</strong> 9999999 $0                                                     #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::status</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>1 <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>1 <span class="sign">&lt;</span> <span class="sign">$</span>_bashlyk_iPidMax <span class="sign">)</span><span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> error InvalidArgument return <span class="sign">$</span>1

  local re<span class="sign">=</span><span class="quote">"\\b${1}\\b"</span>

  <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">$</span> <span class="sign">=</span><span class="sign">=</span> <span class="sign">$</span>1 <span class="sign">)</span><span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return <span class="sign">$</span>_bashlyk_iErrorCurrentProcess

  shift

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span>pgrep <span class="sign">-</span>d<span class="squote">' '</span> <span class="sign">-</span>f <span class="quote">"$*"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">(</span>pgrep <span class="sign">-</span>d<span class="squote">' '</span> <span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    return 0

  else

    return <span class="sign">$</span>_bashlyk_iErrorNoSuchProcess

  fi
<span class="sign">}</span>
</pre>
<a name="robo43"></a>
<a name="libpid2fpid3a3astop"></a>
<h2>7.10.  libpid/pid::stop [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::stop</strong> [pid=PID[,PID,..]] [childs] &lt;command-line&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Stop the processes associated with the specified command line which must
    contain the process name. Options allow you to manage the list of processes
    to stop. The process of the script itself is excluded
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    pid=PID[,..]   - comma separated list of PID. Only these processes will be
                     stopped if they are associated with the command line
    childs         - stop only child processes
    &lt;command-line&gt; - command line pattern with process name
</pre>
<p class="item_name">ERRORS</p>
<pre>    NoSuchProcess   - processes for the specified command is not detected
    NoChildProcess  - child processes for the specified command line is not
                      detected.
    CurrentProcess  - process for this command line is identical to the PID
                      of the current process, do not stopped
    InvalidArgument - PID is not number
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local a cmd1 cmd2 fmt1 fmt2 i pid                                          #-
    fmt1='#!/bin/bash\nread -t %s &lt;/dev/zero\n'
    fmt2='#!/bin/bash\nfor i in 900 700 600 500; do\n%s %s &amp;\ndone\n'
    <a href="#robo125">std::temp</a> cmd1 path=$TMPEXEC
    <a href="#robo125">std::temp</a> cmd2 path=$TMPEXEC
    printf -- "$fmt1" '$1' | tee $cmd1
    chmod +x $cmd1
    printf -- "$fmt2" "$cmd1" '$i' | tee $cmd2
    chmod +x $cmd2
    for i in 800 700 600 500; do                                               #-
    $cmd1 $i &amp;                                                                 #-
    a+="${!},"                                                                 #-
    done                                                                       #-
    $cmd2
    ($cmd1 400)&amp;                                                               #-
    ## TODO wait for cmd1 starting
    sleep 0.5
    pid=$!
    <strong>pid::stop</strong>                                                                  #? $_bashlyk_iErrorMissingArgument
    <strong>pid::stop</strong> pid=$pid                                                         #? $_bashlyk_iErrorMissingArgument
    <strong>pid::stop</strong> childs                                                           #? $_bashlyk_iErrorMissingArgument
    <strong>pid::stop</strong> pid=$pid $cmd1 88                                                #? $_bashlyk_iErrorNoSuchProcess
    <strong>pid::stop</strong> $cmd1 88                                                         #? $_bashlyk_iErrorNoSuchProcess
    <strong>pid::stop</strong> pid=$$ $0                                                        #? $_bashlyk_iErrorCurrentProcess
    <strong>pid::stop</strong> pid=invalid $0                                                   #? $_bashlyk_iErrorInvalidArgument
    <strong>pid::stop</strong> childs pid=$pid $cmd1 400                                        #? true
    <strong>pid::stop</strong> childs pid=$a $cmd1 800                                          #? true
    <strong>pid::stop</strong> childs pid=$a $cmd1 600                                          #? $_bashlyk_iErrorNotChildProcess
    <strong>pid::stop</strong> $cmd1                                                            #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::stop</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bChild i iStopped pid rc re s
  local <span class="sign">-</span>a a

  for s in <span class="sign">$</span><span class="sign">*</span><span class="sign">;</span> do

    case <span class="quote">"$s"</span> in

      pid<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span>
             i<span class="sign">=</span><span class="quote">"${s#*=}"</span>
             a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>i<span class="sign">/</span><span class="sign">/</span><span class="sign">,</span><span class="sign">/</span> <span class="sign">}</span> <span class="sign">)</span>
             shift
      <span class="sign">;</span><span class="sign">;</span>

      childs<span class="sign">)</span>
             bChild<span class="sign">=</span>1
             shift
      <span class="sign">;</span><span class="sign">;</span>

    esac

  done

  errorify on MissingArgument <span class="sign">$</span><span class="sign">*</span> <span class="sign">|</span><span class="sign">|</span> return

  rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorNoSuchProcess

  errorify on MissingArgument <span class="quote">"${a[*]}"</span> <span class="sign">|</span><span class="sign">|</span> a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">(</span> pgrep <span class="sign">-</span>d<span class="squote">' '</span> <span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span> <span class="sign">)</span> <span class="sign">)</span>
  errorify on MissingArgument <span class="quote">"${a[*]}"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>rc

  iStopped<span class="sign">=</span>0
  for <span class="sign">(</span><span class="sign">(</span> i<span class="sign">=</span>0<span class="sign">;</span> i<span class="sign">&lt;</span><span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>a<span class="sign">[</span><span class="sign">*</span><span class="sign">]</span><span class="sign">}</span><span class="sign">;</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span> <span class="sign">;</span> do

    pid<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>i<span class="sign">]</span><span class="sign">}</span>

    if <span class="sign">!</span> <a href="#robo121">std::isNumber</a> <span class="sign">$</span>pid<span class="sign">;</span> then

      rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorInvalidArgument
      continue

    fi

    if <span class="sign">(</span><span class="sign">(</span> pid <span class="sign">=</span><span class="sign">=</span> <span class="sign">$</span><span class="sign">$</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

      rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorCurrentProcess
      continue

    fi

    re<span class="sign">=</span><span class="quote">"\\b${pid}\\b"</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>bChild <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">!</span> <span class="quote">"$( pgrep -P $$ )"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorNotChildProcess
      continue

    fi

    for s in 15 9<span class="sign">;</span> do

      if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span>pgrep <span class="sign">-</span>d<span class="squote">' '</span> <span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">/</span><span class="sign">}</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">$</span><span class="sign">(</span>pgrep <span class="sign">-</span>d<span class="squote">' '</span> <span class="sign">-</span>f <span class="quote">"$*"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">]</span><span class="sign">]</span>
      then

        if kill <span class="sign">-</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span> <span class="sign">$</span>pid<span class="sign">;</span> then

          a<span class="sign">[</span>i<span class="sign">]</span><span class="sign">=</span><span class="quote">""</span>
          <span class="sign">:</span> <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> iStopped<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span>

        else

          rc<span class="sign">=</span><span class="sign">$</span>_bashlyk_iErrorNotPermitted

        fi

      else

        a<span class="sign">[</span>i<span class="sign">]</span><span class="sign">=</span><span class="quote">""</span>
        break

      fi

    done

  done

  s<span class="sign">=</span><span class="quote">"${a[*]}"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>iStopped <span class="sign">!</span><span class="sign">=</span> 0 <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">-</span>z <span class="quote">"${s// /}"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>rc

  return 0

<span class="sign">}</span>
</pre>
<a name="robo44"></a>
<a name="libpid2fpid3a3atrap"></a>
<h2>7.11.  libpid/pid::trap [ external function ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo77">libpid</a> ] [ external function ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>pid::trap</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    The cleaning procedure at the end of the calling script.
    Suitable for trap command call.
    Produced deletion of files and empty directories; stop child processes,
    closure of open file descriptors listed in the corresponding global
    variables. All processes must be related and descended from the working
    script process. Closes the socket script log if it was used.
</pre>
<p class="item_name">NOTES</p>
<pre>    public
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fd fn1 fn2 fn3 path pid pipe
    <a href="#robo125">std::temp</a> fn1
    <a href="#robo125">std::temp</a> fn2
    <a href="#robo125">std::temp</a> fn3 prefix=fn3 suffix=".with spaces.tmp"
    <a href="#robo125">std::temp</a> path type=dir
    <a href="#robo125">std::temp</a> pipe type=pipe
    fd=$( <a href="#robo114">std::getFreeFD</a> )
    eval "exec ${fd}&gt;$fn2"
    (sleep 1024)&amp;
    pid=$!
    ps -p $pid -o pid=                                                         | {{ -w $pid }}0
    ls /proc/$$/fd                                                             | {{ -w $fd  }}0
    <a href="#robo37">pid::onExit.close</a> $fd
    <a href="#robo38">pid::onExit.stop</a> $pid
    <a href="#robo39">pid::onExit.unlink</a> $fn1 $path $pipe "$fn3"
    <strong>pid::trap</strong>
    ls /proc/$$/fd                                                             | {{ -w $fd }}1
    ps -p $pid -o pid=                                                         | {{ -w $pid}}1
    test -f $fn1                                                               #? false
    test -d $path                                                              #? false
    test -f "$fn3"                                                             #? false
    rm -f "$fn1" "$fn2" "$fn3" "$pipe"
    rmdir --ignore-fail-on-non-empty "$path"
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>pid::trap</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span> re s
  local <span class="sign">-</span>a a

  a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_apidClean<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">}</span> <span class="sign">)</span>

  for <span class="sign">(</span><span class="sign">(</span> i<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span><span class="sign">#</span>a<span class="sign">[</span><span class="sign">@</span><span class="sign">]</span><span class="sign">}</span><span class="sign">-</span>1<span class="sign">;</span> i<span class="sign">&gt;</span><span class="sign">=</span>0 <span class="sign">;</span> i<span class="sign">-</span><span class="sign">-</span> <span class="sign">)</span><span class="sign">)</span> <span class="sign">;</span> do

    re<span class="sign">=</span><span class="quote">"\\b${a[i]}\\b"</span>

    for s in 15 9<span class="sign">;</span> do

      if <span class="sign">[</span><span class="sign">[</span>  <span class="quote">"$( pgrep -d' ' -P $$ )"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">$</span>re <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

        if <span class="sign">!</span> kill <span class="sign">-</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>a<span class="sign">[</span>i<span class="sign">]</span><span class="sign">}</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1<span class="sign">;</span> then

          <a href="#robo35">err::status</a> NotPermitted <span class="quote">"${a[i]}"</span>
          sleep 0<span class="sign">.</span>1

        fi

      fi

    done

  done

  for s in <span class="sign">$</span><span class="sign">{</span>_bashlyk_afdClean<span class="sign">[</span><span class="sign">$</span>BASHPID<span class="sign">]</span><span class="sign">}</span><span class="sign">;</span> do

    <a href="#robo121">std::isNumber</a> <span class="sign">$</span>s <span class="sign">&amp;</span><span class="sign">&amp;</span> eval <span class="quote">"exec ${s}&gt;&amp;-"</span>

  done

  while read <span class="sign">-</span>t 4 s<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span>     <span class="sign">$</span>s  <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rm <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>p <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rm <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>d <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">{</span> rmdir <span class="sign">-</span><span class="sign">-</span>ignore<span class="sign">-</span>fail<span class="sign">-</span>on<span class="sign">-</span>non<span class="sign">-</span>empty <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue<span class="sign">;</span> <span class="sign">}</span>

  done <span class="sign">&lt;</span><span class="sign">&lt;</span><span class="sign">&lt;</span> <span class="quote">"${_bashlyk_afoClean[$BASHPID]}"</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  while read <span class="sign">-</span>t 4 s<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span>     <span class="sign">$</span>s  <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> continue
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">{</span> rm <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue<span class="sign">;</span> <span class="sign">}</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>d <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">{</span> rmdir <span class="sign">-</span><span class="sign">-</span>ignore<span class="sign">-</span>fail<span class="sign">-</span>on<span class="sign">-</span>non<span class="sign">-</span>empty <span class="quote">"$s"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> continue<span class="sign">;</span> <span class="sign">}</span>

  done <span class="sign">&lt;</span><span class="sign">&lt;</span><span class="sign">&lt;</span> <span class="quote">"${_bashlyk_afoEmpty[$BASHPID]}"</span> <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  <span class="sign">#</span><span class="sign">#</span> TODO check <span class="sign">$</span>_bashlyk_pidLogSock
  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>_bashlyk_pidLogSock <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    exec <span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1
    wait <span class="sign">$</span>_bashlyk_pidLogSock

  fi

<span class="sign">}</span>
</pre>
<a name="robo78"></a>
<a name="BASHLYK2flibstd"></a>
<h1>8.  BASHLYK/libstd [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    simple common used functions
</pre>
<p class="item_name">USES</p>
<pre>    <a href="#robo73">liberr</a> <a href="#robo75">libmsg</a>
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo6"></a>
<a name="libstd2fUsed20libraries"></a>
<h2>8.1.  libstd/Used libraries [ External libraries ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ External libraries ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   Loading external libraries
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo73">liberr</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo73">liberr</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo77">libpid</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo77">libpid</a>.sh"</span>
<span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo75">libmsg</a><span class="sign">.</span>sh <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="quote">"${_bashlyk_pathLib}/<a href="#robo75">libmsg</a>.sh"</span>
</pre>
<a name="robo107"></a>
<a name="libstd2f5f"></a>
<h2>8.2.  libstd/_ [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>_</strong> [[&lt;get&gt;]=]&lt;subname&gt; [&lt;value&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Special getter/setter for global variables with names like "$_bashlyk_..."
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;get&gt;     - (local) variable for getting value ${_bashlyk_&lt;subname&gt;}, may
                be supressed if their name equal &lt;subname&gt;
    &lt;subname&gt; - substantial part of the global variable ${_bashlyk_&lt;subname&gt;}
    &lt;value&gt;   - new value for ${_bashlyk_&lt;subname&gt;}. The operation takes
                precedence over the "get" mode
                Important! If a variable is used as a &lt;value&gt;, then it must
                be in double quotes, otherwise in the case of an empty value,
                the meaning of the operation changes from "set" to "get" with
                the output of the value to STDOUT
</pre>
<p class="item_name">OUTPUT</p>
<pre>                Output the variable $_bashlyk_&lt;subname&gt; value in get mode
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - no arguments
    InvalidVariable - invalid variable for "get" mode
    ## TODO updated needed
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local sS sWSpaceAlias pid=$BASHPID k=key1 v=val1
    <strong>_</strong> k=sWSpaceAlias
    echo "$k"                                                                  | {{ "^${_bashlyk_sWSpaceAlias}$" }}
    <strong>_</strong> sS=sWSpaceAlias
    echo "$sS"                                                                 | {{ "^${_bashlyk_sWSpaceAlias}$" }}
    <strong>_</strong> =sWSpaceAlias
    echo "$sWSpaceAlias"                                                       | {{ "^${_bashlyk_sWSpaceAlias}$" }}
    <strong>_</strong> sWSpaceAlias                                                             | {{ "^${_bashlyk_sWSpaceAlias}$" }}
    <strong>_</strong> sWSpaceAlias <strong>_</strong>-<strong>_</strong>
    <strong>_</strong> sWSpaceAlias                                                             | {{ "^<strong>_</strong>-<strong>_</strong>$"                      }}
    <strong>_</strong> sWSpaceAlias ""
    <strong>_</strong> sWSpaceAlias                                                             | {{ "^$"                         }}
    <strong>_</strong> sWSpaceAlias "two words"
    <strong>_</strong> sWSpaceAlias                                                             | {{ "^two words$"                }}
    <strong>_</strong> sWSpaceAlias "$sWSpaceAlias"
    <strong>_</strong> sWSpaceAlias
    <strong>_</strong> sLastError[$pid] "<strong>_</strong> sLastError settings test"                            #? true
    <strong>_</strong> sLastError[$pid]                                                         | {{"^<strong>_</strong> sLastError settings test$"}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>_</strong><span class="sign">(</span><span class="sign">)</span><span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> return

  if <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">#</span> <span class="sign">&gt;</span> 1 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    <span class="sign">#</span><span class="sign">#</span> TODO check for valid required
    eval <span class="quote">"_bashlyk_${1##*=}=\"$2\""</span>

  else

    case <span class="quote">"$1"</span> in

      <span class="sign">*</span><span class="sign">=</span><span class="sign">*</span><span class="sign">)</span>

        if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>n <span class="quote">"${1%=*}"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

          errorify on InvalidVariable <span class="sign">$</span><span class="sign">{</span>1<span class="sign">%</span><span class="sign">=</span><span class="sign">*</span><span class="sign">}</span> <span class="sign">|</span><span class="sign">|</span> return
          eval <span class="quote">"export ${1%=*}=\$$( <a href="#robo109">std::acceptArrayItem</a> "</span>_bashlyk_<span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">=</span><span class="sign">}</span><span class="quote">" )"</span>

        else

          errorify on InvalidVariable <span class="sign">$</span><span class="sign">(</span> <a href="#robo109">std::acceptArrayItem</a> <span class="quote">"${1##*=}"</span> <span class="sign">)</span> <span class="sign">|</span><span class="sign">|</span> return
          eval <span class="quote">"export $( <a href="#robo109">std::acceptArrayItem</a> "</span><span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">=</span><span class="sign">}</span><span class="quote">" )=\$$( <a href="#robo109">std::acceptArrayItem</a> "</span>_bashlyk_<span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">=</span><span class="sign">}</span><span class="quote">" )"</span>

        fi

      <span class="sign">;</span><span class="sign">;</span>

        <span class="sign">*</span><span class="sign">)</span> eval <span class="quote">"echo \$$( <a href="#robo109">std::acceptArrayItem</a> "</span>_bashlyk_<span class="sign">$</span><span class="sign">{</span>1<span class="sign">}</span><span class="quote">" )"</span><span class="sign">;</span><span class="sign">;</span>

    esac

  fi

  return 0

<span class="sign">}</span>
</pre>
<a name="robo108"></a>
<a name="libstd2fGlobal20Variables"></a>
<h2>8.3.  libstd/Global Variables [ Variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables of the library
    * $_bashlyk_sWSpaceAlias - substitution for whitespace
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">#</span><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_envXSession<span class="sign">:</span><span class="sign">=</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>TMPDIR<span class="sign">:</span><span class="sign">=</span><span class="sign">/</span>tmp<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>HOSTNAME<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c hostname 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_sWSpaceAlias<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"\u00a0"</span> <span class="sign">)</span><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_emailSubj<span class="sign">:</span><span class="sign">=</span><span class="quote">"${_bashlyk_sUser}@${HOSTNAME}::${_bashlyk_s0}"</span><span class="sign">}</span>

declare <span class="sign">-</span>rg _bashlyk_iMaxOutputLines<span class="sign">=</span>1000

declare <span class="sign">-</span>rg _bashlyk_aRequiredCmd_std<span class="sign">=</span><span class="quote">"

    [ chgrp chmod chown date echo expr hostname md5sum mkdir mkfifo mktemp pwd
    rm tempfile touch

"</span>

declare <span class="sign">-</span>rg _bashlyk_aExport_std<span class="sign">=</span><span class="quote">"

    <a href="#robo107">_</a> std::{acceptArrayItem,cat,date,dateR,finally,getFreeFD,getMD5,getMD5.list,
    getTimeInSec,inline,isDecimal,isHash,isNumber,isVariable,lazyquote,temp,
    trim,showVariable,whitespace.decode,whitespace.encode,xml}

"</span>
</pre>
<a name="robo109"></a>
<a name="libstd2fstd3a3aacceptArrayItem"></a>
<h2>8.4.  libstd/std::acceptArrayItem [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::acceptArrayItem</strong> &lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    present argument 'Array[item]' as '{Array[item]}'
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - valid name of variable or valid name item of array
</pre>
<p class="item_name">OUTPUT</p>
<pre>    converted input string, if necessary
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - аргумент не задан
    InvalidVariable - не валидный идентификатор
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    _bashlyk_onError=return
    <strong>std::acceptArrayItem</strong>                                                       #? $_bashlyk_iErrorMissingArgument
    <strong>std::acceptArrayItem</strong> 12a                                                   #? $_bashlyk_iErrorInvalidVariable
    <a href="#robo35">err::status</a>
    <strong>std::acceptArrayItem</strong> 12a[te]                                               #? $_bashlyk_iErrorInvalidVariable
    <strong>std::acceptArrayItem</strong> _a                                                    | {{ '^_a$'             }}
    <strong>std::acceptArrayItem</strong> _a[1234]                                              | {{ '^\{_a\[1234\]\}$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::acceptArrayItem</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> return

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z<span class="sign">]</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">*</span><span class="sign">(</span><span class="sign">\</span><span class="sign">[</span><span class="sign">.</span><span class="sign">*</span><span class="sign">\</span><span class="sign">]</span><span class="sign">)</span><span class="sign">?</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> error InvalidVariable return <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>1

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z<span class="sign">]</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">*</span><span class="sign">\</span><span class="sign">[</span><span class="sign">.</span><span class="sign">*</span><span class="sign">\</span><span class="sign">]</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> echo <span class="quote">"{$1}"</span> <span class="sign">|</span><span class="sign">|</span> echo <span class="quote">"$1"</span>

<span class="sign">}</span>
</pre>
<a name="robo110"></a>
<a name="libstd2fstd3a3acat"></a>
<h2>8.5.  libstd/std::cat [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::cat</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show input by line
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show input by line
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s fn
    <a href="#robo125">std::temp</a> -v fn
    for s in $( seq 0 12 ); do printf -- '\t%s\n' "$RANDOM"; done &gt; $fn        #-
    <strong>std::cat</strong> &lt; $fn                                                             | {{ -E '^[[:space:]][0-9]{1,5}$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::cat</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span>

  while IFS<span class="sign">=</span> read <span class="sign">-</span>t 32 <span class="sign">|</span><span class="sign">|</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> do

    printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$REPLY"</span>

  done

<span class="sign">}</span>
</pre>
<a name="robo111"></a>
<a name="libstd2fstd3a3adate"></a>
<h2>8.6.  libstd/std::date [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::date</strong> &lt;string with format controls&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show formatted datetime output
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::date</strong> %s                                                               | {{ -P "^\d+$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">if <span class="sign">(</span><span class="sign">(</span> _bashlyk_ShellVersion <span class="sign">&gt;</span> 4002000 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

  <strong>std::date</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"%($@)T\n"</span> <span class="squote">'-1'</span><span class="sign">;</span> <span class="sign">}</span>

else

  <strong>std::date</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> exec <span class="sign">-</span>c date <span class="sign">+</span><span class="quote">"$@"</span><span class="sign">;</span> <span class="sign">}</span>

fi
</pre>
<a name="robo112"></a>
<a name="libstd2fstd3a3adateR"></a>
<h2>8.7.  libstd/std::dateR [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::dateR</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show 'date -R' like output
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::dateR</strong>                                                                 | {{ -P "^\S{3}, \d{2} \S{3} \d{4} \d{2}:\d{2}:\d{2} .\d{4}$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::dateR</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  LC_ALL<span class="sign">=</span>C <a href="#robo111">std::date</a> <span class="squote">'%a, %d %b %Y %T %z'</span>

<span class="sign">}</span>
</pre>
<a name="robo113"></a>
<a name="libstd2fstd3a3afinally"></a>
<h2>8.8.  libstd/std::finally [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::finally</strong> &lt;text&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show uptime with input text
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;text&gt; - prefix text before " uptime &lt;number&gt; sec"
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::finally</strong> $RANDOM                                                       | {{ "^[[:digit:]]* uptime [[:digit:]]* sec$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::finally</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> echo <span class="quote">"$@ uptime $( <a href="#robo127">std::uptime</a> ) sec"</span><span class="sign">;</span> <span class="sign">}</span>
</pre>
<a name="robo114"></a>
<a name="libstd2fstd3a3agetFreeFD"></a>
<h2>8.9.  libstd/std::getFreeFD [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::getFreeFD</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get unused filedescriptor
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show given filedescriptor
</pre>
<p class="item_name">TODO</p>
<pre>    race possible
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::getFreeFD</strong>                                                             | {{ -P "^\d+$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::getFreeFD</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local i<span class="sign">=</span>0 iMax<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> ulimit <span class="sign">-</span>n <span class="sign">)</span>

  <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>iMax<span class="sign">:</span><span class="sign">=</span>255<span class="sign">}</span>

  for <span class="sign">(</span><span class="sign">(</span> i <span class="sign">=</span> 3<span class="sign">;</span> i <span class="sign">&lt;</span> iMax<span class="sign">;</span> i<span class="sign">+</span><span class="sign">+</span> <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> do

    if <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>e <span class="sign">/</span>proc<span class="sign">/</span><span class="sign">$</span><span class="sign">$</span><span class="sign">/</span>fd<span class="sign">/</span><span class="sign">$</span>i <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      continue

    else

      echo <span class="sign">$</span>i
      break

    fi

  done

<span class="sign">}</span>
</pre>
<a name="robo115"></a>
<a name="libstd2fstd3a3agetMD5"></a>
<h2>8.10.  libstd/std::getMD5 [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::getMD5</strong> [-]|--file &lt;filename&gt;|&lt;args&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>   make MD5 digest for input data
</pre>
<p class="item_name">INPUTS</p>
<pre>    -                 - data expected from standart input
    --file &lt;filename&gt; - data is a file
    &lt;args&gt;            - data is a arguments list
</pre>
<p class="item_name">OUTPUT</p>
<pre>    MD5 digest only
</pre>
<p class="item_name">ERRORS</p>
<pre>    EmptyResult - no digest
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local fn
    <a href="#robo125">std::temp</a> fn
    echo test &gt; $fn                                                            #-
    echo test | <strong>std::getMD5</strong> -                                                  | {{ -w 'd8e8fca2dc0f896fd7cb4cb0031ba249' }}
    <strong>std::getMD5</strong> --file "$fn"                                                   | {{ -w 'd8e8fca2dc0f896fd7cb4cb0031ba249' }}
    <strong>std::getMD5</strong> test                                                           | {{ -w 'd8e8fca2dc0f896fd7cb4cb0031ba249' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::getMD5</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s

  case <span class="quote">"$1"</span> in

         <span class="sign">-</span><span class="sign">)</span>                s<span class="sign">=</span><span class="quote">"$( exec -c md5sum - &lt; &lt;( <a href="#robo110">std::cat</a> ) )"</span><span class="sign">;</span><span class="sign">;</span>
    <span class="sign">-</span><span class="sign">-</span>file<span class="sign">)</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="sign">$</span>2 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"$( exec -c md5sum "</span><span class="sign">$</span>2<span class="quote">" )"</span>           <span class="sign">;</span><span class="sign">;</span>
         <span class="sign">*</span><span class="sign">)</span> <span class="sign">[</span><span class="sign">[</span>    <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"$( exec -c md5sum - &lt;&lt;&lt; "</span><span class="sign">$</span><span class="sign">*</span><span class="quote">" )"</span>     <span class="sign">;</span><span class="sign">;</span>

  esac

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${s%% *}"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorEmptyResult

<span class="sign">}</span>
</pre>
<a name="robo116"></a>
<a name="libstd2fstd3a3agetMD52elist"></a>
<h2>8.11.  libstd/std::getMD5.list [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::getMD5.list</strong> &lt;path&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>   Get recursively MD5 digest of all the non-hidden files in the directory
   &lt;path&gt;
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;path&gt;  - source path
</pre>
<p class="item_name">OUTPUT</p>
<pre>    List of MD5 digest with the names of non-hidden files in the directory
    &lt;path&gt; recursively
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - not arguments
    NoSuchFileOrDir - path not found
    NotPermitted    - not permissible
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local path=$(<a href="#robo125">std::temp</a> type=dir)
    echo "digest test 1" &gt; ${path}/testfile1                                   #-
    echo "digest test 2" &gt; ${path}/testfile2                                   #-
    echo "digest test 3" &gt; ${path}/testfile3                                   #-
    <a href="#robo39">pid::onExit.unlink</a> ${path}/testfile1
    <a href="#robo39">pid::onExit.unlink</a> ${path}/testfile2
    <a href="#robo39">pid::onExit.unlink</a> ${path}/testfile3
    <a href="#robo39">pid::onExit.unlink</a> ${path}
    <strong>std::getMD5.list</strong> $path                                                     | {{ ^[[:xdigit:]]*.*testfile.$ }}
    <strong>std::getMD5.list</strong>                                                           #? ${_bashlyk_iErrorMissingArgument}
    <a href="#robo35">err::status</a>
    <strong>std::getMD5.list</strong> /notexist/path                                            #? ${_bashlyk_iErrorNoSuchFileOrDir}
    <a href="#robo35">err::status</a>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::getMD5.list</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local pathSrc<span class="sign">=</span><span class="quote">"$( exec -c pwd )"</span> pathDst s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  errorify on MissingArgument <span class="sign">$</span><span class="sign">@</span> <span class="sign">|</span><span class="sign">|</span> return
  errorify on NoSuchFileOrDir <span class="quote">"$@"</span> <span class="sign">|</span><span class="sign">|</span> return

  cd <span class="quote">"$@"</span> 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">|</span><span class="sign">|</span> error NotPermitted warn<span class="sign">+</span>return <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span><span class="sign">@</span>

  pathDst<span class="sign">=</span><span class="quote">"$( exec -c pwd )"</span>

  while read s<span class="sign">;</span> do

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>d <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <strong>std::getMD5.list</strong> <span class="sign">$</span>s

    md5sum <span class="quote">"${pathDst}/${s}"</span> 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null

  done<span class="sign">&lt;</span> <span class="sign">&lt;</span><span class="sign">(</span>eval <span class="quote">"ls -1drt * 2&gt;/dev/null"</span><span class="sign">)</span>

  cd <span class="quote">"$pathSrc"</span> <span class="sign">|</span><span class="sign">|</span> error NotPermitted warn<span class="sign">+</span>return <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>pathSrc

  return 0

<span class="sign">}</span>
</pre>
<a name="robo117"></a>
<a name="libstd2fstd3a3agetTimeInSec"></a>
<h2>8.12.  libstd/std::getTimeInSec [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::getTimeInSec</strong> [-v &lt;var&gt;] &lt;number&gt;[sec|min|hour|...]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    get a time value in the seconds from a string in the human-readable format
</pre>
<p class="item_name">OPTIONS</p>
<pre>    -v &lt;var&gt;                    - set the result to valid variable &lt;var&gt;
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;numbers&gt;[sec,min,hour,...] - human-readable string of date&amp;time
</pre>
<p class="item_name">ERRORS</p>
<pre>    InvalidArgument - invalid or missing arguments, number with a time suffix
                      expected
    EmptyResult     - no result
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local v s=${RANDOM:0:2} #-
    <strong>std::getTimeInSec</strong>                                                          #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    <strong>std::getTimeInSec</strong> SeventenFourSec                                          #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    <strong>std::getTimeInSec</strong> 59seconds                                                | {{ -w 59            }}
    <strong>std::getTimeInSec</strong> -v v ${s}minutes                                         #? true
    echo $v                                                                    | {{ -w $(( s * 60 )) }}
    <strong>std::getTimeInSec</strong> -v 123s                                                  #? $_bashlyk_iErrorInvalidVariable
    <a href="#robo35">err::status</a>
    <strong>std::getTimeInSec</strong> -v -v                                                    #? $_bashlyk_iErrorInvalidVariable
    <a href="#robo35">err::status</a>
    <strong>std::getTimeInSec</strong> -v v -v v                                                #? $_bashlyk_iErrorInvalidArgument
    <a href="#robo35">err::status</a>
    <strong>std::getTimeInSec</strong> $RANDOM                                                  #? true
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::getTimeInSec</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-v"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <a href="#robo122">std::isVariable</a> <span class="quote">"$2"</span> <span class="sign">|</span><span class="sign">|</span> error InvalidVariable <span class="sign">$</span>2

    <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$3"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-v"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">\</span>
      <span class="sign">&amp;</span><span class="sign">&amp;</span> error InvalidArgument <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>3 <span class="sign">-</span> number with time suffix expected

    eval <span class="squote">'export $2="$( <strong>std::getTimeInSec</strong> $3 )"'</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>2<span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> eval <span class="squote">'export $2="$( <strong>std::getTimeInSec</strong> $4 )"'</span>
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>2<span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> error EmptyResult <span class="sign">$</span>2

    return <span class="sign">$</span><span class="sign">?</span>

  fi

  local i<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>1<span class="sign">%</span><span class="sign">%</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alpha<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">}</span>

  <a href="#robo121">std::isNumber</a> <span class="sign">$</span>i <span class="sign">|</span><span class="sign">|</span> error InvalidArgument <span class="sign">$</span><span class="sign">{</span>1<span class="sign">%</span><span class="sign">%</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>alpha<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">*</span><span class="sign">}</span>

  case <span class="sign">$</span><span class="sign">{</span>1<span class="sign">#</span><span class="sign">#</span><span class="sign">*</span><span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>digit<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span><span class="sign">}</span> in

    seconds<span class="sign">|</span>second<span class="sign">|</span>sec<span class="sign">|</span>s<span class="sign">|</span><span class="squote">''</span><span class="sign">)</span> echo <span class="sign">$</span>i<span class="sign">;</span><span class="sign">;</span>
       minutes<span class="sign">|</span>minute<span class="sign">|</span>min<span class="sign">|</span>m<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>60 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
            hours<span class="sign">|</span>hour<span class="sign">|</span>hr<span class="sign">|</span>h<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>3600 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
                 days<span class="sign">|</span>day<span class="sign">|</span>d<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>3600<span class="sign">*</span>24 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
               weeks<span class="sign">|</span>week<span class="sign">|</span>w<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>3600<span class="sign">*</span>24<span class="sign">*</span>7 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
           months<span class="sign">|</span>month<span class="sign">|</span>mon<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>3600<span class="sign">*</span>24<span class="sign">*</span>30 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
               years<span class="sign">|</span>year<span class="sign">|</span>y<span class="sign">)</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> i<span class="sign">*</span>3600<span class="sign">*</span>24<span class="sign">*</span>365 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="sign">;</span>
                          <span class="sign">*</span><span class="sign">)</span> echo <span class="quote">""</span>
                             error InvalidArgument <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>1 <span class="sign">-</span> number with time suffix expected
                          <span class="sign">;</span><span class="sign">;</span>

  esac

  return <span class="sign">$</span><span class="sign">?</span>

<span class="sign">}</span>
</pre>
<a name="robo118"></a>
<a name="libstd2fstd3a3ainline"></a>
<h2>8.13.  libstd/std::inline [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    std::1nline [\[&lt;mark linefeed&gt;\]]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show input as single line, mark every linefeed with mark (if this setted)
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show input as single line
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s fn
    <a href="#robo125">std::temp</a> -v fn
    for s in $( seq 0 1 ); do printf -- '%s\n' "$RANDOM"; done &gt; $fn           #-
    <strong>std::inline</strong> lf &lt; $fn                                                       | {{ -E '^[0-9]{1,5} \[lf\] [0-9]{1,5} \[lf\] $' }}
    <strong>std::inline</strong>    &lt; $fn                                                       | {{ -E '^[0-9]{1,5} [0-9]{1,5} $' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::inline</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local tag<span class="sign">=</span><span class="squote">''</span>
  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> tag<span class="sign">=</span><span class="quote">" [$*]"</span>

  while IFS<span class="sign">=</span> read <span class="sign">-</span>t 32 <span class="sign">|</span><span class="sign">|</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>REPLY <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> do

    printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s%s '</span> <span class="quote">"$REPLY"</span> <span class="quote">"$tag"</span>

  done

    printf <span class="sign">-</span><span class="sign">-</span> <span class="quote">"\n"</span>

<span class="sign">}</span>
</pre>
<a name="robo119"></a>
<a name="libstd2fstd3a3aisDecimal"></a>
<h2>8.14.  libstd/std::isDecimal [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::isDecimal</strong> &lt;decimal number&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Checking the argument that it is a decimal number
    The argument is considered a number if it contains decimal digits and can
    have a dot
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;decimal number&gt; - input data
</pre>
<p class="item_name">ERRORS</p>
<pre>    NotDecimal      - argument is not decimal number
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::isDecimal</strong> 12                                                          #? true
    <strong>std::isDecimal</strong> +34.0                                                       #? true
    <strong>std::isDecimal</strong> -67.0                                                       #? true
    <strong>std::isDecimal</strong> .89                                                         #? $_bashlyk_iErrorNotDecimal
    <strong>std::isDecimal</strong> 12.34                                                       #? true
    <strong>std::isDecimal</strong> 12,34                                                       #? $_bashlyk_iErrorNotDecimal
    <strong>std::isDecimal</strong> 12T                                                         #? $_bashlyk_iErrorNotDecimal
    <strong>std::isDecimal</strong> 1O02.0O                                                     #? $_bashlyk_iErrorNotDecimal
    <strong>std::isDecimal</strong>                                                             #? $_bashlyk_iErrorMissingArgument
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::isDecimal</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span><span class="sign">+</span><span class="sign">-</span><span class="sign">]</span><span class="sign">?</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">(</span><span class="sign">\</span><span class="sign">.</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">)</span><span class="sign">?</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return 0

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return <span class="sign">$</span>_bashlyk_iErrorNotDecimal <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

<span class="sign">}</span>
</pre>
<a name="robo120"></a>
<a name="libstd2fstd3a3aisHash"></a>
<h2>8.15.  libstd/std::isHash [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::isHash</strong> &lt;variable&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    treated a variable as global associative array
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;variable&gt; - variable name
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    InvalidVariable - argument is not valid variable name
    InvalidHash     - argument is not hash variable (or declared only - empty)
    Success         - argument is name of the associative array
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    declare -Ag -- hh='()' s5
    declare -ig -- i1
    declare -ag -- aa='()'
    <strong>std::isHash</strong> 5s                                                             #? $_bashlyk_iErrorInvalidVariable
    <a href="#robo35">err::status</a>
    <strong>std::isHash</strong> i1                                                             #? $_bashlyk_iErrorInvalidHash
    <a href="#robo35">err::status</a>
    <strong>std::isHash</strong> aa                                                             #? $_bashlyk_iErrorInvalidHash
    <a href="#robo35">err::status</a>
    <strong>std::isHash</strong> hh                                                             #? true
    <a href="#robo35">err::status</a>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::isHash</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on InvalidVariable <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> return

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">(</span> declare <span class="sign">-</span>p <span class="sign">$</span>1 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">)</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span>declare<span class="sign">.</span><span class="sign">-</span>A<span class="sign">.</span><span class="sign">$</span><span class="sign">{</span>1<span class="sign">}</span><span class="sign">=</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    return 0

  else

    return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorInvalidHash <span class="sign">)</span>

  fi

<span class="sign">}</span>
</pre>
<a name="robo121"></a>
<a name="libstd2fstd3a3aisNumber"></a>
<h2>8.16.  libstd/std::isNumber [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::isNumber</strong> &lt;number&gt; [&lt;tag&gt;]
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Checking the argument that it is a natural number
    The argument is considered a number if it contains decimal digits and can
    have a symbol at the end - a sign of order, for example, k M G T
    (kilo-, Mega-, Giga-, Terra-)
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;number&gt; - input data
    &lt;tag&gt;    - a set of characters, one of which is permissible after the
    digits to indicate a characteristic of a number, for example, of order.
    (The register does not matter)
</pre>
<p class="item_name">ERRORS</p>
<pre>    NotNumber       - argument is not natural number
    MissingArgument - no arguments
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::isNumber</strong> 12                                                           #? true
    <strong>std::isNumber</strong> 34k k                                                        #? true
    <strong>std::isNumber</strong> 67M kMGT                                                     #? true
    <strong>std::isNumber</strong> 89G G                                                        #? true
    <strong>std::isNumber</strong> 12,34                                                        #? $_bashlyk_iErrorNotNumber
    <strong>std::isNumber</strong> 12T                                                          #? $_bashlyk_iErrorNotNumber
    <strong>std::isNumber</strong> 1O2                                                          #? $_bashlyk_iErrorNotNumber
    <strong>std::isNumber</strong>                                                              #? $_bashlyk_iErrorMissingArgument
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::isNumber</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>2 <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> s<span class="sign">=</span><span class="quote">"[$2]?"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">+</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">}</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return 0

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  return <span class="sign">$</span>_bashlyk_iErrorNotNumber

<span class="sign">}</span>
</pre>
<a name="robo122"></a>
<a name="libstd2fstd3a3aisVariable"></a>
<h2>8.17.  libstd/std::isVariable [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::isVariable</strong> &lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Validate &lt;arg&gt; as variable name
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - expected valid variable name (without leader '$')
</pre>
<p class="item_name">RETURN VALUE</p>
<pre>    0               - valid variable name
    MissingArgument - no arguments
    InvalidVariable - is not valid variable name
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::isVariable</strong>                                                            #? $_bashlyk_iErrorMissingArgument
    <strong>std::isVariable</strong> "12w"                                                      #? $_bashlyk_iErrorInvalidVariable
    <strong>std::isVariable</strong> "a"                                                        #? true
    <strong>std::isVariable</strong> "k1"                                                       #? true
    <strong>std::isVariable</strong> "&amp;w1"                                                      #? $_bashlyk_iErrorInvalidVariable
    <strong>std::isVariable</strong> "#k12s"                                                    #? $_bashlyk_iErrorInvalidVariable
    <strong>std::isVariable</strong> ":v1"                                                      #? $_bashlyk_iErrorInvalidVariable
    <strong>std::isVariable</strong> "a1-b"                                                     #? $_bashlyk_iErrorInvalidVariable
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::isVariable</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z<span class="sign">]</span><span class="sign">[</span>_a<span class="sign">-</span>zA<span class="sign">-</span>Z0<span class="sign">-</span>9<span class="sign">]</span><span class="sign">*</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> return 0

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  return <span class="sign">$</span>_bashlyk_iErrorInvalidVariable

<span class="sign">}</span>
</pre>
<a name="robo123"></a>
<a name="libstd2fstd3a3alazyquote"></a>
<h2>8.18.  libstd/std::lazyquote [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::lazyquote</strong> &lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Argument with whitespaces is doublequoted
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - input
</pre>
<p class="item_name">OUTPUT</p>
<pre>    doublequoted input with whitespaces
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::lazyquote</strong>                                                             #? $_bashlyk_iErrorMissingArgument
    <strong>std::lazyquote</strong> "word"                                                      | {{ '^word$'   }}
    <strong>std::lazyquote</strong> two words                                                   | {{ '^\".*\"$' }}
    <strong>std::lazyquote</strong> "two words"                                                 | {{ '^\".*\"$' }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::lazyquote</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$*"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">[</span><span class="sign">[</span><span class="sign">:</span>space<span class="sign">:</span><span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">!</span> <span class="quote">"$*"</span> <span class="sign">=</span><span class="sign">~</span> <span class="sign">^</span><span class="sign">\</span><span class="sign">"</span><span class="sign">.</span><span class="sign">*</span><span class="sign">\</span><span class="sign">"</span><span class="sign">$</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'"%s"\n'</span> <span class="quote">"$*"</span>

  else

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$*"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span>_bashlyk_iErrorMissingArgument

  fi

<span class="sign">}</span>
</pre>
<a name="robo124"></a>
<a name="libstd2fstd3a3ashowVariable"></a>
<h2>8.19.  libstd/std::showVariable [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::showVariable</strong> &lt;var&gt;[,|;| ]...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Listing the values of the arguments if they are variable names. It is
    possible to separate the names of variables by the signs ',' and ';',
    however, it must be remembered that the ';' (Or entire arguments) must be
    quoted.
    If the argument is not a valid variable name, an appropriate message is
    displayed. The function can be used to form the initialization lines for
    variables, while the information lines are escaped by the ':' command when
    parsing by the interpreter; they can also be filtered using the command
    "grep -v '^:'".
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;var&gt; - list of the variables
</pre>
<p class="item_name">OUTPUT</p>
<pre>    Listing the values of the arguments if they are variable names.
    Service lines are output with the initial ':' to automatically suppress the
    execution capability
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s='text' b='true' i=2015 a='true 2015 text'
    <strong>std::showVariable</strong> a,b';' i s 1w                                            | {{{
    : Variable listing&gt;
            a=true 2015 text
            b=true
            i=2015
            s=text
    : Variable name "1w" is not valid!

 }}}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::showVariable</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local bashlyk_std_showVariable_a bashlyk_std_showVariable_s IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">'\t\n ,;'</span>

  for bashlyk_std_showVariable_s in <span class="sign">$</span><span class="sign">*</span><span class="sign">;</span> do

    if <a href="#robo122">std::isVariable</a> <span class="sign">$</span>bashlyk_std_showVariable_s<span class="sign">;</span> then

      bashlyk_std_showVariable_a<span class="sign">+</span><span class="sign">=</span><span class="quote">"\t${bashlyk_std_showVariable_s}=${!bashlyk_std_showVariable_s}\n"</span>

    else

      bashlyk_std_showVariable_a<span class="sign">+</span><span class="sign">=</span><span class="quote">": Variable name \"${bashlyk_std_showVariable_s}\" is not valid!\n"</span>

    fi

  done

  echo <span class="sign">-</span>e <span class="quote">": Variable listing&gt;\n${bashlyk_std_showVariable_a}"</span>

  return 0

<span class="sign">}</span>
</pre>
<a name="robo125"></a>
<a name="libstd2fstd3a3atemp"></a>
<h2>8.20.  libstd/std::temp [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::temp</strong> [ [-v] &lt;valid variable&gt; ] &lt;named options&gt;...
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    make temporary file object - file, pipe or directory
</pre>
<p class="item_name">INPUTS</p>
<pre>    [-v] &lt;variable&gt;    - the output assigned to the &lt;variable&gt; (as bash printf)
                         option -v can be omitted, variable must be correct and
                         this options must be first
    path=&lt;path&gt;        - place the temporary filesystem objects in the &lt;path&gt;
    prefix=&lt;prefix&gt;    - prefix (up to 5 characters for compatibility) for the
                         generated name
    suffix=&lt;suffix&gt;    - suffix for the generated name of temporary object
    mode=&lt;octal&gt;       - the right of access to the temporary facility in octal
    owner=&lt;owner&gt;      - owner of temporary object
    group=&lt;group&gt;      - group of temporary object
    type=file|pipe|dir - object type: file (the default), pipe or directory
    keep=true|false    - temporary object is deleted by default at the end if
                         its name is stored in a variable.
                         true  - do not remove
                         false - delete
</pre>
<p class="item_name">OUTPUT</p>
<pre>    if -v option or valid variable is omitted then name of created temporary
    filesystem object being printed to the standard output
</pre>
<p class="item_name">ERRORS</p>
<pre>    NotExistNotCreated - temporary file system object is not created
    InvalidVariable    - used invalid variable name
    EmptyResult        - name for temporary object missing
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local foTemp s=$RANDOM
    <a href="#robo107">_</a> onError return
    <strong>std::temp</strong> foTemp path=/tmp prefix=pre. suffix=.${s}1                       #? true
    ls -1 /tmp/pre.*.${s}1 2&gt;/dev/null                                         | {{ "/tmp/pre\..*\.${s}1" }}
    rm -f $foTemp
    <strong>std::temp</strong> foTemp path=/tmp type=dir mode=0751 suffix=.${s}2                #? true
    ls -ld $foTemp 2&gt;/dev/null                                                 | {{ "^drwxr-x--x.*${s}2$" }}
    rmdir $foTemp
    foTemp=$(<strong>std::temp</strong> prefix=pre. suffix=.${s}3)
    ls -1 $foTemp 2&gt;/dev/null                                                  | {{ "pre\..*\.${s}3$"     }}
    rm -f $foTemp
    foTemp=$(<strong>std::temp</strong> prefix=pre. suffix=.${s}4 keep=false)                   #? true
    echo $foTemp                                                               | {{ "pre\..*\.${s}4"      }}
    test -f $foTemp                                                            #? false
    rm -f $foTemp
    : $(<strong>std::temp</strong> foTemp path=/tmp prefix=pre. suffix=.${s}5 keep=true)
    ls -1 /tmp/pre.*.${s}5 2&gt;/dev/null                                         | {{ "/tmp/pre\..*\.${s}5" }}
    rm -f /tmp/pre.*.${s}5
    $(<strong>std::temp</strong> foTemp path=/tmp prefix=pre. suffix=.${s}6)
    ls -1 /tmp/pre.*.${s}6 2&gt;/dev/null                                         | {{ "/tmp/pre\..*\.${s}6" }}!
    unset foTemp
    foTemp=$(<strong>std::temp</strong>)                                                        #? true
    ls -1 $foTemp 2&gt;/dev/null                                                  #? true
    test -f $foTemp                                                            #? true
    rm -f $foTemp
    <strong>std::temp</strong> foTemp type=pipe                                                 #? true
    test -p $foTemp                                                            #? true
    rm -f $foTemp
    <strong>std::temp</strong> foTemp prefix="pref." suffix=".suffix with spaces.tmp"
    ls -1 "$foTemp"                                                            | {{ "ix with spaces.tmp$" }}
    rm -f "$foTemp"
    <strong>std::temp</strong> invalid+variable                                                 #? ${_bashlyk_iErrorInvalidVariable}
    <a href="#robo35">err::status</a>                                                                | {{ -P '^invalid variable - invalid\+variable \(\d+\)$' }}
    <strong>std::temp</strong> path=/proc                                                       #? ${_bashlyk_iErrorNotExistNotCreated}
    <a href="#robo35">err::status</a>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::temp</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-v"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> <a href="#robo122">std::isVariable</a> <span class="sign">$</span>1<span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$1"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"-v"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> shift

    <a href="#robo122">std::isVariable</a> <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> error InvalidVariable <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>1

    <span class="sign">#</span>eval <span class="squote">'export $1="$( shift; <strong>std::temp</strong> stdout-mode "${@//keep=false/}" )"'</span>
    eval <span class="squote">'printf -v $1 "%s" "$(shift; <strong>std::temp</strong> stdout-mode "${@//keep=false/}")"'</span>

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>1<span class="sign">}</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> error EmptyResult <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>1

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> keep<span class="sign">=</span>false <span class="sign">|</span><span class="sign">|</span> <span class="sign">!</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> keep<span class="sign">=</span>true <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo39">pid::onExit.unlink</a> <span class="sign">$</span><span class="sign">{</span><span class="sign">!</span>1<span class="sign">}</span>

    return 0

  fi

  local bPipe cmd fnErr IFS octMode optDir path s sGroup sPrefix sSuffix sUser

  cmd<span class="sign">=</span>direct
  fnErr<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>TMPDIR<span class="sign">:</span><span class="sign">-</span><span class="sign">/</span>tmp<span class="sign">}</span><span class="sign">/</span><span class="sign">$</span><span class="sign">{</span>RANDOM<span class="sign">}</span><span class="sign">$</span><span class="sign">{</span>RANDOM<span class="sign">}</span><span class="sign">$</span><span class="sign">{</span>RANDOM<span class="sign">}</span><span class="sign">$</span><span class="sign">{</span>USER<span class="sign">}</span><span class="sign">$</span><span class="sign">{</span><span class="sign">$</span><span class="sign">}</span>
  IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  for s in <span class="quote">"$@"</span><span class="sign">;</span> do

    case <span class="quote">"$s"</span> in

        path<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> path<span class="sign">=</span><span class="quote">"${s#*=}"</span><span class="sign">;</span><span class="sign">;</span>
      prefix<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> sPrefix<span class="sign">=</span><span class="quote">"${s#*=}"</span><span class="sign">;</span><span class="sign">;</span>
      suffix<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> sSuffix<span class="sign">=</span><span class="quote">"${s#*=}"</span><span class="sign">;</span><span class="sign">;</span>
        mode<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> octMode<span class="sign">=</span><span class="quote">"${s#*=}"</span><span class="sign">;</span><span class="sign">;</span>
       type<span class="sign">=</span>d<span class="sign">*</span><span class="sign">)</span> optDir<span class="sign">=</span><span class="squote">'-d'</span><span class="sign">;</span><span class="sign">;</span>
       type<span class="sign">=</span>f<span class="sign">*</span><span class="sign">)</span> optDir<span class="sign">=</span><span class="squote">''</span><span class="sign">;</span><span class="sign">;</span>
       type<span class="sign">=</span>p<span class="sign">*</span><span class="sign">)</span> bPipe<span class="sign">=</span>1<span class="sign">;</span><span class="sign">;</span>
        user<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> sUser<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">#</span><span class="sign">*</span><span class="sign">=</span><span class="sign">}</span><span class="sign">;</span><span class="sign">;</span>
       group<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> sGroup<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>s<span class="sign">#</span><span class="sign">*</span><span class="sign">=</span><span class="sign">}</span><span class="sign">;</span><span class="sign">;</span>
        keep<span class="sign">=</span><span class="sign">*</span><span class="sign">)</span> continue<span class="sign">;</span><span class="sign">;</span>
      stdout<span class="sign">-</span><span class="sign">*</span><span class="sign">)</span> continue<span class="sign">;</span><span class="sign">;</span>
             <span class="sign">*</span><span class="sign">)</span>

                if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">=</span><span class="sign">=</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

                  <a href="#robo122">std::isVariable</a> <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> error InvalidVariable <span class="sign">$</span>1

                fi

                if <a href="#robo121">std::isNumber</a> <span class="quote">"$2"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>3 <span class="sign">]</span><span class="sign">]</span> <span class="sign">;</span> then

                  <span class="sign">#</span> compatibility with ancient version
                  octMode<span class="sign">=</span><span class="quote">"$2"</span>
                  sPrefix<span class="sign">=</span><span class="quote">"$1"</span>

                fi
             <span class="sign">;</span><span class="sign">;</span>
    esac

  done

  sPrefix<span class="sign">=</span><span class="quote">"${sPrefix//\//}"</span>
  sSuffix<span class="sign">=</span><span class="quote">"${sSuffix//\//}"</span>

  if   hash mktemp   2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null<span class="sign">;</span> then

    cmd<span class="sign">=</span>mktemp

  elif hash tempfile 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null<span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>optDir <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> cmd<span class="sign">=</span>direct <span class="sign">|</span><span class="sign">|</span> cmd<span class="sign">=</span>tempfile

  fi

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">!</span> <span class="sign">$</span>path <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>bPipe <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> path<span class="sign">=</span><span class="quote">"$( <a href="#robo107">_</a> pathRun )"</span> <span class="sign">|</span><span class="sign">|</span> path<span class="sign">=</span><span class="quote">"$TMPDIR"</span>

  fi

  mkdir <span class="sign">-</span>p <span class="quote">"$path"</span> <span class="sign">|</span><span class="sign">|</span> error NotExistNotCreated <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>path

  <a href="#robo39">pid::onExit.unlink</a> <span class="sign">$</span>fnErr

  case <span class="quote">"$cmd"</span> in

    direct<span class="sign">)</span>

      s<span class="sign">=</span><span class="quote">"${path}/${sPrefix:0:5}${RANDOM}${sSuffix}"</span>

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>optDir <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> mkdir <span class="sign">-</span>p <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> touch <span class="quote">"$s"</span>

    <span class="sign">;</span><span class="sign">;</span>

    mktemp<span class="sign">)</span>

      s<span class="sign">=</span><span class="quote">"$( LC_ALL=C mktemp --tmpdir="</span><span class="sign">$</span>path<span class="quote">" $optDir --suffix="</span><span class="sign">$</span>sSuffix<span class="quote">" "</span><span class="sign">$</span><span class="sign">{</span>sPrefix<span class="sign">:</span>0<span class="sign">:</span>5<span class="sign">}</span>XXXXXXXX<span class="quote">" )"</span>

    <span class="sign">;</span><span class="sign">;</span>

    tempfile<span class="sign">)</span>

      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sPrefix <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sPrefix<span class="sign">=</span><span class="quote">"-p ${sPrefix:0:5}"</span>
      <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sSuffix <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> sSuffix<span class="sign">=</span><span class="quote">"-s $sSuffix"</span>

      s<span class="sign">=</span><span class="quote">"$( LC_ALL=C tempfile -d "</span><span class="sign">$</span>path<span class="quote">" "</span><span class="sign">$</span>sPrefix<span class="quote">" "</span><span class="sign">$</span>sSuffix<span class="quote">" )"</span>

    <span class="sign">;</span><span class="sign">;</span>

  esac <span class="sign">&gt;</span><span class="sign">$</span>fnErr 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>bPipe <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    rm <span class="sign">-</span>f  <span class="quote">"$s"</span>
    mkfifo <span class="quote">"$s"</span>
    <span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>octMode<span class="sign">:</span><span class="sign">=</span>0600<span class="sign">}</span>

  fi <span class="sign">&gt;</span><span class="sign">&gt;</span><span class="sign">$</span>fnErr 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>octMode <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> chmod <span class="sign">$</span>octMode <span class="sign">$</span>s

  <span class="sign">#</span><span class="sign">#</span> TODO error handling
  if <span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span>UID <span class="sign">=</span><span class="sign">=</span> 0 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sUser  <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> chown <span class="sign">$</span>sUser  <span class="sign">$</span>s
    <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>sGroup <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> chgrp <span class="sign">$</span>sGroup <span class="sign">$</span>s

  fi <span class="sign">&gt;</span><span class="sign">&gt;</span><span class="sign">$</span>fnErr 2<span class="sign">&gt;</span><span class="sign">&amp;</span>1

  if <span class="sign">!</span> <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>f <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">-</span>p <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> <span class="sign">-</span>d <span class="quote">"$s"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    error NotExistNotCreated <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>s <span class="sign">$</span><span class="sign">(</span><span class="sign">&lt;</span> <span class="sign">$</span>fnErr<span class="sign">)</span>

  fi

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">*</span> <span class="sign">=</span><span class="sign">~</span> keep<span class="sign">=</span>false <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <a href="#robo39">pid::onExit.unlink</a> <span class="quote">"$s"</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>s <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$s"</span> <span class="sign">|</span><span class="sign">|</span> return <span class="sign">$</span><span class="sign">(</span> <a href="#robo107">_</a> iErrorEmptyResult <span class="sign">)</span>

<span class="sign">}</span>
</pre>
<a name="robo126"></a>
<a name="libstd2fstd3a3atrim"></a>
<h2>8.21.  libstd/std::trim [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::trim</strong> &lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    remove leading and trailing spaces
</pre>
<p class="item_name">ARGUMENTS</p>
<pre>    &lt;arg&gt; - input data
</pre>
<p class="item_name">OUTPUT</p>
<pre>    show input without leading and trailing spaces
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local s=" a  b c  "
    <strong>std::trim</strong> "$s"                                                             | {{ "^a  b c$" }}
    <strong>std::trim</strong>  $s                                                              | {{ "^a b c$"  }}
    <strong>std::trim</strong>                                                                  | {{ ^$         }}
    <strong>std::trim</strong> '+'                                                              | {{ ^\+$       }}
    <strong>std::trim</strong> '  '                                                             | {{ ^$         }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::trim</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"$( expr "</span><span class="sign">$</span><span class="sign">*</span> <span class="quote">" : "</span><span class="sign">^</span><span class="sign">\</span> <span class="sign">*</span><span class="sign">\</span><span class="sign">(</span><span class="sign">.</span><span class="sign">*</span><span class="sign">[</span><span class="sign">^</span> <span class="sign">]</span><span class="sign">\</span><span class="sign">)</span><span class="sign">\</span> <span class="sign">*</span><span class="sign">$</span><span class="quote">" )"</span>

<span class="sign">}</span>
</pre>
<a name="robo127"></a>
<a name="libstd2fstd3a3auptime"></a>
<h2>8.22.  libstd/std::uptime [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::uptime</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    show uptime value in the seconds
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    <strong>std::uptime</strong>                                                                | {{ "^[[:digit:]]*$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source">if <span class="sign">(</span><span class="sign">(</span> _bashlyk_ShellVersion <span class="sign">&gt;</span> 4002000 <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> then

  <strong>std::uptime</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

    echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span> <span class="sign">$</span><span class="sign">(</span>printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%(%s)T'</span> <span class="squote">'-1'</span><span class="sign">)</span> <span class="sign">-</span> <span class="sign">$</span><span class="sign">(</span>printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%(%s)T'</span> <span class="squote">'-2'</span><span class="sign">)</span> <span class="sign">)</span><span class="sign">)</span>

  <span class="sign">}</span>

else

  readonly _bashlyk_iStartTimeStamp<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> exec <span class="sign">-</span>c date <span class="quote">"+%s"</span> <span class="sign">)</span>

  <strong>std::uptime</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span> echo <span class="sign">$</span><span class="sign">(</span><span class="sign">(</span><span class="sign">$</span><span class="sign">(</span>exec <span class="sign">-</span>c date <span class="quote">"+%s"</span><span class="sign">)</span> <span class="sign">-</span> _bashlyk_iStartTimeStamp <span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> <span class="sign">}</span>

fi
</pre>
<a name="robo128"></a>
<a name="libstd2fstd3a3awhitespace2edecode"></a>
<h2>8.23.  libstd/std::whitespace.decode [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::whitespace.decode</strong> -|&lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    If the input contains a sequence of characters defined in the global
    variable $_bashlyk_WSpase2Alias, then they are replaced by a whitespace.
    If, as a result of processing data from arguments (not from the standard
    input), replacements are made for whitespace, then the output is quoted.
</pre>
<p class="item_name">INPUTS</p>
<pre>    arg - argument
</pre>
<p class="item_name">OUTPUT</p>
<pre>    input data with "restored" whitespaces
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local text s
    s="${_bashlyk_sWSpaceAlias}"
    text="many${s}arguments${s}expected${s}..."
    <strong>std::whitespace.decode</strong> $text                                               | {{ '"' }}
    <strong>std::whitespace.decode</strong> - &lt;&lt;&lt; $text                                         | {{ '"' }}1
    a=( $( <strong>std::whitespace.decode</strong> $text ) )
    echo ${#a[@]}                                                              | {{ ^4$ }}
    a=( $( <strong>std::whitespace.decode</strong> - &lt;&lt;&lt; $text ) )
    echo ${#a[@]}                                                              | {{ ^4$ }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::whitespace.decode</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s<span class="sign">=</span><span class="sign">$</span><span class="sign">*</span>

  case <span class="quote">"$s"</span> in

    <span class="sign">-</span><span class="sign">)</span>
       <span class="sign">#</span><span class="sign">#</span> TODO <span class="sign">-</span> on<span class="sign">/</span>off timeout
       while read s<span class="sign">;</span> do

         printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${s//${_bashlyk_sWSpaceAlias}/ }"</span>

       done
    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
       <a href="#robo123">std::lazyquote</a> <span class="quote">"${s//${_bashlyk_sWSpaceAlias}/ }"</span>
    <span class="sign">;</span><span class="sign">;</span>

  esac
<span class="sign">}</span>
</pre>
<a name="robo129"></a>
<a name="libstd2fstd3a3awhitespace2eencode"></a>
<h2>8.24.  libstd/std::whitespace.encode [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::whitespace.encode</strong> -|&lt;arg&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    The whitespace in the argument is replaced by the "magic" sequence of
    characters defined in the global variable $_bashlyk_sWSpaceAlias
</pre>
<p class="item_name">INPUTS</p>
<pre>    &lt;arg&gt; - input data for conversion
        - - expected data from the standard input
</pre>
<p class="item_name">OUTPUT</p>
<pre>   input data with replaced (masked) whitespaces by a special sequence of
   characters
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    a=($(<strong>std::whitespace.encode</strong> single argument expected ... ))
    echo ${#a[@]}                                                              | {{ ^1$ }}
    a=($(echo single argument expected ... | <strong>std::whitespace.encode</strong> -))
    echo ${#a[@]}                                                              | {{ ^1$ }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::whitespace.encode</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local s<span class="sign">=</span><span class="sign">$</span><span class="sign">*</span>

  case <span class="sign">$</span><span class="sign">*</span> in

    <span class="sign">-</span><span class="sign">)</span>
       <span class="sign">#</span><span class="sign">#</span> TODO <span class="sign">-</span> on<span class="sign">/</span>off timeout
       while read s<span class="sign">;</span> do

         printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${s// /$_bashlyk_sWSpaceAlias}"</span>

       done
    <span class="sign">;</span><span class="sign">;</span>

    <span class="sign">*</span><span class="sign">)</span>
       printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"${s// /$_bashlyk_sWSpaceAlias}"</span>
    <span class="sign">;</span><span class="sign">;</span>

  esac

<span class="sign">}</span>
</pre>
<a name="robo130"></a>
<a name="libstd2fstd3a3axml"></a>
<h2>8.25.  libstd/std::xml [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo78">libstd</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>std::xml</strong> tag [property] data
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>    Generate XML code to stdout
</pre>
<p class="item_name">INPUTS</p>
<pre>    tag      - XML tag name (without &lt;&gt;)
    property - XML tag property
    data     - XML tag content
</pre>
<p class="item_name">OUTPUT</p>
<pre>    Show compiled XML code
</pre>
<p class="item_name">ERRORS</p>
<pre>    MissingArgument - аргумент не задан
</pre>
<p class="item_name">EXAMPLE</p>
<pre>    local sTag='date TO="+0400" TZ="MSK"' sContent='Mon, 22 Apr 2013 15:55:50'
    local sXml='&lt;date TO="+0400" TZ="MSK"&gt;Mon, 22 Apr 2013 15:55:50&lt;/date&gt;'
    <strong>std::xml</strong> "$sTag" "$sContent"                                               | {{ "^${sXml}$" }}
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>std::xml</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  errorify on MissingArgument <span class="sign">$</span>1 <span class="sign">|</span><span class="sign">|</span> return

  local IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>
  local <span class="sign">-</span>a a<span class="sign">=</span><span class="sign">(</span> <span class="sign">$</span>1 <span class="sign">)</span>

  shift

  printf <span class="sign">-</span><span class="sign">-</span> <span class="squote">'%s\n'</span> <span class="quote">"&lt;${a[*]}&gt;${*}&lt;/${a[0]}&gt;"</span>

<span class="sign">}</span>
</pre>
<a name="robo79"></a>
<a name="BASHLYK2ftestunit"></a>
<h1>9.  BASHLYK/testunit [ Modules ]  </h1>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ Modules ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    script compiler to run a library test
</pre>
<p class="item_name">USES</p>
<pre>    <strong>testunit</strong>.awk
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Damir Sh. Yakupov &lt;yds@bk.ru&gt;
</pre>
<a name="robo131"></a>
<a name="testunit2fGlobal20Variables"></a>
<h2>9.1.  testunit/Global Variables [ Variables ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo79">testunit</a> ] [ Variables ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>    Global variables
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">:</span><span class="sign">=</span><span class="sign">/</span>usr<span class="sign">/</span>share<span class="sign">/</span><a href="#robo71">bashlyk</a><span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLog<span class="sign">:</span><span class="sign">=</span><span class="sign">/</span>tmp<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_TestUnit_iCount<span class="sign">:</span><span class="sign">=</span>0<span class="sign">}</span>
<span class="sign">:</span> <span class="sign">$</span><span class="sign">{</span>_bashlyk_TestUnit_fnTmp<span class="sign">:</span><span class="sign">=</span><span class="sign">$</span><span class="sign">(</span> mktemp 2<span class="sign">&gt;</span><span class="sign">/</span>dev<span class="sign">/</span>null <span class="sign">|</span><span class="sign">|</span> tempfile <span class="sign">|</span><span class="sign">|</span> echo <span class="quote">"/tmp/${RANDOM}${RANDOM}"</span> <span class="sign">)</span><span class="sign">}</span>
</pre>
<a name="robo132"></a>
<a name="testunit2ftestunit3a3aerror"></a>
<h2>9.2.  testunit/testunit::error [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo79">testunit</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>   <strong>testunit::error</strong> &lt;error message&gt;
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>   output error message and exit
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>testunit::error</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local rc<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span>
  echo <span class="quote">"$*"</span>
  exit <span class="sign">$</span>rc

<span class="sign">}</span>
</pre>
<a name="robo133"></a>
<a name="testunit2ftestunit3a3amain"></a>
<h2>9.3.  testunit/testunit::main [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo79">testunit</a> ] [ Functions ]</p>
<p class="item_name">DESCRIPTION</p>
<pre>   main function libraries test unit
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>testunit::main</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span>1 <span class="sign">]</span><span class="sign">]</span> <span class="sign">|</span><span class="sign">|</span> return 254

  if   <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>w <span class="sign">/</span>dev<span class="sign">/</span>shm <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    TMPDIR<span class="sign">=</span><span class="sign">/</span>dev<span class="sign">/</span>shm

  elif <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>w <span class="sign">/</span>run<span class="sign">/</span>shm <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    TMPDIR<span class="sign">=</span><span class="sign">/</span>run<span class="sign">/</span>shm

  else

    TMPDIR<span class="sign">=</span><span class="sign">/</span>tmp

  fi
  export TMPDIR

  local a s fn fnErr<span class="sign">=</span><span class="quote">"${_bashlyk_TestUnit_fnTmp}.${1}.err"</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>
  local testunitEmbedA testunitEmbedB

  testunitEmbedA<span class="sign">=</span><span class="quote">"${TMPDIR}/<a href="#robo79">testunit</a>.embedded.a.${RANDOM}${RANDOM}"</span>
  testunitEmbedB<span class="sign">=</span><span class="quote">"${TMPDIR}/<a href="#robo79">testunit</a>.embedded.b.${RANDOM}${RANDOM}"</span>

  fn<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span>lib<span class="sign">$</span><span class="sign">{</span>1<span class="sign">}</span><span class="sign">.</span>sh

  <span class="sign">[</span><span class="sign">[</span> <span class="sign">-</span>s <span class="quote">"$fn"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="sign">.</span> <span class="sign">$</span>fn <span class="sign">|</span><span class="sign">|</span> return 254

  mkdir <span class="sign">-</span>p <span class="sign">$</span>_bashlyk_pathLog <span class="sign">|</span><span class="sign">|</span> <a href="#robo132">testunit::error</a> <span class="quote">"path $_bashlyk_pathLog not exist..."</span>

  _bashlyk_TestUnit_fnLog<span class="sign">=</span><span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLog<span class="sign">}</span><span class="sign">/</span><span class="sign">$</span><span class="sign">{</span>1<span class="sign">}</span><span class="sign">.</span><a href="#robo79">testunit</a><span class="sign">.</span>log

  mawk <span class="sign">-</span>f <span class="sign">$</span><span class="sign">{</span>_bashlyk_pathLib<span class="sign">}</span><span class="sign">/</span><a href="#robo79">testunit</a><span class="sign">.</span>awk <span class="sign">-</span><span class="sign">-</span> <span class="sign">$</span>fn <span class="sign">&gt;</span> <span class="sign">$</span>_bashlyk_TestUnit_fnTmp

  echo <span class="quote">"<a href="#robo79">testunit</a> for $fn library"</span> <span class="sign">&gt;</span> <span class="sign">$</span>_bashlyk_TestUnit_fnLog
  echo <span class="sign">-</span>n <span class="quote">"${fn}: "</span>

  <span class="sign">.</span> <span class="sign">$</span>_bashlyk_TestUnit_fnTmp 2<span class="sign">&gt;</span><span class="sign">$</span>fnErr

  if <span class="sign">[</span><span class="sign">[</span> <span class="sign">$</span><span class="sign">?</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"0"</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="quote">"$_bashlyk_TestUnit_iCount"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"0"</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

    echo <span class="quote">" ok."</span>
    rm <span class="sign">-</span>f <span class="sign">$</span>_bashlyk_TestUnit_fnTmp <span class="sign">$</span>fnErr

  else

    echo <span class="quote">" fail.."</span>
    echo <span class="quote">"found $_bashlyk_TestUnit_iCount errors. See \"[?]: status\" lines from $_bashlyk_TestUnit_fnLog"</span>

  fi

  rm <span class="sign">-</span>f <span class="sign">$</span>testunitEmbedA <span class="sign">$</span>testunitEmbedB
<span class="sign">}</span>
</pre>
<a name="robo134"></a>
<a name="testunit2ftestunit3a3amsg"></a>
<h2>9.4.  testunit/testunit::msg [ Functions ]  </h2>
<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo79">testunit</a> ] [ Functions ]</p>
<p class="item_name">SYNOPSIS</p>
<pre>    <strong>testunit::msg</strong>
</pre>
<p class="item_name">DESCRIPTION</p>
<pre>   <a href="#robo71">bashlyk</a> library test unit stdout
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><strong>testunit::msg</strong><span class="sign">(</span><span class="sign">)</span> <span class="sign">{</span>

  local rc0<span class="sign">=</span><span class="sign">$</span><span class="sign">?</span> rc1 rc2<span class="sign">=</span><span class="squote">''</span> IFS<span class="sign">=</span><span class="sign">$</span><span class="squote">' \t\n'</span>

  case <span class="quote">"$1"</span> in

     true<span class="sign">)</span> rc1<span class="sign">=</span>0<span class="sign">;</span><span class="sign">;</span>
    false<span class="sign">)</span> rc1<span class="sign">=</span>1<span class="sign">;</span><span class="sign">;</span>
        <span class="sign">*</span><span class="sign">)</span> rc1<span class="sign">=</span><span class="sign">$</span>1<span class="sign">;</span><span class="sign">;</span>
       <span class="squote">''</span><span class="sign">)</span> return 255<span class="sign">;</span><span class="sign">;</span>

  esac

  <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$rc0"</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"$rc1"</span> <span class="sign">]</span><span class="sign">]</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> rc2<span class="sign">=</span><span class="squote">'.'</span> <span class="sign">|</span><span class="sign">|</span> rc2<span class="sign">=</span><span class="squote">'?'</span>

  echo <span class="sign">-</span>n <span class="quote">"$rc2"</span>

  <span class="sign">{</span>

    if <span class="sign">[</span><span class="sign">[</span> <span class="quote">"$rc2"</span> <span class="sign">=</span><span class="sign">=</span> <span class="squote">'?'</span> <span class="sign">]</span><span class="sign">]</span><span class="sign">;</span> then

      _bashlyk_TestUnit_iCount<span class="sign">=</span><span class="sign">$</span><span class="sign">(</span><span class="sign">(</span>_bashlyk_TestUnit_iCount<span class="sign">+</span>1<span class="sign">)</span><span class="sign">)</span>
      echo <span class="quote">"--[?]: status $rc0 ( must have $rc1 )"</span>
      echo <span class="quote">"--[?]: file: ${BASH_SOURCE[1]} function: ${FUNCNAME[1]}"</span>
      echo <span class="sign">-</span>n <span class="quote">"--[?]: line: ${BASH_LINENO[0]}: "</span>
      head <span class="sign">-</span>n <span class="sign">$</span><span class="sign">{</span>BASH_LINENO<span class="sign">[</span>0<span class="sign">]</span><span class="sign">}</span> <span class="sign">$</span><span class="sign">{</span>BASH_SOURCE<span class="sign">[</span>1<span class="sign">]</span><span class="sign">}</span> <span class="sign">|</span> tail <span class="sign">-</span>n 1

    else

      echo <span class="quote">"-- ok"</span>

    fi

  <span class="sign">}</span> <span class="sign">&gt;</span><span class="sign">&gt;</span> <span class="sign">$</span>_bashlyk_TestUnit_fnLog

  return 0

<span class="sign">}</span>
</pre>
<div id="footer">
<p>Generated from ./src/ with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.43 on 2023-05-09 19:23:16+00:00
</p>
</div> <!-- footer -->
</body>
</html>
