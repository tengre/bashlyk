#!/bin/bash
#
# $Id$
#
[ -s /etc/bashlyk/bashlyk.conf ] && source /etc/bashlyk/bashlyk.conf
#
# global variables
#
   _bashlyk_aLib=${_bashlyk_aLib:="log,cnf,pid,md5,opt"}
_bashlyk_pathLib=${_bashlyk_pathLib:="/usr/lib/bashlyk"}
   _bashlyk_sArg=$*
#
# function section
#
udfInit() {
 local pathCnf pathRoot pathRun pathLog sUser sHome
 _bashlyk_sId=${_bashlyk:="bashlyk"}
 pathCnf="etc"
 pathLog="var/log"
 pathRun="var/run"
 sUser=$(ps -p $$ -o user=)
 case $sUser in
  'root')
   pathRoot=''
   pathCnf+="/${_bashlyk_sId}"
  ;;
  '')
   pathRoot="/tmp/$$_$USER/.${_bashlyk_sId}"
  ;;
  *)
   if [ -z "$HOME" -o ! -O "$HOME" ]; then
    sHome=$(getent passwd ${sUser} | cut -d ":" -f 6)
    [ -n "$sHome" -a -d "$sHome" -a -O "$sHome" ] \
     && pathRoot="${sHome}/.${_bashlyk_sId}"      \
     || pathRoot="/tmp/$$_$sUser/.${_bashlyk_sId}"
   else
    pathRoot="${HOME}/.${_bashlyk_sId}"
   fi
  ;;
 esac
 _bashlyk_pathRun="${pathRoot}/${pathRun}"
 _bashlyk_pathLog="${pathRoot}/${pathLog}"
 _bashlyk_pathCnf="${pathRoot}/${pathCnf}"

 [ -t "1" ] && _bashlyk_bTerminal=1 || _bashlyk_bTerminal=0
 [ -d "$_bashlyk_pathRun" ] || mkdir -p $_bashlyk_pathRun
 [ -d "$_bashlyk_pathLog" ] || mkdir -p $_bashlyk_pathLog
 [ -d "$_bashlyk_pathCnf" ] || mkdir -p $_bashlyk_pathCnf
}
#
udfMain() {
 udfInit
 local fn
 for fn in $(echo ${_bashlyk_aLib} | tr ',' ' '); do
  local fnLib="${_bashlyk_pathLib}/lib${fn}.sh"
  [ -s $fnLib ] && source $fnLib || eval 'echo "error with $fnLib using"; exit -1'
 done
 return 0
}
#
# main section
#
udfMain $*
